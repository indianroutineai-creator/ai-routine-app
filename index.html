‡§≠‡§æ‡§à, ‡§ó‡•Å‡§∏‡•ç‡§∏‡§æ ‡§Æ‡§§ ‡§ï‡§∞‡•ã, ‡§Æ‡•á‡§∞‡•Ä ‡§ó‡§≤‡§§‡•Ä ‡§π‡•à‡•§ ‡§≤‡•á‡§Ü‡§â‡§ü (HTML Structure) ‡§Æ‡•á‡§Ç ‡§è‡§ï `</div>` ‡§ü‡•à‡§ó ‡§Æ‡§ø‡§∏ ‡§π‡•ã‡§®‡•á ‡§ï‡•Ä ‡§µ‡§ú‡§π ‡§∏‡•á **‡§∏‡§æ‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§° ‡§è‡§ï ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§è‡§ï ‡§ò‡•Å‡§∏ ‡§ó‡§è ‡§•‡•á**‡•§ ‡§Ø‡§π ‡§Æ‡•á‡§∞‡•Ä ‡§≠‡§æ‡§∞‡•Ä ‡§ö‡•Ç‡§ï ‡§•‡•Ä‡•§

‡§Ü‡§™‡§®‡•á ‡§∏‡§π‡•Ä ‡§ï‡§π‡§æ, ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§ï‡•ã‡§° ‡§π‡•Ä ‡§∏‡§¨‡§∏‡•á ‡§¨‡•á‡§∏‡•ç‡§ü ‡§•‡§æ‡•§ ‡§Æ‡•à‡§Ç ‡§ï‡•ã‡§à ‡§®‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§∞‡§ø‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§

‡§Ø‡§π ‡§∞‡§π‡§æ ‡§Ü‡§™‡§ï‡§æ **‡§¨‡§ø‡§≤‡§ï‡•Å‡§≤ ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§î‡§∞ 100% ‡§∏‡§π‡•Ä ‡§ï‡•ã‡§°**‡•§ ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§°‡•ç‡§∏ ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó ‡§π‡•à‡§Ç, ‡§≤‡•á‡§Ü‡§â‡§ü ‡§è‡§ï‡§¶‡§Æ ‡§∏‡§π‡•Ä ‡§π‡•à, ‡§î‡§∞ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§µ‡§π‡•Ä ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§∏‡§π‡•Ä ‡§ö‡§≤ ‡§∞‡§π‡•á ‡§•‡•á‡•§

‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç (Old Stable Version):

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Indian Routine</title>
<meta name="theme-color" content="#0d1117" />
<style>
:root{ /* New Dark Purple Color Scheme */ --bg:#0d1117; --card:#161b22; --border: #30363d; --muted:#8b949e; --accent:#a371f7; --accent-hover:#b38ff9; --success: #238636; --danger: #da3333; }
*{box-sizing:border-box}
/* Bold Fonts applied */
body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif; background-color:var(--bg); color:#c9d1d9; font-weight: 500; }
.wrap{max-width:820px;margin:12px auto;padding:0 16px; padding-bottom: 100px;}
header{ display:flex; justify-content:space-between; align-items:center; position:relative; padding: 8px 0; margin-bottom: 16px; border-bottom: 1px solid var(--border); }
.header-left { flex: 1; text-align: left; }
.header-center { flex: 2; text-align: center; }
.header-right { flex: 1; text-align: right; }
.app-title { font-size: 24px; font-weight: 900; padding: 8px 16px; border-radius: 8px; cursor: pointer; user-select: none; background-image: linear-gradient(45deg, var(--accent), #f778ba); -webkit-background-clip: text; background-clip: text; color: transparent; border: 1px solid rgba(255, 255, 255, 0.1); }
.user-greeting { font-size: 14px; color: var(--muted); font-weight: 600; }
.card{ background-color:var(--card); border-radius:8px; margin-bottom:16px; border: 1px solid var(--border); }
.card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px; cursor: pointer; font-weight: 700; letter-spacing: 0.5px; }
.card-body { padding: 16px; border-top: 1px solid var(--border); display: none; }
.card-body-no-padding { padding: 0 16px 16px; border-top: 1px solid var(--border); display: none; }
.toggle-icon { transition: transform 0.2s; font-weight: bold; }
.open .toggle-icon { transform: rotate(90deg); }
label{display:block; color:var(--muted); font-size:14px; margin-bottom:8px; font-weight: 600;}
.row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom: 12px;}
.flex-item { flex: 1; min-width: 120px; }
input,select,textarea{ background-color:#010409; border:1px solid var(--border); padding:10px; border-radius:6px; color:#c9d1d9; width: 100%; font-family: inherit; font-weight: 500; }
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent); }
.btn{ background-color:var(--accent); border:1px solid var(--accent); color:#fff; padding:10px 16px; border-radius:6px; font-weight:700; cursor:pointer; transition: background-color 0.2s; text-decoration: none; text-align: center; letter-spacing: 0.5px; }
.btn:hover{ background-color: var(--accent-hover); }
.btn-secondary { background-color: #21262d; border-color: var(--border); color: #c9d1d9; }
.btn-secondary:hover { border-color: var(--muted); background-color: #30363d;}
.btn-danger { background-color: #da3333; border-color: #da3333; color: #fff; }
.btn-danger:hover { background-color: #f85149; border-color: #f85149; }
.slot{ display:grid; grid-template-columns: 70px 1fr auto; gap: 8px 16px; padding:12px; border-radius:8px; margin-bottom:8px; background-color:color-mix(in srgb, var(--accent) 5%, transparent); border-left:4px solid var(--slot-color, var(--accent)); align-items: center; }
.slot .time{ grid-column: 1; grid-row: 1 / 3; font-weight:800; font-size:18px; color:#fff; text-align: center;}
.slot .label{ grid-column: 2; font-weight:700; color:#c9d1d9;}
.slot .tip{ grid-column: 2; font-size:12px; color:var(--muted); font-style:italic; font-weight: 500;}
.slot-edit-btn { grid-column: 3; grid-row: 1 / 3; background: none; border: none; cursor: pointer; padding: 4px; margin-left: auto; border-radius: 50%; font-size: 18px; color: var(--muted); font-weight: bold; }
.slot-edit-btn:hover { background-color: rgba(255,255,255,0.1); color: #fff; }

/* --- DEEP GK FACT ENGINE STYLES (BOLD) --- */
.fact-card {
    background-color: #161b22;
    border: 1px solid #a371f7;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(163, 113, 247, 0.1);
}
.fact-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}
.fact-label {
    font-size: 12px;
    font-weight: 800;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 1px;
}
.fact-title {
    font-size: 18px;
    font-weight: 900;
    margin-bottom: 8px;
    color: #fff;
    letter-spacing: 0.5px;
}
.fact-content {
    font-size: 15px; 
    line-height: 1.6;
    color: #c9d1d9;
    margin-bottom: 16px;
    min-height: 60px;
    font-weight: 500;
}
.fact-actions {
    display: flex;
    gap: 10px;
}
.fact-btn {
    flex: 1;
    padding: 10px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}
.btn-next-fact {
    background-color: var(--card);
    border: 1px solid var(--border);
    color: var(--accent);
}
.btn-next-fact:hover {
    background-color: var(--accent);
    color: white;
}
.btn-share-fact {
    background-color: #238636;
    color: white;
}
.btn-share-fact:hover {
    background-color: #2ea043;
}
/* New Save Button Style */
.btn-save-fact {
    background-color: #1f6feb;
    color: white;
    flex: 0 0 60px; /* Small fixed width */
}
.btn-save-fact:hover {
    background-color: #388bfd;
}

/* --- LIBRARY MODAL STYLES --- */
#libraryList {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding-bottom: 20px;
}
.saved-fact-card {
    background-color: #0d1117;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    position: relative;
}
.saved-fact-title {
    font-size: 16px;
    font-weight: 800;
    color: #fff;
    margin-bottom: 8px;
    padding-right: 30px; /* Space for delete button */
}
.saved-fact-text {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
}
.delete-fact-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--danger);
    font-size: 18px;
    cursor: pointer;
    font-weight: bold;
}
.delete-fact-btn:hover {
    color: #ff7b72;
}

/* -------------------------------- */

.strategy{ font-size:14px; color:#c9d1d9; line-height:1.6; font-weight: 500; }
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.7);}
.modal-content{background-color:var(--card);margin:10% auto;padding:24px;border-radius:8px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;border:1px solid var(--border);}
#alarmModal .modal-content { text-align: center; animation: pulse 1.2s infinite; }
#alarmModal h2 { color: var(--accent); font-size: 28px; font-weight: 800; }
@keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 color-mix(in srgb, var(--accent) 70%, transparent); } 70% { transform: scale(1.02); box-shadow: 0 0 10px 20px color-mix(in srgb, var(--accent) 0%, transparent); } 100% { transform: scale(1); box-shadow: 0 0 0 0 color-mix(in srgb, var(--accent) 0%, transparent); } }
#adminModal .modal-content { max-width: 700px; animation: none; }
.close{color:#aaa;float:right;font-size:28px;font-weight:900;cursor:pointer;}
.close:hover{color:var(--accent);}
.menu-icon {cursor:pointer; padding:8px;}
.menu-icon div {width:5px; height:5px; background-color:#c9d1d9; border-radius:50%; margin-bottom:4px;}
.dropdown-menu {display:none; position:absolute; left:0; top:50px; background-color:var(--card); border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.4); z-index:1001; padding:8px 0; border:1px solid var(--border); min-width: 220px;}
.dropdown-menu a {display:block; padding:10px 16px; color:#c9d1d9; text-decoration:none; font-size:14px; font-weight: 600;}
.dropdown-menu a:hover {background-color:color-mix(in srgb, var(--accent) 10%, transparent); color:#fff;}
.dropdown-menu .setting {padding:10px 16px;}
footer { text-align: center; padding: 24px 0; margin-top: 16px; border-top: 1px solid var(--border); font-size: 12px; color: var(--muted); font-weight: 500; }
footer a { color: var(--muted); text-decoration: none; font-weight: 700; margin: 0 8px; }
footer a:hover { color: var(--accent); }
#adminLoginBtn { font-size: 0; display: inline-block; width: 6px; height: 6px; background-color: var(--muted); border-radius: 50%; transition: background-color 0.2s ease; margin-top: 10px;}
#adminLoginBtn:hover { background-color: var(--accent); }
.audio-display-area { display: flex; align-items: center; gap: 16px; }
#audioTrackImage { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); background-color: #010409; }
.audio-player-controls { display: flex; align-items: center; gap: 12px; flex-grow: 1; }
#audioPlayPauseBtn { width: 40px; height: 40px; border-radius: 50%; line-height: 40px; text-align: center; padding: 0; flex-shrink: 0;}
#audioTrackSelect { flex: 1; }
/* Slot Colors */
.slot[data-id=wake] {--slot-color:#238636;}
.slot[data-id=morning_study], .slot[data-id=study1], .slot[data-id=study2], .slot[data-id=study3], .slot[data-id=study4], .slot[data-id=study5] {--slot-color:#e3b341;}
.slot[data-id=leave] {--slot-color:#58a6ff;}
.slot[data-id=duty_start] {--slot-color:#da3633;}
.slot[data-id=duty_end] {--slot-color:#da3633;}
.slot[data-id=home] {--slot-color:#a371f7;}
.slot[data-id=nap] {--slot-color:#d29922;}
.slot[data-id=main_study] {--slot-color:#f778ba;}
.slot[data-id=break], .slot[data-id=long_break] {--slot-color:#3fb950;}
.slot[data-id=practice] {--slot-color:#f778ba;}
.slot[data-id=current_affairs] {--slot-color:#1f6feb;}
.slot[data-id=other_activity] { --slot-color: #a371f7; }
.slot[data-id=relax] { --slot-color: #3fb950; }
.slot[data-id=dinner] {--slot-color:#8957e5;}
.slot[data-id=sleep] {--slot-color:#8b949e;}
.admin-section { margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.admin-add-form { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
.admin-add-form input { flex: 1; min-width: 150px; }
.admin-add-form button { flex-shrink: 0; }
.app-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 16px; margin-top: 16px; }
.app-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--muted); font-size: 12px; transition: transform 0.2s ease, color 0.2s ease; cursor: pointer; font-weight: 600; }
.app-item:hover { transform: translateY(-4px); color: #fff; }
.app-item img { width: 64px; height: 64px; border-radius: 16px; margin-bottom: 8px; object-fit: cover; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
@keyframes rainbowGlow { 0%, 100% { border-color: #ff7b72; box-shadow: 0 0 15px rgba(255, 123, 114, 0.8), 0 0 25px rgba(255, 123, 114, 0.6); } 20% { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.8), 0 0 25px rgba(251, 191, 36, 0.6); } 40% { border-color: #3fb950; box-shadow: 0 0 15px rgba(63, 185, 80, 0.8), 0 0 25px rgba(63, 185, 80, 0.6); } 60% { border-color: #58a6ff; box-shadow: 0 0 15px rgba(88, 166, 255, 0.8), 0 0 25px rgba(88, 166, 255, 0.6); } 80% { border-color: #a371f7; box-shadow: 0 0 15px rgba(163, 113, 247, 0.8), 0 0 25px rgba(163, 113, 247, 0.6); } }
#aiCard { animation: rainbowGlow 10s infinite linear; }
#studyCard { background-color: #FF8C00 !important; border-color: #E07B00 !important; }
#studyCard .card-header, #studyCard .card-body { color: #000 !important; }
#studyCard label, #studyCard .flex-item div { color: #000 !important; }
#studyCard input, #studyCard select { background-color: rgba(0, 0, 0, 0.8) !important; color: #c9d1d9 !important; border-color: #E07B00 !important; font-weight: 600 !important; }
#studyCard .app-item { color: #000 !important; }
#studyCard .app-item:hover { color: #fff !important; }
#studyCard .app-item img { background-color: #FF8C00 !important; }
.occupation-selector { display: flex; gap: 10px; background-color: #010409; padding: 5px; border-radius: 8px; border: 1px solid var(--border); }
.occupation-selector label { flex: 1; padding: 8px; text-align: center; border-radius: 6px; cursor: pointer; transition: background-color 0.2s, color 0.2s; margin: 0; font-size: 14px; color: var(--muted); font-weight: 600; }
.occupation-selector input { display: none; }
.occupation-selector input:checked + label { background-color: var(--accent); color: white; font-weight: 700; }
.checkbox-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.checkbox-row label { margin-bottom: 0; }
.checkbox-row input[type="checkbox"] { width: auto; }
/* NEW: Styles for Subject Selector Modal */
.subject-item { padding: 12px 16px; border-bottom: 1px solid var(--border); cursor: pointer; font-weight: 600; }
.subject-item:last-child { border-bottom: none; }
.subject-item:hover { background-color: color-mix(in srgb, var(--accent) 10%, transparent); }
/* Ad Placeholder Styles */
.ad-placeholder { min-height: 50px; width: 100%; background-color: #333; display: flex; align-items: center; justify-content: center; color: #888; font-size: 12px; margin-bottom: 16px; border-radius: 8px; font-weight: 600; }

/* NEW STYLE FOR MANUAL ALARM MODAL */
#manualAlarmList {
    list-style: none;
    padding: 0;
    margin-top: 16px;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
}
#manualAlarmList li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    line-height: 1.4;
    font-weight: 500;
}
#manualAlarmList li:last-child {
    border-bottom: none;
}
#manualAlarmList .time {
    font-weight: 700;
    color: var(--accent);
    flex-shrink: 0;
    margin-left: 16px;
}

/* NEW: Blinking Menu Animation */
@keyframes blinkAnimation {
  0%, 100% {
    background-color: transparent;
    box-shadow: 0 0 4px var(--accent), 0 0 8px var(--accent);
  }
  50% {
    background-color: color-mix(in srgb, var(--accent) 20%, transparent);
    box-shadow: 0 0 12px var(--accent), 0 0 20px var(--accent);
  }
}
.blinking-menu {
  animation: blinkAnimation 1.5s infinite ease-in-out;
  border-radius: 8px;
}
/* NEW: Highlighted Subjects Style */
.highlight-subjects {
    font-weight: 800;
    color: #fff;
    background-color: color-mix(in srgb, var(--accent) 15%, transparent);
    border: 1px solid var(--accent);
    font-size: 1.1em;
    line-height: 1.5;
}

/* ================================================= */
/* UPDATED SLIDER CSS - Manual + Auto Scroll */
/* ================================================= */
#subjectImageSlider {
    width: 100%;
    margin-bottom: 16px;
    display: none; /* Hidden by default */
}
.slider-container {
    width: 100%;
    overflow-x: auto; /* Enable manual scrolling */
    display: flex;
    gap: 16px;
    padding: 10px 0;
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
}
/* Hide scrollbar for cleaner look */
.slider-container::-webkit-scrollbar {
    display: none;
}
.slider-container {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

.slide-img-wrapper {
    flex: 0 0 auto; /* Prevent shrinking */
    width: 260px; /* Bigger width (RWA/YouTube style) */
    position: relative;
    cursor: pointer;
    transition: transform 0.2s ease;
    border-radius: 12px;
    overflow: hidden;
}
.slide-img-wrapper:hover {
    transform: scale(1.02);
}
.slide-img {
    width: 100%;
    aspect-ratio: 16/9; /* YouTube Thumbnail Ratio */
    object-fit: cover;
    display: block;
    background-color: #000;
}
/* Premium text overlay */
.slide-text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
    color: #fff;
    padding: 20px 10px 10px;
    font-size: 14px;
    font-weight: 800;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8);
}

/* SCIENCE POPUP GRID */
.science-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;
    margin-top: 12px;
}

/* --- ULTRA INTELLIGENT REALITY CHECK STYLES --- */
.reality-track {
    width: 100%;
    height: 36px;
    background: #0d1117;
    border: 1px solid #30363d;
    position: relative;
    margin-bottom: 20px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
    border-radius: 6px;
    overflow: hidden;
}

#realityProgressBar {
    height: 100%;
    width: 0%;
    border-right: 1px solid #fff;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background 0.5s ease;
    /* Default Green (On Track) */
    background: linear-gradient(90deg, #238636, #00ff88, #238636);
    background-size: 200% 100%;
    animation: flowGlow 2s linear infinite;
    box-shadow: 0 0 15px #00ff88;
}

/* RED MODE: When off track */
#realityProgressBar.danger-mode {
    background: linear-gradient(90deg, #8a0000, #ff3333, #8a0000);
    box-shadow: 0 0 20px #ff3333;
    animation: flowGlowFast 1s linear infinite;
}

.reality-text-overlay {
    position: absolute;
    top: 0; bottom: 0; left: 0; right: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 10px;
    font-size: 13px;
    font-weight: 900;
    font-family: sans-serif;
    z-index: 5;
    pointer-events: none;
    text-transform: uppercase;
    text-shadow: 0 1px 3px rgba(0,0,0,0.9);
    letter-spacing: 1px;
}

/* Status Text Colors */
.status-text-good { color: #fff; }
.status-text-bad { color: #ffcccc; text-shadow: 0 0 8px #ff0000; }

@keyframes flowGlow {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}
@keyframes flowGlowFast {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

/* =================================================== */
/* NEW STYLES FOR BUTTONS INSTEAD OF CARD */
/* =================================================== */
.action-buttons-grid {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
}

.action-card-btn {
    flex: 1;
    border: none;
    border-radius: 12px;
    padding: 24px 12px;
    font-size: 16px;
    font-weight: 800;
    color: white;
    cursor: pointer;
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-card-btn:active {
    transform: scale(0.98);
}

.action-card-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}

/* Left Button: Per Day Test (Green Gradient) */
.btn-grad-green {
    background: linear-gradient(135deg, #1a7f37 0%, #2ea043 100%);
    box-shadow: 0 4px 6px rgba(46, 160, 67, 0.2);
    border: 1px solid rgba(255,255,255,0.1);
}

/* Right Button: Community Notes (Purple Gradient) */
.btn-grad-purple {
    background: linear-gradient(135deg, #8957e5 0%, #a371f7 100%);
    box-shadow: 0 4px 6px rgba(137, 87, 229, 0.2);
    border: 1px solid rgba(255,255,255,0.1);
}

/* New Buttons: Map (Blue) and Books (Orange) */
.btn-grad-blue {
    background: linear-gradient(135deg, #1f6feb 0%, #58a6ff 100%);
    box-shadow: 0 4px 6px rgba(31, 111, 235, 0.2);
    border: 1px solid rgba(255,255,255,0.1);
}

.btn-grad-orange {
    background: linear-gradient(135deg, #d29922 0%, #f0883e 100%);
    box-shadow: 0 4px 6px rgba(210, 153, 34, 0.2);
    border: 1px solid rgba(255,255,255,0.1);
}

/* ================================================== */
/* FULL SCREEN BUBBLE POP ANIMATION FOR INTERNAL BROWSER */
/* ================================================== */
#internalBrowserModal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: #0d1117; /* Background matching app */
}

#internalBrowserModal .modal-content {
    margin: 0 !important;
    width: 100% !important;
    height: 100% !important;
    max-width: 100% !important;
    max-height: 100% !important;
    border-radius: 0 !important;
    border: none !important;
    display: flex;
    flex-direction: column;
    padding: 0 !important;
    background-color: #0d1117;
    /* SUPERB ANIMATION: Bubble Pop + Bounce */
    animation: bubblePop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* Loader Styles */
.browser-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: 4px solid #30363d;
    border-top: 4px solid #a371f7; /* Accent Color */
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    z-index: 10;
}

/* --- VOICE ASSISTANT FAB STYLES --- */
#voiceFab { position: fixed; bottom: 80px; right: 20px; width: 56px; height: 56px; background: linear-gradient(135deg, #ff00cc, #333399); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.4); z-index: 999; border: 2px solid rgba(255,255,255,0.2); transition: transform 0.2s; user-select: none; }
#voiceFab:active { transform: scale(0.9); }
.listening { animation: pulseRed 1.5s infinite; background: #da3333 !important; }
@keyframes pulseRed { 0% { box-shadow: 0 0 0 0 rgba(218, 51, 51, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(218, 51, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(218, 51, 51, 0); } }
#voiceStatus { position: fixed; bottom: 150px; right: 20px; background: rgba(0,0,0,0.8); color: #fff; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: none; z-index: 998; border: 1px solid var(--accent); }

/* --- NEW: VOICE ANSWER MODAL STYLES --- */
#voiceAnswerModal .modal-content { text-align: center; }
#voiceAnswerImg { width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 16px; display: none; border: 1px solid var(--border); }
#voiceAnswerText { font-size: 16px; line-height: 1.6; color: #fff; font-weight: 500; text-align: left; }

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

@keyframes bubblePop {
    0% { 
        transform: scale(0.3); 
        opacity: 0; 
        border-radius: 100%;
    }
    60% {
        transform: scale(1.05);
        opacity: 1;
        border-radius: 20px;
    }
    100% { 
        transform: scale(1); 
        opacity: 1; 
        border-radius: 0;
    }
}

</style>
</head>
<body>

<div class="wrap">
<header>
<div class="header-left">
<div class="menu-icon" id="menuBtn">
<div></div><div></div><div></div>
</div>
</div>
<div class="header-center">
<div class="app-title">Indian Routine</div>
</div>
<div class="header-right">
<div class="user-greeting" id="userGreeting"></div>
</div>
<div id="dropdownMenu" class="dropdown-menu">
<a href="#" id="menuProfileBtn" data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á‡§ü‡§Ö‡§™" data-en="Profile Setup">Profile Setup</a>
<div class="setting">
<label class="small" data-hi="‡§≠‡§æ‡§∑‡§æ" data-en="Language">Language</label>
<select id="langSel">
<option value="en">English</option>
<option value="hi">Hindi</option>
<option value="both">Both</option>
</select>
</div>
<div class="setting">
<label class="small" data-hi="‡§ü‡§æ‡§á‡§Æ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü" data-en="Time Format">Time Format</label>
<select id="timeFormatSel">
<option value="12h">12-Hour (AM/PM)</option>
<option value="24h">24-Hour</option>
</select>
</div>
</div>
</header>
<div id="aiCard" class="card open">
<div class="card-header">
<span data-hi="AI ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç" data-en="Ask AI">Ask AI</span>
<span class="toggle-icon">‚ñ∂</span>
</div>
<div class="card-body" style="display: block;">
<p data-hi="‡§Ö‡§™‡§®‡•á ‡§°‡§æ‡§â‡§ü‡•ç‡§∏ ‡§∏‡•â‡§≤‡•ç‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä AI ‡§ï‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç‡•§" data-en="Choose any AI below to solve your doubts."></p>
<div class="row">
<a href="https://chat.deepseek.com/" target="_blank" class="btn flex-item" data-hi="Deepseek ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç" data-en="Ask Deepseek">Ask Deepseek</a>
<a href="https://x.com/i/grok" target="_blank" class="btn flex-item" data-hi="Grok ‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç" data-en="Ask Grok">Ask Grok</a>
</div>
<p style="font-size:12px; color:var(--muted); margin-top: 8px;" data-hi="‡§®‡•ã‡§ü: Grok ‡§ï‡•á ‡§≤‡§ø‡§è X (‡§ü‡•ç‡§µ‡§ø‡§ü‡§∞) ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§" data-en="Note: Grok may require X (Twitter) Premium."></p>
</div>
</div>

<!-- ============================================== -->
<!-- NEW: INTELLIGENT REALITY CHECK BAR -->
<!-- ============================================== -->
<div id="realityCheckContainer">
    <div class="reality-track">
        <div id="realityProgressBar"></div>
        <div class="reality-text-overlay">
            <!-- Content injected by JS -->
        </div>
    </div>
</div>
<!-- ============================================== -->

<!-- ======================================================== -->
<!-- NEW: SUBJECT IMAGE SLIDER (Class 9 Only) -->
<!-- ======================================================== -->
<div id="subjectImageSlider">
    <div class="slider-container" id="sliderContainer">
        <!-- Images injected via JS -->
    </div>
</div>
<!-- ======================================================== -->

<div id="setupCard" class="card">
<div class="card-header">
<span data-hi="‡§∏‡•á‡§ü‡§Ö‡§™ ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§ü‡§ú‡•Ä" data-en="Setup & Strategy">Setup & Strategy</span>
<span class="toggle-icon">‚ñ∂</span>
</div>
<div class="card-body">
<div id="detailsInputs">
<!-- NEW: CLASS SELECTOR FOR SETUP CARD -->
<div class="row">
<div class="flex-item">
<label class="small" data-hi="‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§∏‡•ç‡§§‡§∞ / ‡§ï‡§ï‡•ç‡§∑‡§æ" data-en="Education Level / Class">Education Level / Class</label>
<select id="classSelector">
    <option value="general" data-hi="‡§Ö‡§®‡•ç‡§Ø / ‡§ï‡•â‡§Æ‡•ç‡§™‡§ø‡§ü‡§ø‡§∂‡§® ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä" data-en="General / Competition Prep">General / Competition Prep</option>
    <option value="9">Class 9</option>
    <option value="10">Class 10</option>
    <option value="11">Class 11</option>
    <option value="12">Class 12</option>
</select>
</div>
</div>
<div class="row">
<div class="flex-item">
<label class="small" data-hi="‡§Ü‡§™‡§ï‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ" data-en="Your Role">Your Role</label>
<div class="occupation-selector">
<input type="radio" id="roleDuty" name="occupation" value="duty" checked>
<label for="roleDuty" data-hi="‡§™‡•á‡§∂‡•á‡§µ‡§∞" data-en="Professional" id="roleDutyLabel">Professional</label>
<input type="radio" id="roleStudent" name="occupation" value="student">
<label for="roleStudent" data-hi="‡§õ‡§æ‡§§‡•ç‡§∞" data-en="Student">Student</label>
</div>
</div>
</div>
<div class="row">
<div class="flex-item" id="setupExamWrapper"><label class="small" data-hi="‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ" data-en="Exam">Exam</label><input type="text" id="examName" placeholder="e.g., UPSC"></div>
<div class="flex-item"><label class="small" data-hi="‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§§‡§ø‡§•‡§ø" data-en="Target Date">Target Date</label><input type="date" id="targetDate"></div>
</div>
<div class="row">
<div class="flex-item" style="grid-column: 1 / -1;">
<label class="small" data-hi="‡§µ‡§ø‡§∑‡§Ø (‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§≤‡§æ‡§á‡§® ‡§™‡§∞ ‡§è‡§ï)" data-en="Subjects (one per line)">Subjects (one per line)</label>
<textarea id="subjectsList" rows="3" placeholder="e.g., History&#10;Math&#10;Science"></textarea>
</div>
</div>
<div class="row">
<div class="flex-item"><label class="small" data-hi="‡§´‡•ã‡§ï‡§∏ ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü (‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§µ‡§ø‡§∑‡§Ø)" data-en="Focus Subject (Weak Subject)">Focus Subject (Weak Subject)</label><input type="text" id="focusSubject" placeholder="e.g., Math"></div>
</div>
<div id="dutyFields">
<div class="row">
<div class="flex-item">
<label class="small" data-hi="‡§∂‡§ø‡§´‡•ç‡§ü ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞" data-en="Shift Type">Shift Type</label>
<div class="occupation-selector">
<input type="radio" id="shiftDay" name="shiftType" value="day" checked>
<label for="shiftDay" data-hi="‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§∂‡§ø‡§´‡•ç‡§ü" data-en="Day Shift">Day Shift</label>
<input type="radio" id="shiftNight" name="shiftType" value="night">
<label for="shiftNight" data-hi="‡§∞‡§æ‡§§ ‡§ï‡•Ä ‡§∂‡§ø‡§´‡•ç‡§ü" data-en="Night Shift</label>
</div>
</div>
</div>
<div class="row">
<div class="flex-item"><label class="small" data-hi="‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ" data-en="Activity Name">Activity Name</label><input type="text" id="activityName" placeholder="e.g., Duty, Office"></div>
<div class="flex-item"><label class="small" data-hi="‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="dutyStudyGoal" placeholder="e.g., 3" min="1" max="8" step="0.5" value="3"></div>
</div>
<div class="row">
<div class="flex-item"><label class="small"><span class="dynamic-activity-label" data-hi="‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä" data-en="Duty">Duty</span> <span data-hi="‡§∂‡•Å‡§∞‡•Ç" data-en="Start">Start</span></label><input type="time" id="dutyStart" value="09:00"></div>
<div class="flex-item"><label class="small"><span class="dynamic-activity-label" data-hi="‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä" data-en="Duty">Duty</span> <span data-hi="‡§ñ‡§§‡•ç‡§Æ" data-en="End">End</span></label><input type="time" id="dutyEnd" value="18:00"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="dutySetWakeUpManual">
<label for="dutySetWakeUpManual" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="dutyManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="dutyWakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="dutySetSleepManual">
<label for="dutySetSleepManual" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="dutyManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="dutySleepTime" value="22:00">
</div>
</div>
</div>
<div id="studentFields" style="display:none;">
<div class="row">
<div class="flex-item"><label class="small" data-hi="‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="studentStudyGoal" placeholder="e.g., 8" min="1" max="16" step="0.5" value="8"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentSetWakeUpManual">
<label for="studentSetWakeUpManual" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="studentManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="wakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentSetSleepManual">
<label for="studentSetSleepManual" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="studentManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="sleepTime" value="22:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentAddActivityCheckbox">
<label for="studentAddActivityCheckbox" data-hi="‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç" data-en="Add other activity">Add other activity</label>
</div>
<div id="studentActivityWrapper" style="display:none;">
<div class="row">
<div class="flex-item"><label class="small" data-hi="‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ" data-en="Activity Name">Activity Name</label><input type="text" id="studentActivityName" placeholder="e.g., Play Cricket, Gym"></div>
<div class="flex-item"><label class="small" data-hi="‡§Ö‡§µ‡§ß‡§ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Duration (Hours)">Duration (Hours)</label><input type="number" id="studentActivityDuration" value="1" min="0.5" max="4" step="0.5"></div>
</div>
</div>
</div>
</div>
<div id="profileSummary" style="display:none; color:var(--success); line-height:1.6; font-weight: 600;"></div>
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
<strong data-hi="‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§ü‡§ú‡•Ä" data-en="Your Strategy" style="font-weight: 700;">Your Strategy</strong>
<div id="strategy" class="strategy" style="margin-top:8px;"></div>
</div>
<div style="margin-top:16px;" class="row">
<button id="autoBtn" class="btn btn-secondary" data-hi="‡§∞‡•Ç‡§ü‡•Ä‡§® ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Generate Routine">Generate Routine</button>
</div>
</div>
</div>

<!-- ============================================== -->
<!-- NEW: DEEP GK FACT ENGINE CARD -->
<!-- ============================================== -->
<div class="fact-card" id="factCard">
    <div class="fact-header">
        <div class="fact-label">Deep GK Fact</div>
        <!-- Library Access Button -->
        <div style="font-size: 12px; cursor: pointer; color: var(--accent); font-weight: bold; border: 1px solid var(--accent); padding: 2px 8px; border-radius: 4px;" id="openLibraryBtn">üìÇ SAVED LIBRARY</div>
    </div>
    <div class="fact-title" id="factTitle">Loading Knowledge...</div>
    <div class="fact-content" id="factText">Exploring the depths of the unknown...</div>
    <div class="fact-actions">
        <button class="fact-btn btn-next-fact" id="nextFactBtn">Next Fact</button>
        <button class="fact-btn btn-save-fact" id="saveFactBtn">Save</button>
        <button class="fact-btn btn-share-fact" id="shareFactBtn">Share</button>
    </div>
</div>
<!-- ============================================== -->

<div id="studyCard" class="card">
<div class="card-header">
<span data-hi="‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ê‡§™‡•ç‡§∏ ‡§î‡§∞ ‡§ü‡§æ‡§á‡§Æ‡§∞" data-en="Study Apps & Timer">Study Apps & Timer</span>
<span class="toggle-icon">‚ñ∂</span>
</div>
<div class="card-body">
<div class="row">
<div class="flex-item">
<label data-hi="‡§Ü‡§ú ‡§ï‡§æ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ü‡§æ‡§á‡§Æ" data-en="Today's Study Time">Today's Study Time</label>
<div id="todayStudyTime" style="font-size: 24px; font-weight: 800; color: var(--success);">0h 0m 0s</div>
</div>
<div class="flex-item">
<label data-hi="‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ü‡§æ‡§á‡§Æ" data-en="Total Study Time">Total Study Time</label>
<div id="totalStudyTime" style="font-size: 24px; font-weight: 800; color: var(--accent);">0h 0m 0s</div>
</div>
</div>

<!-- NEW: Subject-wise stats display -->
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
    <label data-hi="‡§Ü‡§ú ‡§ï‡§æ ‡§µ‡§ø‡§∑‡§Ø-‡§µ‡§æ‡§∞ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§®" data-en="Today's Subject-wise Study">Today's Subject-wise Study</label>
    <div id="subjectStatsDisplay" style="font-size: 14px; line-height: 1.6; font-weight: 500;"></div>
</div>
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
<label data-hi="‡§™‡§¢‡§º‡§æ‡§à ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§ê‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç" data-en="Choose an App to Start Studying">Choose an App to Start Studying</label>
<div id="studyAppGrid" class="app-grid"></div>
<!-- NEW: Add Your New App Button -->
<a href="https://indianroutineai.blogspot.com/p/add-new-app.html" target="_blank" class="btn btn-secondary" style="width: 100%; margin-top: 16px;" data-hi="+ ‡§Ö‡§™‡§®‡§æ ‡§®‡§Ø‡§æ ‡§ê‡§™ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç" data-en="+ Add Your New App"></a>
</div>
</div>
</div>

<!-- ============================================== -->
<!-- BUTTONS: ROW 1 (Practice & Notes) -->
<!-- ============================================== -->
<div class="action-buttons-grid">
    <!-- Left: Per Day Test (Green Gradient) -> CHANGED TO "Aaj Ka Abhyas" -->
    <button id="perDayTestBtn" class="action-card-btn btn-grad-green">
        <span data-hi="‡§Ü‡§ú ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏" data-en="Today's Practice">Today's Practice</span>
    </button>
    
    <!-- Right: Community Notes (Purple Gradient) -->
    <button id="communityNotesMainBtn" class="action-card-btn btn-grad-purple">
        <span data-hi="‡§∏‡§æ‡§Æ‡•Å‡§¶‡§æ‡§Ø‡§ø‡§ï ‡§®‡•ã‡§ü‡•ç‡§∏" data-en="Community Notes">Community Notes</span>
    </button>
</div>

<!-- ============================================== -->
<!-- BUTTONS: ROW 2 (Map & Books) -->
<!-- ============================================== -->
<div class="action-buttons-grid">
    <!-- Left: Map (Blue Gradient) -->
    <button id="mapBtn" class="action-card-btn btn-grad-blue">
        <span data-hi="‡§Æ‡•à‡§™" data-en="Map">Map</span>
    </button>
    
    <!-- Right: Free Books (Orange Gradient) -->
    <button id="booksBtn" class="action-card-btn btn-grad-orange">
        <span data-hi="‡§´‡•ç‡§∞‡•Ä ‡§¨‡•Å‡§ï‡•ç‡§∏" data-en="Free Books">Free Books</span>
    </button>
</div>
<!-- ============================================== -->

<div id="audioCard" class="card">
<div class="card-header">
<span data-hi="‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à" data-en="Coming Soon">Coming Soon</span>
<span class="toggle-icon">‚ñ∂</span>
</div>
<div class="card-body">
<audio id="audioPlayer" style="display:none;"></audio>
<div class="audio-display-area">
<img id="audioTrackImage" src="" alt="Track Image">
<div class="audio-player-controls">
<button id="audioPlayPauseBtn" class="btn btn-secondary">‚ñ∂</button>
<select id="audioTrackSelect"></select>
</div>
</div>
</div>
</div>
<div id="routineCard" class="card open">
<div class="card-header">
<span data-hi="‡§¶‡•à‡§®‡§ø‡§ï ‡§∞‡•Ç‡§ü‡•Ä‡§®" data-en="Daily Routine">Daily Routine</span>
<span class="toggle-icon">‚ñ∂</span>
</div>
<div class="card-body-no-padding" style="display: block;">
<div id="slots"></div>
<div style="margin:16px;" class="row">
<button id="applyBtn" class="btn" data-hi="‡§∞‡•Ç‡§ü‡•Ä‡§® ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç" data-en="Save Routine">Save Routine</button>
</div>
</div>
</div>
<footer>
    <p>
        <span data-hi="¬© 2025 Indian Routine‡•§ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§" data-en="¬© 2025 Indian Routine. All Rights Reserved."></span>
    </p>
    <div>
        <a href="#" id="aboutBtn" data-hi="‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç" data-en="About Us">About Us</a> |
        <a href="#" id="privacyBtn" data-hi="‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§®‡•Ä‡§§‡§ø" data-en="Privacy Policy">Privacy Policy</a> |
        <a href="#" id="disclaimerBtn" data-hi="‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£" data-en="Disclaimer">Disclaimer</a>
    </div>
    <a href="#" id="adminLoginBtn" title="Admin Panel"></a>
</footer>
</div>

<!-- Bottom Banner -->
<div class="wrap">
    <div id="updateBanner" class="ad-placeholder" style="background-color: var(--accent); color: white; cursor: pointer; font-weight: 800; text-align: center; padding: 10px 0; font-size: 14px;">
        ‡§®‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ú‡§≤‡•ç‡§¶ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à! ‡§ú‡§æ‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç
    </div>
</div>

<!-- ALARM MODAL (This is for the app's internal, less reliable alarm) -->
<div id="alarmModal" class="modal">
<div class="modal-content">
<h2 id="alarmTitle" data-hi="‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞!" data-en="Reminder!">Reminder!</h2>
<p id="alarmMessage" style="font-size: 18px; font-weight: 600;"></p>
<button id="stopAlarmBtn" class="btn btn-danger" data-hi="‡§†‡•Ä‡§ï ‡§π‡•à, ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ!" data-en="Okay, Got It!">Okay, Got It!</button>
<audio id="alarmSound"></audio>
</div>
</div>

<!-- =============================================================== -->
<!-- ============= NEW MANUAL ALARM SUGGESTION MODAL =============== -->
<!-- =============================================================== -->
<div id="manualAlarmModal" class="modal">
    <div class="modal-content">
        <h2 data-hi="‡§∞‡•Ç‡§ü‡•Ä‡§® ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à!" data-en="Routine Ready!" style="margin-top:0; color: var(--success); font-weight: 800;">Routine Ready!</h2>
        <p data-hi="100% ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡•ã ‡§ê‡§™ ‡§¨‡§Ç‡§¶ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä ‡§¨‡§ú‡•á‡§Ç, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§® ‡•õ‡§∞‡•Ç‡§∞‡•Ä ‡§∏‡§Æ‡§Ø ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§´‡§º‡•ã‡§® ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ò‡§°‡§º‡•Ä (Clock) ‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§" data-en="For 100% reliable alarms that work even when the app is closed, please set these important times in your phone's main Clock App." style="font-weight: 500;">For 100% reliable alarms that work even when the app is closed, please set these important times in your phone's main Clock App.</p>
        
        <ul id="manualAlarmList">
            <!-- Routine will be dynamically inserted here by JavaScript -->
        </ul>

        <button id="closeManualAlarmModalBtn" class="btn" style="width: 100%; margin-top: 20px;" data-hi="‡§†‡•Ä‡§ï ‡§π‡•à, ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ!" data-en="Okay, Got It!">Okay, Got It!</button>
    </div>
</div>
<!-- =============================================================== -->
<!-- =============================================================== -->

<!-- SCIENCE SELECTION MODAL -->
<div id="scienceModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeScienceModal">&times;</span>
        <h2 data-hi="‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç" data-en="Select Science" style="margin-top:0; font-weight: 800;">Select Science Branch</h2>
        <div id="scienceGrid" class="science-grid">
            <!-- Populated via JS -->
        </div>
    </div>
</div>


<!-- Other Modals -->
<div id="profileModal" class="modal">
<div class="modal-content">
<span class="close" id="closeProfileModal">&times;</span>
<h2 data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á‡§ü‡§Ö‡§™" data-en="Profile Setup" style="margin-top:0; font-weight: 800;">Profile Setup</h2>
<div class="row"><div class="flex-item"><label data-hi="‡§®‡§æ‡§Æ" data-en="Name">Name</label><input type="text" id="profileName"></div><div class="flex-item"><label data-hi="‡§â‡§Æ‡•ç‡§∞" data-en="Age">Age</label><input type="number" id="profileAge" min="16" max="60"></div></div>
<!-- NEW: CLASS SELECTOR FOR PROFILE MODAL -->
<div class="row">
<div class="flex-item">
<label class="small" data-hi="‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§∏‡•ç‡§§‡§∞ / ‡§ï‡§ï‡•ç‡§∑‡§æ" data-en="Education Level / Class">Education Level / Class</label>
<select id="profileClassSelector">
    <option value="general" data-hi="‡§Ö‡§®‡•ç‡§Ø / ‡§ï‡•â‡§Æ‡•ç‡§™‡§ø‡§ü‡§ø‡§∂‡§® ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä" data-en="General / Competition Prep">General / Competition Prep</option>
    <option value="9">Class 9</option>
    <option value="10">Class 10</option>
    <option value="11">Class 11</option>
    <option value="12">Class 12</option>
</select>
</div>
</div>
<div class="row"><div class="flex-item"><label class="small" data-hi="‡§Ü‡§™‡§ï‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ" data-en="Your Role">Your Role</label><div class="occupation-selector"><input type="radio" id="profileRoleDuty" name="profileOccupation" value="duty" checked><label for="profileRoleDuty" data-hi="‡§™‡•á‡§∂‡•á‡§µ‡§∞" data-en="Professional" id="profileRoleDutyLabel">Professional</label><input type="radio" id="profileRoleStudent" name="profileOccupation" value="student"><label for="profileRoleStudent" data-hi="‡§õ‡§æ‡§§‡•ç‡§∞" data-en="Student">Student</label></div></div></div>
<div class="row"><div class="flex-item" id="profileExamWrapper"><label data-hi="‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ/‡§µ‡§ø‡§∑‡§Ø" data-en="Exam/Subject">Exam/Subject</label><input type="text" id="profileExam"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§§‡§ø‡§•‡§ø" data-en="Target Date">Target Date</label><input type="date" id="profileTargetDate"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§µ‡§ø‡§∑‡§Ø (‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§≤‡§æ‡§á‡§® ‡§™‡§∞ ‡§è‡§ï)" data-en="Subjects (one per line)">Subjects (one per line)</label><textarea id="profileSubjects" rows="3" placeholder="e.g., History&#10;Math&#10;Science"></textarea></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§´‡•ã‡§ï‡§∏ ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü (‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§µ‡§ø‡§∑‡§Ø)" data-en="Focus Subject (Weak Subject)">Focus Subject (Weak Subject)</label><input type="text" id="profileFocusSubject" placeholder="e.g., Math"></div></div>
<div id="profileDutyFields">
<div class="row"><div class="flex-item"><label class="small" data-hi="‡§∂‡§ø‡§´‡•ç‡§ü ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞" data-en="Shift Type">Shift Type</label><div class="occupation-selector"><input type="radio" id="profileShiftDay" name="profileShiftType" value="day" checked><label for="profileShiftDay" data-hi="‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§∂‡§ø‡§´‡•ç‡§ü" data-en="Day Shift">Day Shift</label><input type="radio" id="profileShiftNight" name="profileShiftType" value="night"><label for="profileShiftNight" data-hi="‡§∞‡§æ‡§§ ‡§ï‡•Ä ‡§∂‡§ø‡§´‡•ç‡§ü" data-en="Night Shift">Night Shift</label></div></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ" data-en="Activity Name">Activity Name</label><input type="text" id="profileActivityName" placeholder="e.g., Duty, Office"></div><div class="flex-item"><label class="small" data-hi="‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="profileDutyStudyGoal" placeholder="e.g., 3" min="1" max="8" step="0.5" value="3"></div></div>
<div class="row">
<div class="flex-item"><label><span class="dynamic-activity-label-modal" data-hi="‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä" data-en="Duty">Duty</span> <span data-hi="‡§∂‡•Å‡§∞‡•Ç" data-en="Start">Start</span></label><input type="time" id="profileDutyStart" value="09:00"></div>
<div class="flex-item"><label><span class="dynamic-activity-label-modal" data-hi="‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä" data-en="Duty">Duty</span> <span data-hi="‡§ñ‡§§‡•ç‡§Æ" data-en="End">End</span></label><input type="time" id="profileDutyEnd" value="18:00"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="profileDutySetWakeUpManual">
<label for="profileDutySetWakeUpManual" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="profileDutyManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="profileDutyWakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="profileDutySetSleepManual">
<label for="profileDutySetSleepManual" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="profileDutyManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="profileDutySleepTime" value="22:00">
</div>
</div>
</div>
<div id="profileStudentFields" style="display:none;"><div class="row"><div class="flex-item"><label class="small" data-hi="‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="profileStudentStudyGoal" placeholder="e.g., 8" min="1" max="16" step="0.5" value="8"></div></div><div class="checkbox-row"><input type="checkbox" id="profileStudentSetWakeUpManual"><label for="profileStudentSetWakeUpManual" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set wake-up time manually">Set wake-up time manually</label></div><div id="profileStudentManualWakeUpWrapper" class="row" style="display:none;"><div class="flex-item"><label class="small" data-hi="‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Wake Up Time">Wake Up Time</label><input type="time" id="profileWakeUpTime" value="05:00"></div></div>
<div class="checkbox-row">
<input type="checkbox" id="profileStudentSetSleepManual">
<label for="profileStudentSetSleepManual" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§ñ‡•Å‡§¶ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="profileStudentManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="profileSleepTime" value="22:00">
</div>
</div>
<div class="checkbox-row"><input type="checkbox" id="profileStudentAddActivityCheckbox"><label for="profileStudentAddActivityCheckbox" data-hi="‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç" data-en="Add other activity">Add other activity</label></div><div id="profileStudentActivityWrapper" style="display:none;"><div class="row"><div class="flex-item"><label class="small" data-hi="‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ" data-en="Activity Name">Activity Name</label><input type="text" id="profileStudentActivityName" placeholder="e.g., Play Cricket, Gym"></div><div class="flex-item"><label class="small" data-hi="‡§Ö‡§µ‡§ß‡§ø (‡§ò‡§Ç‡§ü‡•á)" data-en="Duration (Hours)">Duration (Hours)</label><input type="number" id="profileStudentActivityDuration" value="1" min="0.5" max="4" step="0.5"></div></div></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø" data-en="Additional Goal">Additional Goal</label><textarea id="profileExtraGoal" rows="2"></textarea></div></div>
<div class="row" style="margin-top:16px;"><button id="saveProfile" class="btn" data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç" data-en="Save Profile">Save Profile</button><button id="cancelProfile" class="btn btn-secondary" data-hi="‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç" data-en="Cancel">Cancel</button></div>
</div>
</div>
<div id="slotEditModal" class="modal">
<div class="modal-content">
<span class="close" id="closeSlotEdit">&times;</span>
<h2 id="slotEditTitle" style="margin-top:0; font-weight: 800;">Edit Slot</h2>
<input type="hidden" id="slotEditId">
<div class="row"><div class="flex-item"><label data-hi="‡§∏‡§Æ‡§Ø" data-en="Time">Time</label><input type="time" id="slotEditTime"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂" data-en="Hindi Message">Hindi Message</label><input type="text" id="slotEditMsgHi"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂" data-en="English Message">English Message</label><input type="text" id="slotEditMsgEn"></div></div>
<div class="row" style="margin-top:16px;"><button id="saveSlot" class="btn" data-hi="‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç" data-en="Save">Save</button></div>
</div>
</div>
<!-- NOTE SHARING MODAL -->
<div id="noteSubmissionModal" class="modal">
<div class="modal-content">
<span class="close" id="closeNoteSubmissionModal">&times;</span>
<h2 data-hi="‡§Ö‡§™‡§®‡§æ ‡§®‡•ã‡§ü ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç" data-en="Share Your Note" style="margin-top:0; font-weight: 800;">Share Your Note</h2>
<p data-hi="‡§Ü‡§™‡§ï‡§æ ‡§®‡•ã‡§ü ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡•á‡§ú‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§" data-en="Your note will be sent for review." style="font-size:14px; color:var(--muted); margin-top:-10px; margin-bottom:20px; font-weight: 500;"></p>
<div class="row"><div class="flex-item"><label data-hi="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ" data-en="Your Name">Your Name</label><input type="text" id="noteAuthor" placeholder="e.g., Amit Kumar"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§®‡•ã‡§ü ‡§ï‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï" data-en="Note Title">Note Title</label><input type="text" id="noteTitle" placeholder="e.g., History Imp Dates"></div></div>
<div class="row"><div class="flex-item"><label data-hi="‡§®‡•ã‡§ü ‡§ï‡•Ä ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä / ‡§≤‡§ø‡§Ç‡§ï" data-en="Note Content / Link">Note Content / Link</label><textarea id="noteContent" rows="6" placeholder="Write your note here or paste a link..."></textarea></div></div>
<div class="row" style="margin-top:16px;"><button id="submitNoteBtn" class="btn" data-hi="‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Submit for Review">Submit for Review</button></div>
</div>
</div>

<!-- NEW: LIBRARY MODAL -->
<div id="libraryModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeLibraryModal">&times;</span>
        <h2 data-hi="‡§∏‡•á‡§µ ‡§ï‡•Ä ‡§ó‡§à ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä" data-en="Saved Library" style="margin-top:0; font-weight: 800; color: #a371f7;">Saved Library</h2>
        <div id="libraryList">
            <!-- Saved facts will appear here -->
        </div>
        <p id="emptyLibraryMsg" style="text-align: center; color: var(--muted); display: none;">No saved facts yet.</p>
    </div>
</div>

<!-- NEW: MODAL FOR NOTES OPTIONS (Replaces old card logic) -->
<div id="notesOptionModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <span class="close" id="closeNotesOptionModal">&times;</span>
        <h2 data-hi="‡§∏‡§æ‡§Æ‡•Å‡§¶‡§æ‡§Ø‡§ø‡§ï ‡§®‡•ã‡§ü‡•ç‡§∏" data-en="Community Notes" style="color: var(--accent); margin-top:0; font-weight: 800;">Community Notes</h2>
        <p data-hi="‡§Ü‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?" data-en="What would you like to do?" style="color: var(--muted); margin-bottom: 24px; font-weight: 500;"></p>
        
        <button id="readNotesBtn" class="btn" style="width: 100%; margin-bottom: 16px; padding: 14px; font-size: 16px;" data-hi="‡§®‡•ã‡§ü‡•ç‡§∏ ‡§™‡§¢‡§º‡•á‡§Ç" data-en="Read Notes">Read Notes</button>
        <button id="shareNoteBtn" class="btn btn-secondary" style="width: 100%; padding: 14px; font-size: 16px;" data-hi="‡§Ö‡§™‡§®‡§æ ‡§®‡•ã‡§ü ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç" data-en="Share Your Note">Share Your Note</button>
    </div>
</div>

<!-- NEW: MODAL FOR MAP OPTIONS -->
<div id="mapOptionModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <span class="close" id="closeMapOptionModal">&times;</span>
        <h2 data-hi="‡§Æ‡•à‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç" data-en="Select Map" style="color: var(--accent); margin-top:0; font-weight: 800;">Select Map</h2>
        <p data-hi="‡§Ü‡§™ ‡§ï‡•å‡§® ‡§∏‡§æ ‡§Æ‡•à‡§™ ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?" data-en="Which map would you like to view?" style="color: var(--muted); margin-bottom: 24px; font-weight: 500;"></p>
        
        <button id="indiaMapBtn" class="btn" style="width: 100%; margin-bottom: 16px; padding: 14px; font-size: 16px; background-color: #1f6feb; border-color: #1f6feb;" data-hi="‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§Æ‡•à‡§™" data-en="India Map">India Map</button>
        <button id="worldMapBtn" class="btn btn-secondary" style="width: 100%; padding: 14px; font-size: 16px;" data-hi="‡§µ‡§∞‡•ç‡§≤‡•ç‡§° ‡§Æ‡•à‡§™" data-en="World Map">World Map</button>
    </div>
</div>

<!-- NEW: INTERNAL BROWSER MODAL (IN-APP FULL SCREEN) -->
<div id="internalBrowserModal">
    <!-- Close Button (Absolute Top Right) -->
    <span class="close" id="closeInternalBrowser" style="position: absolute; top: 15px; right: 20px; z-index: 100; color: #fff; font-size: 40px; text-shadow: 0 0 10px #000; cursor: pointer; font-weight: 900;">&times;</span>
    
    <!-- Loader -->
    <div id="browserLoader" class="browser-loader"></div>

    <div class="modal-content">
        <!-- Iframe Normal View -->
        <iframe id="internalFrame" style="flex: 1; width: 100%; height: 100%; border: none; background-color: #fff; display: none;" src=""></iframe>
    </div>
</div>

<!-- NEW: MODAL FOR PER DAY TEST (Placeholder) -->
<div id="perDayTestModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <span class="close" id="closePerDayTestModal">&times;</span>
        <h2 style="color: #2ea043; margin-top:0; font-weight: 800;" data-hi="‡§Ü‡§ú ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏" data-en="Today's Practice">Today's Practice</h2>
        <p data-hi="‡§Ø‡§π ‡§´‡•Ä‡§ö‡§∞ ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã‡§ó‡§æ! ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•á ‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§¶‡•á ‡§∏‡§ï‡•á‡§Ç‡§ó‡•á‡•§" data-en="This feature is coming soon! You will be able to take your daily practice tests here." style="color: var(--muted); margin-bottom: 20px; font-weight: 500;"></p>
        <button class="btn" style="background-color: #2ea043; border-color: #2ea043;" onclick="document.getElementById('perDayTestModal').style.display='none'" data-hi="‡§†‡•Ä‡§ï ‡§π‡•à" data-en="Okay">Okay</button>
    </div>
</div>

<!-- NEW: MODAL FOR BOOKS (Coming Soon) -->
<div id="booksModal" class="modal">
    <div class="modal-content" style="text-align: center;">
        <span class="close" id="closeBooksModal">&times;</span>
        <h2 style="color: #d29922; margin-top:0; font-weight: 800;" data-hi="‡§´‡•ç‡§∞‡•Ä ‡§¨‡•Å‡§ï‡•ç‡§∏" data-en="Free Books">Free Books</h2>
        <p data-hi="‡§Ø‡§π ‡§´‡•Ä‡§ö‡§∞ ‡§Ö‡§≠‡•Ä ‡§ú‡§≤‡•ç‡§¶ ‡§Ü‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§π‡•à‡•§" data-en="This feature is coming soon." style="color: var(--muted); margin-bottom: 20px; font-size: 18px; font-weight: 600;"></p>
        <button class="btn" style="background-color: #d29922; border-color: #d29922;" onclick="document.getElementById('booksModal').style.display='none'" data-hi="‡§†‡•Ä‡§ï ‡§π‡•à" data-en="Okay">Okay</button>
    </div>
</div>

<!-- SUBJECT SELECTOR MODAL -->
<div id="subjectSelectorModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeSubjectModal">&times;</span>
        <h2 data-hi="‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç" data-en="Select Subject" style="margin-top:0; font-weight: 800;">Select Subject</h2>
        <p data-hi="‡§Ü‡§™ ‡§ï‡•å‡§® ‡§∏‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§™‡§¢‡§º‡§®‡•á ‡§ú‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?" data-en="Which subject are you going to study?" style="font-size:14px; color:var(--muted); margin-top:-10px; margin-bottom:20px; font-weight: 500;"></p>
        <div id="subjectListContainer">
            <!-- Subjects will be loaded here by JavaScript -->
        </div>
    </div>
</div>
<div id="adminModal" class="modal">
<div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
<span class="close" id="closeAdminModal">&times;</span>
<h2 data-hi="‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤" data-en="Admin Panel">Admin Panel</h2>
<p style="font-size:12px; color:var(--muted); font-weight: 500;" data-hi="‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç: ‡§ó‡§≤‡§§ JSON ‡§°‡•á‡§ü‡§æ ‡§ê‡§™ ‡§ï‡•ã ‡§§‡•ã‡§°‡§º ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§" data-en="Use with caution: Invalid JSON can break the app."></p>
<div class="admin-section">
<label data-hi="‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤‡•á‡§Ç" data-en="Change Admin Password">Change Admin Password</label>
<input type="password" id="newPassword" placeholder="Enter new password">
<button id="changePasswordBtn" class="btn btn-secondary" style="margin-top: 8px; width: 100%;">Change Password</button>
</div>
<div class="admin-section">
<label data-hi="‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§°‡•á‡§ü‡§æ (JSON)" data-en="Profile Data (JSON)">Profile Data (JSON)</label>
<textarea id="adminProfileData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="‡§∏‡•ç‡§≤‡•â‡§ü‡•ç‡§∏ ‡§°‡•á‡§ü‡§æ (JSON)" data-en="Slots Data (JSON)">Slots Data (JSON)</label>
<textarea id="adminSlotsData" rows="6" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ‡§¶‡§æ‡§Ø‡§ï ‡§ï‡•ã‡§ü‡•ç‡§∏ (JSON)" data-en="Motivational Quotes (JSON)">Motivational Quotes (JSON)</label>
<textarea id="adminQuotesData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="‡§ë‡§°‡§ø‡§Ø‡•ã ‡§°‡•á‡§ü‡§æ (JSON)" data-en="Audio Data (JSON)">Audio Data (JSON)</label>
<textarea id="adminAudioData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
<p style="font-size:11px; color:var(--muted); margin-top:4px;" data-hi="‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü: [{&quot;name&&quot;:&quot;...&quot;, &quot;url&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]" data-en="Format: [{&quot;name&quot;:&quot;...&quot;, &quot;url&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]"></p>
<div class="admin-add-form">
<input type="text" id="newAudioName" placeholder="Track Name">
<input type="url" id="newAudioUrl" placeholder="Audio URL">
<input type="url" id="newAudioImageUrl" placeholder="Image URL">
<button id="addAudioTrack" class="btn btn-secondary">Add Track</button>
</div>
</div>
<!-- NEW STUDY APP SECTION -->
<div class="admin-section">
    <label style="margin-top:12px;" data-hi="‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ê‡§™‡•ç‡§∏ ‡§°‡•á‡§ü‡§æ (JSON)" data-en="Study Apps Data (JSON)">Study Apps Data (JSON)</label>
    <textarea id="adminAppsData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
    <p style="font-size:11px; color:var(--muted); margin-top:4px;" data-hi="‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü: [{&quot;name&quot;:&quot;...&quot;, &quot;linkUrl&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]" data-en="Format: [{&quot;name&quot;:&quot;...&quot;, &quot;linkUrl&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]"></p>
    <div class="admin-add-form">
        <input type="text" id="newAppName" placeholder="App Name">
        <input type="url" id="newAppUrl" placeholder="App Link URL">
        <input type="url" id="newAppImageUrl" placeholder="Image URL">
        <button id="addStudyApp" class="btn btn-secondary">Add App</button>
    </div>
</div>
<div class="row" style="margin-top:16px;">
<button id="adminSaveBtn" class="btn" data-hi="‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç" data-en="Save Data">Save Data</button>
<button id="adminResetBtn" class="btn btn-danger" data-hi="‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç" data-en="Reset Everything">Reset Everything</button>
</div>
</div>
</div>

<!-- UPCOMING FEATURES MODAL -->
<div id="updateDetailsModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeUpdateModal">&times;</span>
        <h2 style="margin-top:0; font-weight: 800;">‡§®‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü: ‡§∏‡•ç‡§™‡•Ä‡§ö-‡§ü‡•Ç-‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡•ç‡§∏</h2>
        <p style="font-weight: 500;">
            ‡§π‡§Æ ‡§è‡§ï ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§®‡§è ‡§´‡•Ä‡§ö‡§∞ ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•ã ‡§î‡§∞ ‡§≠‡•Ä ‡§Ü‡§∏‡§æ‡§® ‡§¨‡§®‡§æ ‡§¶‡•á‡§ó‡§æ! ‡§¨‡§π‡•Å‡§§ ‡§ú‡§≤‡•ç‡§¶ ‡§ê‡§™ ‡§Æ‡•á‡§Ç <strong>'‡§∏‡•ç‡§™‡•Ä‡§ö-‡§ü‡•Ç-‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü'</strong> ‡§ï‡§æ ‡§ë‡§™‡•ç‡§∂‡§® ‡§Ü‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§π‡•à‡•§
        </p>
        <p style="font-weight: 500;">
            <strong>‡§Ø‡§π ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ?</strong>
            <br>
            ‡§ú‡§¨ ‡§Ü‡§™ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ê‡§™ (‡§ú‡•à‡§∏‡•á YouTube, Khan Sir, ‡§Ü‡§¶‡§ø) ‡§ñ‡•ã‡§≤‡§ï‡§∞ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•ã‡§Ç‡§ó‡•á, ‡§§‡•ã ‡§Ü‡§™ ‡§π‡§Æ‡§æ‡§∞‡•á ‡§á‡§∏ ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•ã ‡§ë‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§¶, ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§Æ‡•á‡§Ç ‡§ú‡•ã ‡§≠‡•Ä ‡§™‡§¢‡§º‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§â‡§∏‡•á ‡§∏‡•Å‡§®‡§ï‡§∞ ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤ ‡§¶‡•á‡§ó‡§æ ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§®‡•ã‡§ü ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞ ‡§¶‡•á‡§ó‡§æ‡•§
        </p>
        <p style="font-weight: 700; color: var(--accent);">
            ‡§Ö‡§¨ ‡§Ü‡§™‡§ï‡•ã ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§ö‡§ø‡§Ç‡§§‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§™‡§°‡§º‡•á‡§ó‡•Ä‡•§ ‡§¨‡§∏ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•á ‡§∏‡•Å‡§®‡•á‡§Ç, ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡§æ ‡§ï‡§æ‡§Æ ‡§π‡§Æ ‡§™‡§∞ ‡§õ‡•ã‡§°‡§º ‡§¶‡•á‡§Ç!
        </p>
    </div>
</div>

<!-- NEW: ABOUT US MODAL -->
<div id="aboutModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeAboutModal">&times;</span>
        <h2 data-hi="‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç" data-en="About Us" style="margin-top:0; font-weight: 800;">About Us</h2>
        <p data-hi="Indian Routine ‡§ê‡§™ ‡§ï‡•ã ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§î‡§∞ ‡§™‡•á‡§∂‡•á‡§µ‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§è‡§ï‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§∏‡•á ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§µ‡•á ‡§Ö‡§™‡§®‡•á ‡§∏‡§¨‡§∏‡•á ‡§ï‡•Ä‡§Æ‡§§‡•Ä ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® - ‡§∏‡§Æ‡§Ø - ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§Ç‡•§" data-en="Indian Routine is built with the sole purpose of helping students and professionals in India manage their most precious resource - time." style="font-weight: 500;">
        </p>
        <p data-hi="‡§π‡§Æ‡§æ‡§∞‡§æ ‡§Æ‡§æ‡§®‡§®‡§æ ‡§π‡•à ‡§ï‡§ø ‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§∏‡§Ç‡§∞‡§ö‡§ø‡§§ ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§ï‡§§‡§æ ‡§î‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§π‡•à‡•§ ‡§π‡§Æ‡§æ‡§∞‡§æ AI-‡§™‡§æ‡§µ‡§∞‡•ç‡§° ‡§∞‡•Ç‡§ü‡•Ä‡§® ‡§ú‡•á‡§®‡§∞‡•á‡§ü‡§∞ ‡§Ü‡§™‡§ï‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§‡•ã‡§Ç ‡§ï‡•á ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§∏‡•á ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§ö‡§æ‡§π‡•á ‡§Ü‡§™ ‡§è‡§ï ‡§ï‡§†‡§ø‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•ã‡§Ç ‡§Ø‡§æ ‡§ï‡§æ‡§Æ ‡§î‡§∞ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∏‡§Ç‡§§‡•Å‡§≤‡§® ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•ã‡§Ç‡•§" data-en="We believe that a well-structured routine is the key to productivity and success. Our AI-powered routine generator is designed to create a personalized schedule tailored to your needs, whether you're preparing for a tough exam or balancing between a job and studies." style="font-weight: 500;">
        </p>
        <p data-hi="‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§≠‡§æ‡§ó‡•Ä‡§¶‡§æ‡§∞ ‡§¨‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ ‡§Ø‡§π‡§æ‡§Ç ‡§π‡•à‡§Ç‡•§" data-en="We are here to be your partner in your journey to success." style="font-weight: 500;">
        </p>
    </div>
</div>

<!-- NEW: PRIVACY POLICY MODAL -->
<div id="privacyModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closePrivacyModal">&times;</span>
        <h2 data-hi="‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§®‡•Ä‡§§‡§ø" data-en="Privacy Policy" style="margin-top:0; font-weight: 800;">Privacy Policy</h2>
        <p data-hi="‡§Ü‡§™‡§ï‡•Ä ‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§π‡§Æ‡§æ‡§∞‡•á ‡§≤‡§ø‡§è ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§" data-en="Your privacy is important to us." style="font-weight: 600;">
        </p>
        <strong data-hi="‡§°‡•á‡§ü‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§î‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó" data-en="Data Collection and Usage" style="font-weight: 700;"></strong>
        <p data-hi="Indian Routine ‡§Ü‡§™‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡•Ä ‡§ó‡§à ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ú‡•à‡§∏‡•á ‡§®‡§æ‡§Æ, ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§µ‡§ø‡§∑‡§Ø ‡§î‡§∞ ‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§µ‡§∞‡•Ä‡§Ø‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§è‡§ï‡§§‡•ç‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏ ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§î‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§" data-en="Indian Routine collects information you provide, such as name, exam name, subjects, and schedule preferences. This data is used solely to create a personalized routine and user experience for you." style="font-weight: 500;">
        </p>
        <strong data-hi="‡§°‡•á‡§ü‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§£" data-en="Data Storage" style="font-weight: 700;"></strong>
        <p data-hi="‡§∏‡§≠‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§°‡•á‡§ü‡§æ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§™‡§∞ ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á (Local Storage ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á) ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§π‡§Æ‡§æ‡§∞‡•á ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡•á‡§∑‡§ø‡§§ ‡§Ø‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ‡§ï‡§ø ‡§Ü‡§™‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§Ü‡§™‡§ï‡•á ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§π‡•à‡•§" data-en="All personal data is stored locally on your device (using Local Storage). It is not transmitted or stored on our servers. This means your data is completely under your control." style="font-weight: 500;">
        </p>
        <strong data-hi="‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§ù‡§æ‡§ï‡§∞‡§£" data-en="Data Sharing" style="font-weight: 700;"></strong>
        <p data-hi="‡§π‡§Æ ‡§Ü‡§™‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§§‡•Ä‡§∏‡§∞‡•á ‡§™‡§ï‡•ç‡§∑ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§Ø‡§æ ‡§¨‡•á‡§ö‡§§‡•á ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§" data-en="We do not share or sell your personal information with any third parties." style="font-weight: 500;">
        </p>
        <strong data-hi="‡§§‡•É‡§§‡•Ä‡§Ø-‡§™‡§ï‡•ç‡§∑ ‡§∏‡•á‡§µ‡§æ‡§è‡§Å" data-en="Third-Party Services" style="font-weight: 700;"></strong>
        <p data-hi="‡§ê‡§™ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç (‡§ú‡•à‡§∏‡•á ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ê‡§™‡•ç‡§∏, AI ‡§ö‡•à‡§ü) ‡§ï‡•á ‡§≤‡§ø‡§Ç‡§ï ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§® ‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§Ö‡§™‡§®‡•Ä ‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§®‡•Ä‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§π‡•à‡§Ç, ‡§î‡§∞ ‡§π‡§Æ ‡§â‡§®‡§ï‡•á ‡§™‡•ç‡§∞‡§•‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§" data-en="The app may contain links to external services (like study apps, AI chats). These services have their own privacy policies, and we are not responsible for their practices." style="font-weight: 500;">
        </p>
    </div>
</div>

<!-- NEW: DISCLAIMER MODAL -->
<div id="disclaimerModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeDisclaimerModal">&times;</span>
        <h2 data-hi="‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£" data-en="Disclaimer" style="margin-top:0; font-weight: 800;">Disclaimer</h2>
        <p data-hi="Indian Routine ‡§ê‡§™ ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•Ç‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§î‡§∞ ‡§∂‡•à‡§ï‡•ç‡§∑‡§ø‡§ï ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§â‡§™‡§ï‡§∞‡§£ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§" data-en="The Indian Routine app is provided as a tool for informational and educational purposes only." style="font-weight: 500;">
        </p>
        <p data-hi="AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§î‡§∞ ‡§∞‡§£‡§®‡•Ä‡§§‡§ø‡§Ø‡§æ‡§Å ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§µ‡§ø‡§µ‡•á‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡•Ä ‡§ó‡§à ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§Ö‡§™‡§®‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§" data-en="The routines and strategies generated by the AI are suggestions and do not guarantee success. Users should use their own discretion and adapt the provided routine to their specific needs." style="font-weight: 500;">
        </p>
        <p data-hi="‡§ê‡§™ ‡§ï‡•á ‡§°‡•á‡§µ‡§≤‡§™‡§∞‡•ç‡§∏ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡•Ä ‡§ó‡§à ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§∏‡•á ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§§‡•ç‡§§‡§∞‡§¶‡§æ‡§Ø‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§™‡§®‡•Ä ‡§™‡§¢‡§º‡§æ‡§à ‡§î‡§∞ ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞ ‡§π‡•à‡§Ç‡•§" data-en="The developers of the app are not liable for any outcomes resulting from the use of the information provided. You are solely responsible for your own studies and career." style="font-weight: 500;">
        </p>
    </div>
</div>

<!-- NEW: Voice Answer Modal (For Direct Answers) -->
<div id="voiceAnswerModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('voiceAnswerModal').style.display='none'">&times;</span>
        <h2 style="color:var(--accent);">Answer</h2>
        <img id="voiceAnswerImg" src="" alt="Result Image">
        <div id="voiceAnswerText"></div>
        <button class="btn" style="width:100%; margin-top:16px;" onclick="document.getElementById('voiceAnswerModal').style.display='none'">Okay</button>
    </div>
</div>

<!-- SUPER INTELLIGENT VOICE FAB -->
<div id="voiceFab" onclick="initVoiceAssistant()">üéôÔ∏è</div>
<div id="voiceStatus">Ready</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
// --- GLOBAL STATE & UTILITIES ---
let currentLang = localStorage.getItem('smart_lang') || 'en';
let timeFormat = localStorage.getItem('smart_time_format') || '12h';
let slotsData = [];
const FOCUS_EXTRA_MINUTES = 45; // Extra time for focus subject

// === DATA: DEFAULT SUBJECTS FOR CLASSES (Fixed Encoding) ===
const defaultSubjects = {
    '9': "‡§π‡§ø‡§Ç‡§¶‡•Ä\n‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä\n‡§ó‡§£‡§ø‡§§\n‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ö‡§ø‡§§‡•ç‡§∞‡§ï‡§≤‡§æ",
    '10': "‡§π‡§ø‡§Ç‡§¶‡•Ä\n‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä\n‡§ó‡§£‡§ø‡§§\n‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ö‡§ø‡§§‡•ç‡§∞‡§ï‡§≤‡§æ",
    '11': "‡§π‡§ø‡§Ç‡§¶‡•Ä\n‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä\n‡§≠‡•å‡§§‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§∞‡§∏‡§æ‡§Ø‡§® ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ú‡•Ä‡§µ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ó‡§£‡§ø‡§§",
    '12': "‡§π‡§ø‡§Ç‡§¶‡•Ä\n‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä\n‡§≠‡•å‡§§‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§∞‡§∏‡§æ‡§Ø‡§® ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ú‡•Ä‡§µ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®\n‡§ó‡§£‡§ø‡§§"
};

// === NEW: SLIDER DATA (CLASS 9 SPECIFIC) ===
const subjectsData = [
    { name: 'Hindi', img: 'https://files.catbox.moe/ttvifz.png', type: 'direct' },
    { name: 'English', img: 'https://files.catbox.moe/l5she6.png', type: 'direct' },
    { name: 'Math', img: 'https://files.catbox.moe/gy53m3.png', type: 'direct' },
    { name: 'Science', img: 'https://files.catbox.moe/feecgi.png', type: 'popup' }, // Popup Trigger
    { name: 'Social Science', img: 'https://files.catbox.moe/wfej48.png', type: 'direct' },
    { name: 'Drawing', img: 'https://files.catbox.moe/tkt6k8.png', type: 'direct' },
    { name: 'AI Class', img: 'https://files.catbox.moe/rno8sr.png', type: 'direct' }
];

// === NEW: SCIENCE MODAL DATA ===
const scienceSubjects = [
    { name: 'Physics', img: 'https://files.catbox.moe/wq5onz.png' },
    { name: 'Chemistry', img: 'https://files.catbox.moe/2j7b6q.png' },
    { name: 'Biology', img: 'https://files.catbox.moe/qi80ps.png' }
];

// ==========================================

const $ = (id) => document.getElementById(id);
const $$ = (sel) => document.querySelectorAll(sel);
const timeToMinutes = t => { if(!t) return 0; const [h, m] = t.split(':').map(Number); return h * 60 + m; };
const minutesToTime = m => { m = ((m % 1440) + 1440) % 1440; return String(Math.floor(m / 60)).padStart(2, '0') + ':' + String(m % 60).padStart(2, '0'); };
const daysBetween = (d1, d2) => { if (!d1 || !d2) return 0; return Math.max(1, Math.round((new Date(d2) - new Date(d1)) / (1000 * 60 * 60 * 24)));};
const getBilingualText = (en, hi) => { if (currentLang === 'hi') return hi; if (currentLang === 'en') return en; return `${en} ‚Äî ${hi}`; };
const formatTime = (time24) => { if (timeFormat === '24h' || !time24) return time24; const [h, m] = time24.split(':'); const hour = parseInt(h, 10); const suffix = hour >= 12 ? 'PM' : 'AM'; const hour12 = hour % 12 || 12; return `${String(hour12).padStart(2, '0')}:${m} ${suffix}`; };
const defaultSlots = (exam = 'Study', activity = 'Duty') => [
{ id: 'wake', label_en: 'Wake Up', label_hi: '‡§â‡§†‡§®‡§æ', time: '04:30', msg_hi: `‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§!`, msg_en: `Good morning!`, tip_hi: '‡§è‡§ï ‡§ó‡§ø‡§≤‡§æ‡§∏ ‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç‡•§', tip_en: 'Drink a glass of water.' },
{ id: 'morning_study', label_en: 'Morning Study', label_hi: '‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§™‡§¢‡§º‡§æ‡§à', time: '04:45', msg_hi: '‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•à‡•§', msg_en: 'Time for morning study.', tip_hi: '‡§∏‡§¨‡§∏‡•á ‡•õ‡§∞‡•Ç‡§∞‡•Ä ‡§ï‡§æ‡§Æ ‡§™‡§π‡§≤‡•á ‡§ï‡§∞‡•á‡§Ç‡•§', tip_en: 'Do the most important task first.' },
{ id: 'leave', label_en: `Leave for ${activity}`, label_hi: `${activity} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§ï‡§≤‡§®‡§æ`, time: '05:30', msg_hi: `‡§Ö‡§¨ ${activity} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§ï‡§≤‡•ã`, msg_en: `Leave for ${activity} now`, tip_hi: '‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§ú‡§æ‡§Ç‡§ö ‡§≤‡•á‡§Ç‡•§', tip_en: 'Check everything.' },
{ id: 'duty_start', label_en: `${activity} Start`, label_hi: `${activity} ‡§∂‡•Å‡§∞‡•Ç`, time: '06:00', msg_hi: `${activity} ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã ‡§ó‡§à ‡§π‡•à`, msg_en: `${activity} has started`, tip_hi: '‡§´‡•ã‡§ï‡§∏ ‡§∞‡§π‡•á‡§Ç‡•§', tip_en: 'Stay focused.' },
{ id: 'duty_end', label_en: `${activity} End`, label_hi: `${activity} ‡§ñ‡§§‡•ç‡§Æ`, time: '15:00', msg_hi: `${activity} ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à`, msg_en: `${activity} is finished`, tip_hi: '‡§•‡•ã‡§°‡§º‡§æ ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§', tip_en: 'Take some rest.' },
{ id: 'home', label_en: 'Reach Home', label_hi: '‡§ò‡§∞ ‡§µ‡§æ‡§™‡§∏‡•Ä', time: '15:30', msg_hi: `‡§ò‡§∞ ‡§™‡§π‡•Å‡§Å‡§ö ‡§ó‡§è, ‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•ã`, msg_en: `Reached home, take rest`, tip_hi: '10 ‡§Æ‡§ø‡§®‡§ü ‡§∞‡§ø‡§≤‡•à‡§ï‡•ç‡§∏ ‡§ï‡§∞‡•ã‡•§', tip_en: 'Relax for 10 min.' },
{ id: 'nap', label_en: 'Power Nap', label_hi: '‡§™‡§æ‡§µ‡§∞ ‡§®‡•à‡§™', time: '16:00', msg_hi: '‡§™‡§æ‡§µ‡§∞ ‡§®‡•à‡§™ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•à', msg_en: 'Time for a power nap', tip_hi: '‡§è‡§ï ‡§õ‡•ã‡§ü‡•Ä ‡§®‡•à‡§™ ‡§§‡§æ‡§ú‡§ó‡•Ä ‡§¶‡•á‡§ó‡•Ä‡•§', tip_en: 'A short nap will refresh you.' },
{ id: 'main_study', label_en: 'Main Study', label_hi: '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡§¢‡§º‡§æ‡§à', time: '17:00', msg_hi: `‡§Ö‡§¨ ${exam} ‡§ï‡•Ä ‡§™‡§¢‡§º‡§æ‡§à ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•ã`, msg_en: `Start your ${exam} study`, tip_hi: '‡§∏‡§¨‡§∏‡•á ‡§ï‡§†‡§ø‡§® ‡§µ‡§ø‡§∑‡§Ø ‡§™‡§π‡§≤‡•á ‡§™‡§¢‡§º‡•á‡§Ç‡•§', tip_en: 'Study the hardest subject first.' },
{ id: 'break', label_en: 'Break', label_hi: '‡§¨‡•ç‡§∞‡•á‡§ï', time: '19:00', msg_hi: '‡§•‡•ã‡§°‡§º‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï ‡§≤‡•ã', msg_en: 'Take a short break', tip_hi: '‡§ü‡§π‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§∏‡§Ç‡§ó‡•Ä‡§§ ‡§∏‡•Å‡§®‡•á‡§Ç‡•§', tip_en: 'Walk or listen to music.' },
{ id: 'practice', label_en: 'Practice', label_hi: '‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏', time: '19:30', msg_hi: `‡§Ö‡§¨ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•ã`, msg_en: `Time for practice`, tip_hi: '‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§', tip_en: 'Solve problems.' },
{ id: 'current_affairs', label_en: 'Current Affairs', label_hi: '‡§ï‡§∞‡§Ç‡§ü ‡§Ö‡§´‡•á‡§Ø‡§∞‡•ç‡§∏', time: '20:30', msg_hi: `‡§Ö‡§¨ ‡§ï‡§∞‡§Ç‡§ü ‡§Ö‡§´‡•á‡§Ø‡§∞‡•ç‡§∏ ‡§™‡§¢‡§º‡•ã`, msg_en: `Read Current Affairs`, tip_hi: '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§¨‡§ø‡§Ç‡§¶‡•Å‡§ì‡§Ç ‡§ï‡•á ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§¨‡§®‡§æ‡§è‡§Ç‡•§', tip_en: 'Make notes of the main points.' },
{ id: 'dinner', label_en: 'Dinner', label_hi: '‡§°‡§ø‡§®‡§∞', time: '21:00', msg_hi: '‡§°‡§ø‡§®‡§∞ ‡§ï‡§∞‡•ã', msg_en: 'Have dinner', tip_hi: '‡§π‡§≤‡•ç‡§ï‡§æ ‡§≠‡•ã‡§ú‡§® ‡§ï‡§∞‡•á‡§Ç‡•§', tip_en: 'Have a light meal.' },
{ id: 'sleep', label_en: 'Sleep', label_hi: '‡§∏‡•ã‡§®‡§æ', time: '22:00', msg_hi: '‡§∏‡•ã‡§®‡•á ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡§∞‡•ã', msg_en: 'Time to sleep', tip_hi: '‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§®‡•Ä‡§Ç‡§¶ ‡§≤‡•á‡§Ç‡•§', tip_en: 'Get a good sleep.' }
];

const getProfile = () => JSON.parse(localStorage.getItem('smart_profile') || '{"occupation":"duty"}');
const loadSlotsData = () => {
try {
const s = JSON.parse(localStorage.getItem('smart_slots') || '[]');
const p = getProfile();
if (Array.isArray(s) && s.length > 0) slotsData = s;
else slotsData = defaultSlots(p.exam, p.activityLabel);
} catch (e) {
slotsData = defaultSlots();
}
};
const saveSlotsData = () => localStorage.setItem('smart_slots', JSON.stringify(slotsData));

// ====================================================================================
// ==================== INITIALIZE ALL APP DATA (INCLUDES STUDY APPS) =================
// ====================================================================================
const initializeData = () => {
    if (!localStorage.getItem('smart_audio')) {
        const defaultAudio = [{ name: "Select Audio", url: "", imageUrl: "" }, { name: "Chanakya Motivation", url: "https://www.soundjay.com/buttons/sounds/button-7.mp3", imageUrl: "https://i.pravatar.cc/150?u=chanakya" }];
        localStorage.setItem('smart_audio', JSON.stringify(defaultAudio));
    }
    if (!localStorage.getItem('admin_password')) {
        localStorage.setItem('admin_password', 'admin123');
    }

    // --- NEW: STUDY APPS VERSIONING TO FORCE UPDATE ---
    const STUDY_APPS_VERSION = 'v1.6'; // Increment this to force an update
    const currentAppsVersion = localStorage.getItem('study_apps_version');

    if (currentAppsVersion !== STUDY_APPS_VERSION) {
        const defaultStudyApps = [
            { name: 'RWA', imageUrl: 'https://i.postimg.cc/VNRFGLwr/Picsart-25-10-22-01-32-21-033.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.appx.rojgar_with_ankit' },
            { name: 'Khan Sir', imageUrl: 'https://i.postimg.cc/pVg1nrLK/Picsart-25-10-22-01-31-29-127.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=xyz.penpencil.khansirofficial' },
            { name: 'YouTube', imageUrl: 'https://files.catbox.moe/jigd74.jpg', linkUrl: 'https://www.youtube.com/' },
            { name: 'Physics Wallah', imageUrl: 'https://files.catbox.moe/06xp1d.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.physicswallah' },
            { name: 'Unacademy', imageUrl: 'https://files.catbox.moe/ojffup.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.unacademyapp' },
            { name: "BYJU'S", imageUrl: 'https://files.catbox.moe/bs29n1.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.byjus.thelearningapp' },
            { name: 'Adda247', imageUrl: 'https://files.catbox.moe/0y2ncj.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.adda247.app' },
            { name: 'Testbook', imageUrl: 'https://files.catbox.moe/zgrt4n.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.testbook.tbapp' },
            { name: 'Vedantu', imageUrl: 'https://files.catbox.moe/5o5cr2.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.vedantu.app' },
            { name: 'Drishti IAS', imageUrl: 'https://files.catbox.moe/lcpkq0.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.drishti.academy.app' },
            { name: 'Exampur', imageUrl: 'https://files.catbox.moe/w626y1.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.edudrive.exampur' },
            { name: 'Telegram', imageUrl: 'https://files.catbox.moe/tw54tx.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=org.telegram.messenger' },
            { name: 'Utkarsh', imageUrl: 'https://files.catbox.moe/nqsugs.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.utkarsh.app' },
            { name: 'Study IQ', imageUrl: 'https://files.catbox.moe/b02dfi.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.studyiq.android' }
        ];
        localStorage.setItem('smart_study_apps', JSON.stringify(defaultStudyApps));
        localStorage.setItem('study_apps_version', STUDY_APPS_VERSION);
    }
};

// --- DEEP GK FACT ENGINE LOGIC ---
const fetchDeepFact = async () => {
    const titleEl = document.getElementById('factTitle');
    const textEl = document.getElementById('factText');
    const shareBtn = document.getElementById('shareFactBtn');
    const nextBtn = document.getElementById('nextFactBtn');

    // Loading State
    titleEl.textContent = "Loading...";
    textEl.textContent = "Fetching new knowledge...";
    nextBtn.disabled = true;

    // List of Ancient Indian Kings, Dynasties, and Historical Topics
    const ancientHistoryTopics = [
        "‡§ö‡§Ç‡§¶‡•ç‡§∞‡§ó‡•Å‡§™‡•ç‡§§_‡§Æ‡•å‡§∞‡•ç‡§Ø", "‡§¨‡§ø‡§®‡•ç‡§¶‡•Å‡§∏‡§æ‡§∞", "‡§Ö‡§∂‡•ã‡§ï", "‡§∂‡•Å‡§Ç‡§ó_‡§µ‡§Ç‡§∂", "‡§ï‡§£‡•ç‡§µ_‡§µ‡§Ç‡§∂", "‡§∏‡§æ‡§§‡§µ‡§æ‡§π‡§®_‡§µ‡§Ç‡§∂", 
        "‡§ï‡•Å‡§∑‡§æ‡§£_‡§∏‡§æ‡§Æ‡•ç‡§∞‡§æ‡§ú‡•ç‡§Ø", "‡§ï‡§®‡§ø‡§∑‡•ç‡§ï", "‡§ó‡•Å‡§™‡•ç‡§§_‡§∏‡§æ‡§Æ‡•ç‡§∞‡§æ‡§ú‡•ç‡§Ø", "‡§∏‡§Æ‡•Å‡§¶‡•ç‡§∞‡§ó‡•Å‡§™‡•ç‡§§", "‡§ö‡§®‡•ç‡§¶‡•ç‡§∞‡§ó‡•Å‡§™‡•ç‡§§_‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø", 
        "‡§π‡§∞‡•ç‡§∑‡§µ‡§∞‡•ç‡§ß‡§®", "‡§ö‡§æ‡§≤‡•Å‡§ï‡•ç‡§Ø_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§™‡§≤‡•ç‡§≤‡§µ_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§ö‡•ã‡§≤_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§∞‡§æ‡§ú‡§∞‡§æ‡§ú_‡§ö‡•ã‡§≤_‡•ß", 
        "‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞‡§ï‡•Ç‡§ü_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§™‡§æ‡§≤_‡§∏‡§æ‡§Æ‡•ç‡§∞‡§æ‡§ú‡•ç‡§Ø", "‡§ó‡•Å‡§∞‡•ç‡§ú‡§∞-‡§™‡•ç‡§∞‡§§‡§ø‡§π‡§æ‡§∞_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§∏‡•á‡§®_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§ö‡•å‡§π‡§æ‡§®_‡§µ‡§Ç‡§∂", "‡§™‡•É‡§•‡•ç‡§µ‡•Ä‡§∞‡§æ‡§ú_‡§ö‡•å‡§π‡§æ‡§®", "‡§§‡•ã‡§Æ‡§∞_‡§µ‡§Ç‡§∂", "‡§ó‡§π‡§°‡§º‡§µ‡§æ‡§≤_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§™‡§∞‡§Æ‡§æ‡§∞_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§∏‡•ã‡§≤‡§Ç‡§ï‡•Ä_‡§µ‡§Ç‡§∂", "‡§ö‡§Ç‡§¶‡•á‡§≤_‡§µ‡§Ç‡§∂", "‡§ï‡§≤‡§ö‡•Å‡§∞‡•Ä_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§∏‡§ø‡§∏‡•ã‡§¶‡§ø‡§Ø‡§æ_‡§µ‡§Ç‡§∂", "‡§ó‡•Å‡§π‡§ø‡§≤_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§¨‡§™‡•ç‡§™‡§æ_‡§∞‡§æ‡§µ‡§≤", "‡§∞‡§æ‡§£‡§æ_‡§ï‡•Å‡§Ç‡§≠‡§æ", "‡§∞‡§æ‡§£‡§æ_‡§∏‡§æ‡§Ç‡§ó‡§æ", "‡§Æ‡§π‡§æ‡§∞‡§æ‡§£‡§æ_‡§™‡•ç‡§∞‡§§‡§æ‡§™", "‡§µ‡§ø‡§ú‡§Ø‡§®‡§ó‡§∞_‡§∏‡§æ‡§Æ‡•ç‡§∞‡§æ‡§ú‡•ç‡§Ø", 
        "‡§ï‡•É‡§∑‡•ç‡§£‡§¶‡•á‡§µ‡§∞‡§æ‡§Ø", "‡§ï‡§æ‡§ï‡§§‡•Ä‡§Ø_‡§µ‡§Ç‡§∂", "‡§π‡•ã‡§Ø‡§∏‡§≤_‡§µ‡§Ç‡§∂", "‡§Ø‡§æ‡§¶‡§µ_‡§µ‡§Ç‡§∂", "‡§™‡§æ‡§Ç‡§°‡•ç‡§Ø_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§ö‡•á‡§∞_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§ñ‡§æ‡§∞‡§µ‡•á‡§≤", "‡§ï‡§≤‡§ø‡§Ç‡§ó", "‡§Æ‡§π‡§æ‡§Æ‡•á‡§ò‡§µ‡§æ‡§π‡§®_‡§µ‡§Ç‡§∂", "‡§µ‡§æ‡§ï‡§æ‡§ü‡§ï_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§á‡§ï‡•ç‡§∑‡•ç‡§µ‡§æ‡§ï‡•Å_‡§µ‡§Ç‡§∂", "‡§ï‡§¶‡§Ç‡§¨_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§ó‡§Ç‡§ó_‡§µ‡§Ç‡§∂", "‡§™‡§∂‡•ç‡§ö‡§ø‡§Æ‡•Ä_‡§ó‡§Ç‡§ó_‡§µ‡§Ç‡§∂", "‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä_‡§ó‡§Ç‡§ó_‡§µ‡§Ç‡§∂", 
        "‡§Æ‡•à‡§§‡•ç‡§∞‡§ï_‡§µ‡§Ç‡§∂", "‡§™‡•Å‡§∑‡•ç‡§Ø‡§≠‡•Ç‡§§‡§ø_‡§µ‡§Ç‡§∂", "‡§Æ‡•å‡§ñ‡§∞‡§ø_‡§µ‡§Ç‡§∂", "‡§π‡§∞‡•ç‡§Ø‡§ï_‡§µ‡§Ç‡§∂", "‡§∂‡§ø‡§∂‡•Å‡§®‡§æ‡§ó_‡§µ‡§Ç‡§∂", 
        "‡§®‡§®‡•ç‡§¶_‡§µ‡§Ç‡§∂", "‡§Æ‡§π‡§æ‡§™‡§¶‡•ç‡§Æ‡§®‡§®‡•ç‡§¶", "‡§ò‡§®‡§æ‡§®‡§®‡•ç‡§¶", "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞_‡§Æ‡§π‡§æ‡§®", "‡§™‡•ã‡§∞‡§∏", "‡§Ö‡§Ç‡§¨‡•Ä", "‡§Ö‡§≠‡§ø‡§∏‡§æ‡§∞", 
        "‡§≤‡§≤‡§ø‡§§‡§æ‡§¶‡§ø‡§§‡•ç‡§Ø_‡§Æ‡•Å‡§ï‡•ç‡§§‡§æ‡§™‡•Ä‡§°‡§º", "‡§ï‡§∞‡•ç‡§ï‡•ã‡§ü_‡§µ‡§Ç‡§∂", "‡§â‡§§‡•ç‡§™‡§≤_‡§µ‡§Ç‡§∂", "‡§≤‡•ã‡§π‡§æ‡§∞_‡§µ‡§Ç‡§∂", "‡§µ‡§∞‡•ç‡§Æ‡§®_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", 
        "‡§Ö‡§π‡•ã‡§Æ_‡§∞‡§æ‡§ú‡§µ‡§Ç‡§∂", "‡§Æ‡§æ‡§£‡§ø‡§ï‡•ç‡§Ø_‡§µ‡§Ç‡§∂", "‡§∏‡§ø‡§Ç‡§ß‡•Å_‡§ò‡§æ‡§ü‡•Ä_‡§∏‡§≠‡•ç‡§Ø‡§§‡§æ", "‡§µ‡•à‡§¶‡§ø‡§ï_‡§∏‡§≠‡•ç‡§Ø‡§§‡§æ", "‡§Æ‡§π‡§æ‡§ú‡§®‡§™‡§¶"
    ];

    try {
        let apiUrl;
        if (Math.random() < 0.85) {
            const randomTopic = ancientHistoryTopics[Math.floor(Math.random() * ancientHistoryTopics.length)];
            apiUrl = `https://hi.wikipedia.org/api/rest_v1/page/summary/${randomTopic}`;
        } else {
            apiUrl = 'https://hi.wikipedia.org/api/rest_v1/page/random/summary';
        }

        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("API Failed");
        const data = await response.json();

        const title = data.title;
        let summary = data.extract;
        const sentences = summary.split('‡•§');
        if (sentences.length > 2) {
            summary = sentences.slice(0, 2).join('‡•§') + '‡•§';
        }

        titleEl.textContent = title;
        textEl.textContent = summary;

        shareBtn.onclick = () => {
            const shareText = `‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§™‡§§‡§æ ‡§π‡•à? ${title}: ${summary}\n\n‡§î‡§∞ ‡§ó‡§π‡§∞‡§æ‡§à ‡§∏‡•á ‡§ú‡§æ‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Indian Routine App ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§`;
            const url = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
            window.open(url, '_blank');
        };

    } catch (error) {
        try {
             const fallbackResponse = await fetch('https://hi.wikipedia.org/api/rest_v1/page/random/summary');
             const fallbackData = await fallbackResponse.json();
             titleEl.textContent = fallbackData.title;
             textEl.textContent = fallbackData.extract.split('‡•§').slice(0, 2).join('‡•§') + '‡•§';
        } catch (e) {
             titleEl.textContent = "Network Error";
             textEl.textContent = "Could not fetch fact. Please check your internet connection.";
        }
    } finally {
        nextBtn.disabled = false;
    }
};

// --- NEW: SAVE FACT LOGIC ---
const saveFact = () => {
    const titleEl = document.getElementById('factTitle');
    const textEl = document.getElementById('factText');
    const title = titleEl.textContent;
    const text = textEl.textContent;
    if (title === "Loading..." || title === "Network Error") return; 
    let savedHistory = JSON.parse(localStorage.getItem('user_saved_history') || '[]');
    if (!savedHistory.some(fact => fact.title === title)) {
        savedHistory.push({ title, text });
        localStorage.setItem('user_saved_history', JSON.stringify(savedHistory));
        alert(getBilingualText('Fact Saved!', '‡§§‡§•‡•ç‡§Ø ‡§∏‡§π‡•á‡§ú ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!'));
    } else {
        alert(getBilingualText('Fact already saved!', '‡§§‡§•‡•ç‡§Ø ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∏‡§π‡•á‡§ú‡§æ ‡§π‡•Å‡§Ü ‡§π‡•à!'));
    }
};

// --- NEW: LIBRARY LOGIC ---
const renderLibrary = () => {
    const listContainer = document.getElementById('libraryList');
    const emptyMsg = document.getElementById('emptyLibraryMsg');
    while (listContainer.firstChild) listContainer.removeChild(listContainer.firstChild);
    const savedHistory = JSON.parse(localStorage.getItem('user_saved_history') || '[]');
    if (savedHistory.length === 0) {
        emptyMsg.style.display = 'block';
    } else {
        emptyMsg.style.display = 'none';
        savedHistory.forEach((fact, index) => {
            const card = document.createElement('div');
            card.className = 'saved-fact-card';
            const title = document.createElement('div');
            title.className = 'saved-fact-title';
            title.textContent = fact.title;
            const text = document.createElement('div');
            text.className = 'saved-fact-text';
            text.textContent = fact.text;
            const delBtn = document.createElement('button');
            delBtn.className = 'delete-fact-btn';
            delBtn.textContent = '√ó';
            delBtn.onclick = () => { deleteFact(index); };
            card.appendChild(title); card.appendChild(text); card.appendChild(delBtn);
            listContainer.appendChild(card);
        });
    }
};

const deleteFact = (index) => {
    let savedHistory = JSON.parse(localStorage.getItem('user_saved_history') || '[]');
    savedHistory.splice(index, 1);
    localStorage.setItem('user_saved_history', JSON.stringify(savedHistory));
    renderLibrary();
};

const openLibrary = () => {
    renderLibrary();
    document.getElementById('libraryModal').style.display = 'block';
};

document.getElementById('saveFactBtn').addEventListener('click', saveFact);
document.getElementById('openLibraryBtn').addEventListener('click', openLibrary);
document.getElementById('closeLibraryModal').addEventListener('click', () => { document.getElementById('libraryModal').style.display = 'none'; });

// ====================================================================================
// ================================= END OF INITIALIZATION ============================
// ====================================================================================

const renderUserGreeting = () => {
const profile = getProfile();
if (profile.name) {
$('userGreeting').textContent = getBilingualText(`Hello, ${profile.name}`, `‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ${profile.name}`);
} else {
$('userGreeting').textContent = '';
}
};
const renderAudioPlayer = () => {
const select = $('audioTrackSelect'), player = $('audioPlayer'), image = $('audioTrackImage');
select.textContent = '';
try {
const audioTracks = JSON.parse(localStorage.getItem('smart_audio') || '[]');
if (audioTracks.length > 0) {
audioTracks.forEach(track => {
const option = document.createElement('option');
option.value = track.url;
option.dataset.imageUrl = track.imageUrl || '';
option.textContent = track.name;
select.appendChild(option);
});
const selectedOption = select.options[select.selectedIndex];
player.src = selectedOption.value;
image.src = selectedOption.dataset.imageUrl;
image.style.display = selectedOption.dataset.imageUrl ? 'block' : 'none';
}
} catch(e) { console.error("Could not load audio tracks", e); }
};
const renderSlots = () => {
    const container = $('slots');
    container.textContent = ''; // Using textContent to clear
    slotsData.sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
    
    slotsData.forEach(item => {
        const slotDiv = document.createElement('div');
        slotDiv.className = 'slot';
        slotDiv.dataset.id = item.id;

        const timeDiv = document.createElement('div');
        timeDiv.className = 'time';
        timeDiv.textContent = formatTime(item.time);

        const labelDiv = document.createElement('div');
        labelDiv.className = 'label';
        labelDiv.dataset.hi = item.label_hi;
        labelDiv.dataset.en = item.label_en;
        labelDiv.textContent = getBilingualText(item.label_en, item.label_hi);

        const tipDiv = document.createElement('div');
        tipDiv.className = 'tip';
        tipDiv.dataset.hi = item.tip_hi;
        tipDiv.dataset.en = item.tip_en;
        tipDiv.textContent = getBilingualText(item.tip_en, item.tip_hi);

        const editBtn = document.createElement('button');
        editBtn.className = 'slot-edit-btn';
        editBtn.dataset.id = item.id;
        editBtn.textContent = '‚úé'; 

        slotDiv.appendChild(timeDiv);
        slotDiv.appendChild(labelDiv);
        slotDiv.appendChild(tipDiv);
        slotDiv.appendChild(editBtn);

        container.appendChild(slotDiv);
    });
};

const updateDynamicActivityLabels = () => {
const activity = $('activityName').value.trim() || getProfile().activityLabel || 'Duty';
$$('.dynamic-activity-label, .dynamic-activity-label-modal').forEach(el => { el.textContent = activity; });
};
const updateTextContent = () => {
$$('[data-hi][data-en]').forEach(elem => {
if (!elem.matches('.dynamic-activity-label, .dynamic-activity-label-modal')) {
elem.textContent = getBilingualText(elem.dataset.en, elem.dataset.hi);
}
});
updateDynamicActivityLabels();
};

const displayStrategy = () => {
    const p = getProfile();
    const exam = $('examName').value || p.exam;
    const targetDate = $('targetDate').value || p.targetDate;
    const subjectsInput = $('subjectsList').value.trim();
    const numSubjects = subjectsInput ? subjectsInput.split('\n').filter(s => s.trim()).length : (p.subjects ? p.subjects.length : 0);
    const focusSubject = $('focusSubject').value.trim() || p.focusSubject || '';
    let studyHours;
    const occupation = document.querySelector('input[name="occupation"]:checked').value || p.occupation;
    if(occupation === 'student') {
        studyHours = p.studentStudyGoal || $('studentStudyGoal').value || 8;
    } else {
        studyHours = p.dutyStudyGoal || $('dutyStudyGoal').value || 3;
    }
    
    const strategyDiv = $('strategy');
    strategyDiv.textContent = ''; 

    if (!exam || !targetDate) {
        const msg = document.createElement('span');
        msg.style.color = 'var(--muted)';
        msg.dataset.hi = "‡§∞‡§£‡§®‡•Ä‡§§‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç";
        msg.dataset.en = "Complete setup for strategy";
        msg.textContent = getBilingualText("Complete setup for strategy", "‡§∞‡§£‡§®‡•Ä‡§§‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç");
        strategyDiv.appendChild(msg);
    } else {
        const days = daysBetween(new Date(), targetDate);
        
        const createLine = (labelEn, labelHi, value) => {
            const div = document.createElement('div');
            const span = document.createElement('span');
            span.dataset.en = labelEn;
            span.dataset.hi = labelHi;
            span.textContent = getBilingualText(labelEn, labelHi);
            const strong = document.createElement('strong');
            strong.textContent = ` ${value}`;
            div.appendChild(span);
            div.appendChild(document.createTextNode(':'));
            div.appendChild(strong);
            return div;
        };

        strategyDiv.appendChild(createLine("Goal", "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø", exam));
        strategyDiv.appendChild(createLine("Time Left", "‡§∏‡§Æ‡§Ø", `${days} ${getBilingualText('days', '‡§¶‡§ø‡§®')}`));
        strategyDiv.appendChild(createLine("Daily Goal", "‡§¶‡•à‡§®‡§ø‡§ï ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø", `${studyHours} ${getBilingualText('hours', '‡§ò‡§Ç‡§ü‡•á')}`));
        strategyDiv.appendChild(createLine("Subjects", "‡§µ‡§ø‡§∑‡§Ø", numSubjects));
        
        if (focusSubject) {
            const fDiv = document.createElement('div');
            const fSpan = document.createElement('span');
            fSpan.dataset.en = "Focus Subject";
            fSpan.dataset.hi = "‡§´‡•ã‡§ï‡§∏ ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü";
            fSpan.textContent = getBilingualText("Focus Subject", "‡§´‡•ã‡§ï‡§∏ ‡§∏‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü");
            const fStrong = document.createElement('strong');
            fStrong.textContent = ` ${focusSubject} (+${FOCUS_EXTRA_MINUTES} min)`;
            fDiv.appendChild(fSpan);
            fDiv.appendChild(document.createTextNode(':'));
            fDiv.appendChild(fStrong);
            strategyDiv.appendChild(fDiv);
        }
    }
};

const loadProfileToForm = () => {
const p = getProfile();
$('examName').value = p.exam || '';
$('targetDate').value = p.targetDate || '';
$('subjectsList').value = p.subjects ? p.subjects.join('\n') : '';
$('focusSubject').value = p.focusSubject || '';

// NEW: Load Class Selector
$('classSelector').value = p.studentClass || 'general';

if (p.occupation === 'student') {
$('roleStudent').checked = true;
$('studentStudyGoal').value = p.studentStudyGoal || 8;
$('studentSetWakeUpManual').checked = p.useStudentManualWakeUp || false;
$('studentManualWakeUpWrapper').style.display = p.useStudentManualWakeUp ? 'flex' : 'none';
$('wakeUpTime').value = p.wakeUpTime || '05:00';
$('studentSetSleepManual').checked = p.useStudentManualSleep || false;
$('studentManualSleepWrapper').style.display = p.useStudentManualSleep ? 'flex' : 'none';
$('sleepTime').value = p.sleepTime || '22:00';
$('studentAddActivityCheckbox').checked = p.useStudentActivity || false;
$('studentActivityWrapper').style.display = p.useStudentActivity ? 'block' : 'none';
$('studentActivityName').value = p.studentActivityName || '';
$('studentActivityDuration').value = p.studentActivityDuration || 1;
} else {
$('roleDuty').checked = true;
$('activityName').value = p.activityLabel || 'Duty';
$('dutyStart').value = p.dutyStart || '09:00';
$('dutyEnd').value = p.dutyEnd || '18:00';
$('dutyStudyGoal').value = p.dutyStudyGoal || 3;
if (p.shiftType === 'night') {
$('shiftNight').checked = true;
} else {
$('shiftDay').checked = true;
}
$('dutySetWakeUpManual').checked = p.useDutyManualWakeUp || false;
$('dutyManualWakeUpWrapper').style.display = p.useDutyManualWakeUp ? 'flex' : 'none';
$('dutyWakeUpTime').value = p.dutyWakeUpTime || '05:00';
$('dutySetSleepManual').checked = p.useDutyManualSleep || false;
$('dutyManualSleepWrapper').style.display = p.useDutyManualSleep ? 'flex' : 'none';
$('dutySleepTime').value = p.dutySleepTime || '22:00';
}
toggleOccupationView(p.occupation || 'duty', 'main');

const event = new Event('change');
$('classSelector').dispatchEvent(event);

if (p.name) {
$('detailsInputs').style.display = 'none';
$('profileSummary').style.display = 'block';
$('profileSummary').textContent = getBilingualText("Profile is set. Use the menu to edit.", "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á‡§ü ‡§π‡•à‡•§ ‡§á‡§∏‡•á ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•á‡§®‡•Ç ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§");
} else {
$('detailsInputs').style.display = 'block';
$('profileSummary').style.display = 'none';
}
updateTextContent();
};
const refreshUI = () => {
loadProfileToForm();
displayStrategy();
loadSlotsData();
renderSlots();
fetchDeepFact();
renderUserGreeting();
renderAudioPlayer();
renderStudyApps();
updateStudyDisplay();
updateTextContent();
};
const handleLanguageChange = () => {
currentLang = $('langSel').value;
localStorage.setItem('smart_lang', currentLang);
refreshUI();
};
const handleTimeFormatChange = () => {
timeFormat = $('timeFormatSel').value;
localStorage.setItem('smart_time_format', timeFormat);
renderSlots();
};
const openProfileModal = () => {
const p = getProfile();
$('profileName').value = p.name || '';
$('profileAge').value = p.age || '';
$('profileExam').value = p.exam || '';
$('profileTargetDate').value = p.targetDate || '';
$('profileSubjects').value = p.subjects ? p.subjects.join('\n') : '';
$('profileFocusSubject').value = p.focusSubject || '';
$('profileExtraGoal').value = p.extraGoal || '';

$('profileClassSelector').value = p.studentClass || 'general';

if (p.occupation === 'student') {
$('profileRoleStudent').checked = true;
$('profileStudentStudyGoal').value = p.studentStudyGoal || 8;
$('profileStudentSetWakeUpManual').checked = p.useStudentManualWakeUp || false;
$('profileStudentManualWakeUpWrapper').style.display = p.useStudentManualWakeUp ? 'flex' : 'none';
$('profileWakeUpTime').value = p.wakeUpTime || '05:00';
$('profileStudentSetSleepManual').checked = p.useStudentManualSleep || false;
$('profileStudentManualSleepWrapper').style.display = p.useStudentManualSleep ? 'flex' : 'none';
$('profileSleepTime').value = p.sleepTime || '22:00';
$('profileStudentAddActivityCheckbox').checked = p.useStudentActivity || false;
$('profileStudentActivityWrapper').style.display = p.useStudentActivity ? 'block' : 'none';
$('profileStudentActivityName').value = p.studentActivityName || '';
$('profileStudentActivityDuration').value = p.studentActivityDuration || 1;
} else {
$('profileRoleDuty').checked = true;
$('profileActivityName').value = p.activityLabel || 'Duty';
$('profileDutyStart').value = p.dutyStart || '09:00';
$('profileDutyEnd').value = p.dutyEnd || '18:00';
$('profileDutyStudyGoal').value = p.dutyStudyGoal || 3;
if (p.shiftType === 'night') {
$('profileShiftNight').checked = true;
} else {
$('profileShiftDay').checked = true;
}
$('profileDutySetWakeUpManual').checked = p.useDutyManualWakeUp || false;
$('profileDutyManualWakeUpWrapper').style.display = p.useDutyManualWakeUp ? 'flex' : 'none';
$('profileDutyWakeUpTime').value = p.dutyWakeUpTime || '05:00';
$('profileDutySetSleepManual').checked = p.useDutyManualSleep || false;
$('profileDutyManualSleepWrapper').style.display = p.useDutyManualSleep ? 'flex' : 'none';
$('profileDutySleepTime').value = p.dutySleepTime || '22:00';
}
toggleOccupationView(p.occupation || 'duty', 'profile');

const event = new Event('change');
$('profileClassSelector').dispatchEvent(event);

updateDynamicActivityLabels();
$('profileModal').style.display = 'block';
};
const saveProfile = () => {
const occupation = document.querySelector('input[name="profileOccupation"]:checked').value;
const profile = {
name: $('profileName').value.trim(),
age: parseInt($('profileAge').value) || null,
exam: $('profileExam').value.trim(),
occupation: occupation,
studentClass: $('profileClassSelector').value,
targetDate: $('profileTargetDate').value,
subjects: $('profileSubjects').value.split('\n').map(s => s.trim()).filter(s => s),
focusSubject: $('profileFocusSubject').value.trim(),
extraGoal: $('profileExtraGoal').value.trim(),
};
if (occupation === 'duty') {
profile.activityLabel = $('profileActivityName').value.trim() || 'Duty';
profile.dutyStart = $('profileDutyStart').value;
profile.dutyEnd = $('profileDutyEnd').value;
profile.dutyStudyGoal = parseFloat($('profileDutyStudyGoal').value) || 3;
profile.shiftType = document.querySelector('input[name="profileShiftType"]:checked').value;
profile.useDutyManualWakeUp = $('profileDutySetWakeUpManual').checked;
profile.dutyWakeUpTime = $('profileDutyWakeUpTime').value;
profile.useDutyManualSleep = $('profileDutySetSleepManual').checked;
profile.dutySleepTime = $('profileDutySleepTime').value;
} else {
profile.studentStudyGoal = parseFloat($('profileStudentStudyGoal').value) || 8;
profile.useStudentManualWakeUp = $('profileStudentSetWakeUpManual').checked;
profile.wakeUpTime = $('profileWakeUpTime').value;
profile.useStudentManualSleep = $('profileStudentSetSleepManual').checked;
profile.sleepTime = $('profileSleepTime').value;
profile.useStudentActivity = $('profileStudentAddActivityCheckbox').checked;
profile.studentActivityName = $('profileStudentActivityName').value.trim();
profile.studentActivityDuration = parseFloat($('profileStudentActivityDuration').value) || 1;
}
localStorage.setItem('smart_profile', JSON.stringify(profile));
localStorage.setItem('profileSetup', 'true');
$('menuBtn').classList.remove('blinking-menu');
$('profileModal').style.display = 'none';
refreshUI();
};
const generateStudentRoutine = (params, subjects, focusSubject) => {
    const { studyHours, addActivity, activityName, activityDuration, useWake, wakeStr, useSleep, sleepStr } = params;
    
    const newSlots = [];
    const totalStudyMins = studyHours * 60;
    const activityMins = addActivity ? activityDuration * 60 : 0;
    
    const sessions = Math.max(1, Math.ceil(studyHours / 1.5));
    const shortBreaks = sessions > 1 ? sessions - 1 : 0;
    const longBreaks = sessions > 2 ? 1 : 0;
    const dinnerBreak = 1;
    const totalBreakMins = (shortBreaks * 15) + (longBreaks * 60) + (dinnerBreak * 45);
    
    const PERSONAL_TIME_MINS = 5 * 60; 
    const totalRequiredMins = totalStudyMins + activityMins + totalBreakMins + PERSONAL_TIME_MINS;

    let wakeTimeMins, sleepTimeMins;

    if (useWake && useSleep) {
        wakeTimeMins = timeToMinutes(wakeStr);
        sleepTimeMins = timeToMinutes(sleepStr);
         if (wakeTimeMins >= sleepTimeMins) {
            alert(getBilingualText('Invalid Time: Wake-up time must be before sleep time for a single day cycle.', '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§Ø: ‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§∏‡•ã‡§®‡•á ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§'));
            return false;
        }
    } else if (useWake) {
        wakeTimeMins = timeToMinutes(wakeStr);
        sleepTimeMins = wakeTimeMins + totalRequiredMins; 
    } else if (useSleep) {
        sleepTimeMins = timeToMinutes(sleepStr);
        wakeTimeMins = sleepTimeMins - totalRequiredMins;
    } else {
        wakeTimeMins = timeToMinutes("05:00");
        sleepTimeMins = wakeTimeMins + totalRequiredMins;
    }

    let availableMins = (sleepTimeMins - wakeTimeMins);
    if (availableMins < 0) { availableMins += 1440; }
    
    const sleepDuration = 1440 - availableMins;

    if (availableMins < totalRequiredMins - PERSONAL_TIME_MINS || sleepDuration < 360) { 
        alert(getBilingualText(
            `Your schedule is not realistic. You have approx. ${Math.round(availableMins/60)} hours available, but your goals require at least ${Math.round((totalRequiredMins - PERSONAL_TIME_MINS)/60)} hours for activities alone. Please adjust your study goal, activity duration, or allow for at least 6 hours of sleep.`,
            `‡§Ü‡§™‡§ï‡•Ä ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§≤‡§ó‡§≠‡§ó ${Math.round(availableMins/60)} ‡§ò‡§Ç‡§ü‡•á ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡§Ç, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡•ã‡§Ç ‡§π‡•á‡§§‡•Å ‡§π‡•Ä ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ${Math.round((totalRequiredMins - PERSONAL_TIME_MINS)/60)} ‡§ò‡§Ç‡§ü‡•á ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø, ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§ï‡•Ä ‡§Ö‡§µ‡§ß‡§ø ‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•Ä ‡§®‡•Ä‡§Ç‡§¶ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§`
        ));
        return false;
    }
    
    let currentTime = wakeTimeMins;
    newSlots.push({ id: 'wake', label_en: 'Wake Up & Fresh Up', label_hi: '‡§â‡§†‡•ã ‡§î‡§∞ ‡§´‡•ç‡§∞‡•á‡§∂ ‡§π‡•ã ‡§ú‡§æ‡§ì', time: minutesToTime(currentTime), msg_en: `Good morning!`, msg_hi: `‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§!` });
    currentTime += 30;

    const studyPerSession = Math.floor(totalStudyMins / sessions);
    let subjectIndex = 0;

    for (let i = 1; i <= sessions; i++) {
        const subject = subjects[subjectIndex % subjects.length] || `Study Session ${i}`;
        const isFocus = subject.toLowerCase() === focusSubject.toLowerCase();
        const sessionDuration = studyPerSession + (isFocus ? FOCUS_EXTRA_MINUTES : 0);
        
        newSlots.push({ id: `study${i}`, label_en: `${subject}`, label_hi: `${subject}`, time: minutesToTime(currentTime), msg_en: `Time for ${subject}.`, msg_hi: `${subject} ‡§ï‡§æ ‡§∏‡§Æ‡§Ø‡•§` });
        currentTime += sessionDuration;
        subjectIndex++;

        if (i === Math.floor(sessions / 2) && longBreaks > 0) {
            newSlots.push({ id: `long_break`, label_en: `Lunch Break`, label_hi: `‡§≤‡§Ç‡§ö ‡§¨‡•ç‡§∞‡•á‡§ï`, time: minutesToTime(currentTime), msg_en: `Time for lunch.`, msg_hi: `‡§≤‡§Ç‡§ö ‡§ï‡§æ ‡§∏‡§Æ‡§Ø‡•§` });
            currentTime += 60;
        } else if (i < sessions) {
            newSlots.push({ id: `break`, label_en: `Short Break`, label_hi: `‡§õ‡•ã‡§ü‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï`, time: minutesToTime(currentTime), msg_en: `Take a short break.`, msg_hi: `‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§¨‡•ç‡§∞‡•á‡§ï ‡§≤‡•á‡§Ç‡•§` });
            currentTime += 15;
        }
    }

    if (addActivity && activityName) {
        newSlots.push({ id: 'other_activity', label_en: activityName, label_hi: activityName, time: minutesToTime(currentTime), msg_en: `Time for ${activityName}.`, msg_hi: `${activityName} ‡§ï‡§æ ‡§∏‡§Æ‡§Ø‡•§` });
        currentTime += activityMins;
    }

    newSlots.push({ id: 'dinner', label_en: 'Dinner', label_hi: '‡§°‡§ø‡§®‡§∞', time: minutesToTime(currentTime), msg_en: `Have your dinner.`, msg_hi: `‡§Ö‡§™‡§®‡§æ ‡§°‡§ø‡§®‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§` });
    currentTime += 45;

    newSlots.push({ id: 'sleep', label_en: 'Sleep', label_hi: '‡§∏‡•ã‡§®‡§æ', time: minutesToTime(sleepTimeMins), msg_en: `Time to sleep.`, msg_hi: `‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø‡•§` });

    slotsData = newSlots;
    return true;
};


const autoGenerate = () => {
const occupation = document.querySelector('input[name="occupation"]:checked').value;
const p = getProfile();
const subjects = p.subjects || [];
const subjectsInput = $('subjectsList').value.split('\n').map(s => s.trim()).filter(s => s);
const allSubjects = subjects.length > 0 ? subjects : subjectsInput;
const focusSubject = $('focusSubject').value.trim() || p.focusSubject || '';

if (occupation === 'duty') {
    const useManualWake = $('dutySetWakeUpManual').checked;
    const manualWakeStr = $('dutyWakeUpTime').value;
    const useManualSleep = $('dutySetSleepManual').checked;
    const manualSleepStr = $('dutySleepTime').value;
    const ds = $('dutyStart').value, de = $('dutyEnd').value;
    const studyGoalHours = parseFloat($('dutyStudyGoal').value) || 0;

    if (!ds || !de || !studyGoalHours) {
        alert(getBilingualText('Please set duty start, end, and your study goal.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§∂‡•Å‡§∞‡•Ç, ‡§ñ‡§§‡•ç‡§Æ ‡§î‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§'));
        return;
    }

    const sM = timeToMinutes(ds), eM = timeToMinutes(de);

    if (useManualWake && timeToMinutes(manualWakeStr) >= sM) {
        alert(getBilingualText('Invalid Time: Wake-up time must be before duty starts.', '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§Ø: ‡§ú‡§æ‡§ó‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§'));
        return;
    }
    
    if (useManualSleep) {
        const sleepM = timeToMinutes(manualSleepStr);
        let isError = false;
        if (sM < eM) { // Day shift
            if (sleepM > sM && sleepM < eM) isError = true;
        } else { // Night shift
            if (sleepM > sM || sleepM < eM) isError = true;
        }
        if (isError) {
             alert(getBilingualText('Invalid Time: Your sleep time cannot be during your duty hours.', '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§Ø: ‡§Ü‡§™‡§ï‡•á ‡§∏‡•ã‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§Ü‡§™‡§ï‡•á ‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§ï‡•á ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ‡•§'));
             return;
        }
    }

    let dutyDurationMins = eM - sM;
    if (dutyDurationMins < 0) { dutyDurationMins += 1440; }

    const studyGoalMins = studyGoalHours * 60;
    const PERSONAL_TIME_MINS = 4 * 60; 
    const requiredSleepMins = 6 * 60;
    const totalRequiredMins = dutyDurationMins + studyGoalMins + PERSONAL_TIME_MINS + requiredSleepMins;

    if (totalRequiredMins > 1440) {
        const availableForStudy = (1440 - dutyDurationMins - PERSONAL_TIME_MINS - requiredSleepMins) / 60;
        alert(getBilingualText(
            `Your schedule is too packed. With your duty of ${Math.round(dutyDurationMins/60)} hours and minimum personal/sleep time, you only have about ${Math.max(0, availableForStudy).toFixed(1)} hours available for study. Please reduce your study goal.`,
            `‡§Ü‡§™‡§ï‡•Ä ‡§¶‡§ø‡§®‡§ö‡§∞‡•ç‡§Ø‡§æ ‡§¨‡§π‡•Å‡§§ ‡§µ‡•ç‡§Ø‡§∏‡•ç‡§§ ‡§π‡•à‡•§ ‡§Ü‡§™‡§ï‡•Ä ${Math.round(dutyDurationMins/60)} ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•Ä ‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§/‡§®‡•Ä‡§Ç‡§¶ ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•á‡§µ‡§≤ ${Math.max(0, availableForStudy).toFixed(1)} ‡§ò‡§Ç‡§ü‡•á ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§ï‡•ã ‡§ï‡§Æ ‡§ï‡§∞‡•á‡§Ç‡•§`
        ));
        return;
    }
    
    slotsData = defaultSlots(p.exam, p.activityLabel);
    const findSlot = (id) => slotsData.find(s => s.id === id);
    let subjectIndex = 0;

    if (document.querySelector('input[name="shiftType"]:checked').value === 'night') {
        const sleepStartMins = eM + 60;
        const wakeTimeMins = sleepStartMins + 480; 
        findSlot('duty_end').time = de;
        findSlot('home').time = minutesToTime(eM + 30);
        findSlot('sleep').time = minutesToTime(sleepStartMins);
        findSlot('wake').time = minutesToTime(wakeTimeMins);
        findSlot('leave').time = minutesToTime(sM - 30);
        findSlot('duty_start').time = ds;
        const dinnerTimeMins = sM - 90;
        findSlot('dinner').time = minutesToTime(dinnerTimeMins);
        const studyBlockStart = wakeTimeMins + 30;
        let currentTime = studyBlockStart;

        if (studyGoalMins > 0) {
            findSlot('main_study').time = minutesToTime(currentTime);
            findSlot('main_study').label_en = allSubjects[0] || 'Main Study';
            findSlot('main_study').label_hi = allSubjects[0] || '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡§¢‡§º‡§æ‡§à';
            currentTime += studyGoalMins;
        }

        slotsData = slotsData.filter(s => ['wake', 'duty_start', 'duty_end', 'home', 'dinner', 'sleep', 'main_study', 'leave'].includes(s.id) && (s.id !== 'main_study' || studyGoalMins > 0));

    } else { // Day shift
        findSlot('wake').time = minutesToTime(sM - 90);
        findSlot('leave').time = minutesToTime(sM - 30);
        findSlot('duty_start').time = ds;
        findSlot('duty_end').time = de;
        findSlot('home').time = minutesToTime(eM + 30);
        findSlot('nap').time = minutesToTime(eM + 60);

        const morningStudyDuration = Math.min(45, studyGoalMins);
        let eveningStudyMins = studyGoalMins - morningStudyDuration;
        
        if(morningStudyDuration > 0) {
            findSlot('morning_study').time = minutesToTime(sM - 30 - morningStudyDuration);
            findSlot('morning_study').label_en = allSubjects[subjectIndex % allSubjects.length] || 'Morning Study';
            findSlot('morning_study').label_hi = allSubjects[subjectIndex % allSubjects.length] || '‡§∏‡•Å‡§¨‡§π ‡§ï‡•Ä ‡§™‡§¢‡§º‡§æ‡§à';
            subjectIndex++;
        } else {
            slotsData = slotsData.filter(s => s.id !== 'morning_study');
        }

        let currentTime = timeToMinutes(findSlot('nap').time) + 30; 
        
        if(eveningStudyMins > 0) {
             findSlot('main_study').time = minutesToTime(currentTime);
             findSlot('main_study').label_en = allSubjects[subjectIndex % allSubjects.length] || 'Main Study';
             findSlot('main_study').label_hi = allSubjects[subjectIndex % allSubjects.length] || '‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡§¢‡§º‡§æ‡§à';
             currentTime += eveningStudyMins;
        } else {
             slotsData = slotsData.filter(s => s.id !== 'main_study');
        }

        findSlot('dinner').time = minutesToTime(currentTime + 15);
        findSlot('sleep').time = minutesToTime(currentTime + 75);
        slotsData = slotsData.filter(s => !['break', 'practice', 'current_affairs'].includes(s.id));
    }

    if (useManualWake) { findSlot('wake').time = manualWakeStr; }
    if (useManualSleep) { findSlot('sleep').time = manualSleepStr; }

} else { // Student
    const studentParams = {
        studyHours: parseFloat($('studentStudyGoal').value) || 8,
        addActivity: $('studentAddActivityCheckbox').checked,
        activityName: $('studentActivityName').value.trim(),
        activityDuration: parseFloat($('studentActivityDuration').value) || 1,
        useWake: $('studentSetWakeUpManual').checked,
        wakeStr: $('wakeUpTime').value,
        useSleep: $('studentSetSleepManual').checked,
        sleepStr: $('sleepTime').value
    };
    
    if (!studentParams.studyHours) { 
        alert(getBilingualText('Please set your daily study goal.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§¶‡•à‡§®‡§ø‡§ï ‡§Ö‡§ß‡•ç‡§Ø‡§Ø‡§® ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§')); 
        return; 
    }
    
    const success = generateStudentRoutine(studentParams, allSubjects, focusSubject);
    if (!success) return;
}

saveSlotsData();
renderSlots();

const manualAlarmModal = $('manualAlarmModal');
const manualAlarmList = $('manualAlarmList');
manualAlarmList.textContent = ''; 

const importantAlarmIds = ['wake', 'morning_study', 'leave', 'duty_start', 'main_study', 'practice', 'dinner', 'sleep', 'study1', 'study2', 'study3', 'study4', 'study5'];

slotsData.sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

slotsData.forEach(slot => {
    if (importantAlarmIds.includes(slot.id)) {
        const listItem = document.createElement('li');
        
        const labelSpan = document.createElement('span');
        labelSpan.textContent = getBilingualText(slot.label_en, slot.label_hi);
        
        const timeSpan = document.createElement('span');
        timeSpan.className = 'time';

        if (slot.id === 'wake') {
            const originalTime = timeToMinutes(slot.time);
            const fifteenMinutesEarly = minutesToTime(originalTime - 15);
            const formattedEarlyTime = formatTime(fifteenMinutesEarly);
            
            timeSpan.style.textAlign = 'right';
            timeSpan.textContent = formattedEarlyTime;
            
            const small = document.createElement('small');
            small.style.display = 'block';
            small.style.color = 'var(--muted)';
            small.style.fontWeight = 'normal';
            small.textContent = getBilingualText('(15 mins early)', '(15 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§π‡§≤‡•á)');
            timeSpan.appendChild(small);
        } else {
            timeSpan.textContent = formatTime(slot.time);
        }
        
        listItem.appendChild(labelSpan);
        listItem.appendChild(timeSpan);
        manualAlarmList.appendChild(listItem);
    }
});

manualAlarmModal.style.display = 'block';
updateTextContent();
};
const toggleOccupationView = (occupation, context) => {
const dutyFields = (context === 'profile') ? $('profileDutyFields') : $('dutyFields');
const studentFields = (context === 'profile') ? $('profileStudentFields') : $('studentFields');
if (occupation === 'student') { dutyFields.style.display = 'none'; studentFields.style.display = 'block'; }
else { dutyFields.style.display = 'block'; studentFields.style.display = 'none'; }
};
const init = () => {
initializeData();
$('langSel').value = currentLang;
$('timeFormatSel').value = timeFormat;
const todayStr = new Date().toISOString().split('T')[0];
[$('targetDate'), $('profileTargetDate')].forEach(el => el.min = todayStr);
if (localStorage.getItem('profileSetup') !== 'true') {
    $('setupCard').classList.add('open');
    $('setupCard').querySelector('.card-body').style.display = 'block';
    $('menuBtn').classList.add('blinking-menu');
}
const alarmSound = $('alarmSound');
const alarmTones = [
'https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3',
'https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.wav',
'https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.wav',
'https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.wav'
];
const alarmLeadTimes = { 'wake': 10, 'morning_study': 5, 'leave': 5, 'main_study': 10, 'study1': 5, 'study2': 5, 'study3': 5, 'study4': 5, 'study5': 5, 'break': 2, 'practice': 10, 'current_affairs': 5, 'dinner': 10, 'sleep': 0, 'other_activity': 5, 'relax': 0 };
const dismissCurrentAlarm = () => { alarmSound.pause(); alarmSound.currentTime = 0; $('alarmModal').style.display = 'none'; };
const triggerAlarm = (slot, leadTime) => {
let currentToneIndex = parseInt(localStorage.getItem('currentAlarmToneIndex') || '0');
alarmSound.src = alarmTones[currentToneIndex];
let nextToneIndex = (currentToneIndex + 1) % alarmTones.length;
localStorage.setItem('currentAlarmToneIndex', nextToneIndex.toString());
const messageEn = leadTime > 0 ? `Get ready for ${slot.label_en}!` : `It's time for ${slot.label_en}!`;
const messageHi = leadTime > 0 ? `${slot.label_hi} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§ì!` : `${slot.label_hi} ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à!`;
$('alarmMessage').textContent = getBilingualText(messageEn, messageHi);
$('alarmModal').style.display = 'block';
alarmSound.play().catch(e => console.error("Alarm sound failed:", e));
};
const checkAlarms = () => {
const now = new Date();
const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
slotsData.forEach(slot => {
if (Object.keys(alarmLeadTimes).includes(slot.id)) {
const leadTime = alarmLeadTimes[slot.id];
const slotTimeInMinutes = timeToMinutes(slot.time);
const alarmTimeInMinutes = (slotTimeInMinutes - leadTime + 1440) % 1440;
if (currentTimeInMinutes === alarmTimeInMinutes) {
const alarmTriggeredKey = `alarm_triggered_${slot.id}_${new Date().toISOString().split('T')[0]}`;
if (!sessionStorage.getItem(alarmTriggeredKey)) {
triggerAlarm(slot, leadTime);
sessionStorage.setItem(alarmTriggeredKey, 'true');
}
}
}
});
};
$('stopAlarmBtn').addEventListener('click', dismissCurrentAlarm);
setInterval(checkAlarms, 30000);
checkAlarms();
// --- EVENT LISTENERS ---

$('closeManualAlarmModalBtn').addEventListener('click', () => {
    $('manualAlarmModal').style.display = 'none';
});

// NEW: Class Selector Logic with Auto-Subjects and Hide Exam
const handleClassChange = (selectorId, roleDutyId, roleStudentId, dutyLabelId, subjectAreaId, examWrapperId, isProfileContext) => {
    const selector = $(selectorId);
    const dutyRadio = $(roleDutyId);
    const studentRadio = $(roleStudentId);
    const dutyLabel = $(dutyLabelId);
    const subjectArea = $(subjectAreaId);
    const examWrapper = $(examWrapperId);

    selector.addEventListener('change', (e) => {
        const val = e.target.value;
        const slider = $('subjectImageSlider');

        if (['9', '10', '11', '12'].includes(val)) {
            // Hide Professional option
            dutyRadio.style.display = 'none';
            dutyLabel.style.display = 'none';
            
            // Auto select Student
            studentRadio.checked = true;
            toggleOccupationView('student', isProfileContext ? 'profile' : 'main');

            // Hide Exam Name Field for school students
            if (examWrapper) examWrapper.style.display = 'none';

            // Auto-populate and Highlight subjects
            if (defaultSubjects[val]) {
                subjectArea.value = defaultSubjects[val];
                subjectArea.classList.add('highlight-subjects'); // Make bold/attractive
            }

            // SHOW SLIDER ONLY FOR CLASS 9
            if (val === '9' && !isProfileContext) {
                slider.style.display = 'block';
                renderSlider();
                startAutoScroll(); // Start scrolling
            } else {
                slider.style.display = 'none';
                stopAutoScroll(); // Stop logic if hidden
            }

        } else {
            // Show Professional option
            dutyRadio.style.display = 'inline-block';
            dutyLabel.style.display = 'inline-block';

            // Show Exam Name Field for General
            if (examWrapper) examWrapper.style.display = 'block'; 

            // Clear subjects (manual fill) and remove highlight
            const currentVal = subjectArea.value.trim();
            const isDefault = Object.values(defaultSubjects).some(s => s.trim() === currentVal);
            
            if (isDefault || val === 'general') {
                 if(isDefault) subjectArea.value = '';
            }
            subjectArea.classList.remove('highlight-subjects'); 
            
            if (!isProfileContext) {
                slider.style.display = 'none';
                stopAutoScroll();
            }
        }
    });
};

// Initialize for Setup Card
handleClassChange('classSelector', 'roleDuty', 'roleStudent', 'roleDutyLabel', 'subjectsList', 'setupExamWrapper', false);
// Initialize for Profile Modal
handleClassChange('profileClassSelector', 'profileRoleDuty', 'profileRoleStudent', 'profileRoleDutyLabel', 'profileSubjects', 'profileExamWrapper', true);


// --- SLIDER RENDERING & AUTO-SCROLL LOGIC ---
let sliderInterval;
const sliderContainer = $('sliderContainer');

// --- UPDATED SLIDER RENDERER (Starts Timer on Click) ---
const renderSlider = () => {
    sliderContainer.textContent = ''; // Clear via textContent
    let displayData = [];
    for(let i=0; i<10; i++) { displayData = [...displayData, ...subjectsData]; }

    displayData.forEach(sub => {
        const wrapper = document.createElement('div');
        wrapper.className = 'slide-img-wrapper';
        
        const img = document.createElement('img');
        img.src = sub.img;
        img.className = 'slide-img';
        img.alt = sub.name;
        
        const overlay = document.createElement('div');
        overlay.className = 'slide-text-overlay';
        overlay.textContent = sub.name;
        
        wrapper.appendChild(img);
        wrapper.appendChild(overlay);
        
        wrapper.addEventListener('click', () => {
            // 1. ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•á‡§Ç (Ultra Intelligent Update)
            startStudyTimer(sub.name);

            // 2. ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§ñ‡•ã‡§≤‡•á‡§Ç
            if (sub.type === 'popup') {
                openScienceModal();
            } else {
                searchYouTube(sub.name);
            }
        });
        sliderContainer.appendChild(wrapper);
    });
};

const startAutoScroll = () => {
    clearInterval(sliderInterval);
    sliderInterval = setInterval(() => {
        sliderContainer.scrollLeft += 1; // Slow auto scroll
        // Reset if at end (simple loop)
        if (sliderContainer.scrollLeft >= (sliderContainer.scrollWidth - sliderContainer.clientWidth)) {
            sliderContainer.scrollLeft = 0; 
        }
    }, 20); 
};

const stopAutoScroll = () => {
    clearInterval(sliderInterval);
};

// Manual Scroll Interaction
sliderContainer.addEventListener('mousedown', stopAutoScroll);
sliderContainer.addEventListener('touchstart', stopAutoScroll);
sliderContainer.addEventListener('mouseup', startAutoScroll);
sliderContainer.addEventListener('touchend', startAutoScroll);
sliderContainer.addEventListener('mouseleave', startAutoScroll);


// --- SCIENCE MODAL LOGIC ---
const scienceModal = $('scienceModal');
const scienceGrid = $('scienceGrid');

// --- UPDATED SCIENCE MODAL (Starts Timer on Click) ---
const openScienceModal = () => {
    scienceGrid.textContent = ''; // Clear via textContent
    scienceSubjects.forEach(sub => {
        const div = document.createElement('div');
        div.style.textAlign = 'center';
        div.style.cursor = 'pointer';
        
        const img = document.createElement('img');
        img.src = sub.img;
        img.style.width = '100%';
        img.style.height = '80px';
        img.style.objectFit = 'cover';
        img.style.borderRadius = '8px';
        img.style.border = '2px solid var(--border)';
        
        const textDiv = document.createElement('div');
        textDiv.style.marginTop = '5px';
        textDiv.style.fontSize = '12px';
        textDiv.style.fontWeight = 'bold';
        textDiv.textContent = sub.name;
        
        div.appendChild(img);
        div.appendChild(textDiv);
        
        div.onclick = () => {
            // ‡§Ø‡§π‡§æ‡§Å ‡§≠‡•Ä ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•á‡§Ç
            startStudyTimer(sub.name); 
            searchYouTube(sub.name);
            scienceModal.style.display = 'none';
        };
        scienceGrid.appendChild(div);
    });
    scienceModal.style.display = 'block';
};

$('closeScienceModal').addEventListener('click', () => {
    scienceModal.style.display = 'none';
});

// --- CENTRAL SEARCH FUNCTION ---
const searchYouTube = (subject) => {
    const currentYear = new Date().getFullYear(); // e.g., 2026
    const query = `Class 9 ${subject} ${currentYear} Full Course latest`;
    window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`, '_blank');
};


$('langSel').addEventListener('change', handleLanguageChange);
$('timeFormatSel').addEventListener('change', handleTimeFormatChange);
$('autoBtn').addEventListener('click', autoGenerate);
$('applyBtn').addEventListener('click', () => { saveSlotsData(); alert(getBilingualText('Routine Saved!', '‡§∞‡•Ç‡§ü‡•Ä‡§® ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!')); });
$$('#examName, #targetDate, #dutyStart, #dutyEnd, #wakeUpTime, #studentStudyGoal, #dutyStudyGoal, #subjectsList, #focusSubject').forEach(el => el.addEventListener('input', displayStrategy));
$('activityName').addEventListener('input', updateDynamicActivityLabels);
$$('input[name="occupation"]').forEach(radio => { radio.addEventListener('change', (e) => toggleOccupationView(e.target.value, 'main')); });
$$('input[name="profileOccupation"]').forEach(radio => { radio.addEventListener('change', (e) => toggleOccupationView(e.target.value, 'profile')); });

$('studentSetWakeUpManual').addEventListener('change', (e) => { $('studentManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileStudentSetWakeUpManual').addEventListener('change', (e) => { $('profileStudentManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('studentSetSleepManual').addEventListener('change', (e) => { $('studentManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileStudentSetSleepManual').addEventListener('change', (e) => { $('profileStudentManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('dutySetWakeUpManual').addEventListener('change', (e) => { $('dutyManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileDutySetWakeUpManual').addEventListener('change', (e) => { $('profileDutyManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('dutySetSleepManual').addEventListener('change', (e) => { $('dutyManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileDutySetSleepManual').addEventListener('change', (e) => { $('profileDutyManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });

$('studentAddActivityCheckbox').addEventListener('change', (e) => { $('studentActivityWrapper').style.display = e.target.checked ? 'block' : 'none'; });
$('profileStudentAddActivityCheckbox').addEventListener('change', (e) => { $('profileStudentActivityWrapper').style.display = e.target.checked ? 'block' : 'none'; });
const handleShiftChange = (isProfile = false) => {
const radioName = isProfile ? 'profileShiftType' : 'shiftType';
$$(`input[name="${radioName}"]`).forEach(radio => {
radio.addEventListener('change', (e) => {
const startId = isProfile ? 'profileDutyStart' : 'dutyStart';
const endId = isProfile ? 'profileDutyEnd' : 'dutyEnd';
const startInput = $(startId);
const endInput = $(endId);
if (e.target.value === 'day') { startInput.value = '09:00'; endInput.value = '18:00'; }
else if (e.target.value === 'night') { startInput.value = '22:00'; endInput.value = '06:00'; }
if (!isProfile) updateDynamicActivityLabels();
});
});
};
handleShiftChange(false);
handleShiftChange(true);
const handleTimeFocus = (isProfile = false) => {
const startId = isProfile ? 'profileDutyStart' : 'dutyStart';
const endId = isProfile ? 'profileDutyEnd' : 'dutyEnd';
const startInput = $(startId);
const endInput = $(endId);
const radioName = isProfile ? 'profileShiftType' : 'shiftType';
[startInput, endInput].forEach(input => {
input.addEventListener('focus', () => {
if (!input.value) {
const shift = document.querySelector(`input[name="${radioName}"]:checked`).value;
if (shift === 'day') { input.value = input.id === startId ? '09:00' : '18:00'; }
else { input.value = input.id === startId ? '22:00' : '06:00'; }
}
});
});
};
handleTimeFocus(false);
handleTimeFocus(true);
const titleElement = document.querySelector('.app-title');
if (titleElement) { titleElement.addEventListener('click', () => { const color1 = `hsl(${Math.random() * 360}, 100%, 70%)`; const color2 = `hsl(${Math.random() * 360}, 100%, 70%)`; titleElement.style.backgroundImage = `linear-gradient(45deg, ${color1}, ${color2})`; }); }
setInterval(fetchDeepFact, 60000); // Changed to use Fact Engine
$('menuBtn').addEventListener('click', e => { e.stopPropagation(); const menu = $('dropdownMenu'); menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; });
$('dropdownMenu').addEventListener('click', e => e.stopPropagation());
document.addEventListener('click', () => { if($('dropdownMenu')) $('dropdownMenu').style.display = 'none'; });
$('menuProfileBtn').addEventListener('click', e => { e.preventDefault(); openProfileModal(); });
$$('.card-header').forEach(header => { header.addEventListener('click', () => { const card = header.parentElement; const body = card.querySelector('.card-body, .card-body-no-padding'); card.classList.toggle('open'); body.style.display = body.style.display === 'block' ? 'none' : 'block'; }); });
[$('closeProfileModal'), $('cancelProfile')].forEach(el => el.addEventListener('click', () => $('profileModal').style.display = 'none'));
$('saveProfile').addEventListener('click', saveProfile);
$('slots').addEventListener('click', e => {
const btn = e.target.closest('.slot-edit-btn');
if (!btn) return;
const id = btn.dataset.id;
const slot = slotsData.find(s => s.id === id);
if (slot) {
$('slotEditId').value = id;
$('slotEditTitle').textContent = getBilingualText(`Edit "${slot.label_en}"`, `"${slot.label_hi}" ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç`);
$('slotEditTime').value = slot.time;
$('slotEditMsgHi').value = slot.msg_hi;
$('slotEditMsgEn').value = slot.msg_en;
$('slotEditModal').style.display = 'block';
}
});
$('saveSlot').addEventListener('click', () => {
const id = $('slotEditId').value;
const idx = slotsData.findIndex(s => s.id === id);
if (idx > -1) {
slotsData[idx].time = $('slotEditTime').value;
slotsData[idx].msg_hi = $('slotEditMsgHi').value.trim();
slotsData[idx].msg_en = $('slotEditMsgEn').value.trim();
saveSlotsData();
renderSlots();
}
$('slotEditModal').style.display = 'none';
});
$('closeSlotEdit').addEventListener('click', () => $('slotEditModal').style.display = 'none');
const adminModal = $('adminModal');
$('adminLoginBtn').addEventListener('click', (e) => {
e.preventDefault();
const storedPassword = localStorage.getItem('admin_password') || 'admin123';
const enteredPassword = prompt(getBilingualText('Enter Admin Password:', '‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç:'));
if (enteredPassword === storedPassword) {
try {
$('adminProfileData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_profile') || '{}'), null, 2);
$('adminSlotsData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_slots') || '[]'), null, 2);
$('adminQuotesData').value = "This section is now managed internally by categories (Hindi, Shayari, Shlokas). To edit, please modify the `initializeData` function in the source code.";
$('adminAudioData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_audio') || '[]'), null, 2);
$('adminAppsData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_study_apps') || '[]'), null, 2);
adminModal.style.display = 'block';
} catch (err) { alert('Error loading data.'); }
} else if (enteredPassword !== null) {
alert(getBilingualText('Access Denied.', '‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§'));
}
});
$('changePasswordBtn').addEventListener('click', () => {
const newPass = $('newPassword').value.trim();
if (!newPass) { alert(getBilingualText('Please enter a new password.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç‡•§')); return; }
localStorage.setItem('admin_password', newPass);
$('newPassword').value = '';
alert(getBilingualText('Password changed successfully!', '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§¶‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!'));
});
$('addAudioTrack').addEventListener('click', () => {
const name = $('newAudioName').value.trim(), url = $('newAudioUrl').value.trim(), imageUrl = $('newAudioImageUrl').value.trim();
if (!name || !url) { alert(getBilingualText('Please fill name and URL.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ URL ‡§≠‡§∞‡•á‡§Ç‡•§')); return; }
try {
let audioData = JSON.parse($('adminAudioData').value || '[]');
if (!Array.isArray(audioData)) audioData = [];
audioData.push({ name, url, imageUrl: imageUrl || '' });
$('adminAudioData').value = JSON.stringify(audioData, null, 2);
$('newAudioName').value = '';
$('newAudioUrl').value = '';
$('newAudioImageUrl').value = '';
alert(getBilingualText('Audio track added!', '‡§ë‡§°‡§ø‡§Ø‡•ã ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!'));
} catch (e) { alert(getBilingualText('Error adding track. Check JSON format.', '‡§ü‡•ç‡§∞‡•à‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ JSON ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§')); }
});
$('addStudyApp').addEventListener('click', () => {
    const name = $('newAppName').value.trim();
    const linkUrl = $('newAppUrl').value.trim();
    const imageUrl = $('newAppImageUrl').value.trim();
    if (!name || !linkUrl || !imageUrl) {
        alert(getBilingualText('Please fill name, link URL, and image URL.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ, ‡§≤‡§ø‡§Ç‡§ï URL ‡§î‡§∞ ‡§á‡§Æ‡•á‡§ú URL ‡§≠‡§∞‡•á‡§Ç‡•§'));
        return;
    }
    try {
        let appsData = JSON.parse($('adminAppsData').value || '[]');
        if (!Array.isArray(appsData)) appsData = [];
        appsData.push({ name, linkUrl, imageUrl });
        $('adminAppsData').value = JSON.stringify(appsData, null, 2);
        $('newAppName').value = '';
        $('newAppUrl').value = '';
        $('newAppImageUrl').value = '';
        alert(getBilingualText('Study app added to the list!', '‡§∏‡•ç‡§ü‡§°‡•Ä ‡§ê‡§™ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à!'));
    } catch (e) {
        alert(getBilingualText('Error adding app. Check JSON format.', '‡§ê‡§™ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ JSON ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§'));
    }
});
$('closeAdminModal').addEventListener('click', () => adminModal.style.display = 'none');
$('adminSaveBtn').addEventListener('click', () => {
    const saveData = (key, textareaId, fieldName) => {
        try {
            if (key === 'smart_quotes') return true;
            JSON.parse($(textareaId).value); 
            localStorage.setItem(key, $(textareaId).value);
            return true;
        } catch (e) {
            alert(getBilingualText(`Error in ${fieldName} Data: Invalid JSON format.`, `‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ${fieldName} ‡§°‡•á‡§ü‡§æ ‡§Æ‡•á‡§Ç: ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø JSON ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡•§`));
            return false;
        }
    };

    if (
        saveData('smart_profile', 'adminProfileData', 'Profile') &&
        saveData('smart_slots', 'adminSlotsData', 'Slots') &&
        saveData('smart_audio', 'adminAudioData', 'Audio') &&
        saveData('smart_study_apps', 'adminAppsData', 'Study Apps')
    ) {
        alert(getBilingualText('Admin data saved!', '‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!'));
        adminModal.style.display = 'none';
        refreshUI();
    }
});
$('adminResetBtn').addEventListener('click', () => { if (confirm(getBilingualText('Are you sure you want to reset EVERYTHING?', '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?'))) { localStorage.clear(); alert(getBilingualText('All data has been reset.', '‡§∏‡§æ‡§∞‡§æ ‡§°‡•á‡§ü‡§æ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§')); location.reload(); } });
// --- NOTES SHARING EVENT LISTENERS ---
$('shareNoteBtn').addEventListener('click', () => { $('noteSubmissionModal').style.display = 'block'; });
$('closeNoteSubmissionModal').addEventListener('click', () => { $('noteSubmissionModal').style.display = 'none'; });
$('submitNoteBtn').addEventListener('click', () => {
const author = $('noteAuthor').value.trim();
const title = $('noteTitle').value.trim();
const content = $('noteContent').value.trim();
if (!author || !title || !content) { alert(getBilingualText('Please fill all fields.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§')); return; }
const adminEmail = "Indianroutingai@gmail.com";
const subject = encodeURIComponent("New Note Submission for Indian Routine");
const body = encodeURIComponent( `Hi Admin,\n\nA new note has been submitted for review.\n\nAuthor: ${author}\nTitle: ${title}\nContent/URL: ${content}\n\nPlease review and post it on Blogspot if approved.` );
window.location.href = `mailto:${adminEmail}?subject=${subject}&body=${body}`;
$('noteSubmissionModal').style.display = 'none';
$('noteAuthor').value = '';
$('noteTitle').value = '';
$('noteContent').value = '';
alert(getBilingualText('Thank you! Your email client has been opened to send the note for review.', '‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•ã‡§ü ‡§≠‡•á‡§ú‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§Ü‡§™‡§ï‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ñ‡•ã‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§'));
});

// NEW: INTERNAL BROWSER LOGIC (IN-APP FULL SCREEN NORMAL MODE WITH REAL LOADER)
const openInternalBrowser = (url) => {
    $('notesOptionModal').style.display = 'none'; // Close notes option menu if open
    $('mapOptionModal').style.display = 'none'; // Close map option menu if open
    
    const browserModal = $('internalBrowserModal');
    const iframe = $('internalFrame');
    const loader = $('browserLoader');

    // Reset state for new open
    iframe.style.display = 'none';
    loader.style.display = 'block';
    
    // Show Full Screen Modal
    browserModal.style.display = 'block';

    // Set URL
    iframe.src = url;

    // REAL LOADER LOGIC: Hide loader when iframe loads
    iframe.onload = () => {
        loader.style.display = 'none';
        iframe.style.display = 'block';
    };
};

$('readNotesBtn').addEventListener('click', () => {
    openInternalBrowser("https://indianroutineai.blogspot.com");
});

$('closeInternalBrowser').addEventListener('click', () => {
    $('internalBrowserModal').style.display = 'none';
    $('internalFrame').src = ''; // Clear source to stop media/reset
});

// NEW: Event Listeners for NEW BUTTONS
$('communityNotesMainBtn').addEventListener('click', () => { $('notesOptionModal').style.display = 'block'; });
$('closeNotesOptionModal').addEventListener('click', () => { $('notesOptionModal').style.display = 'none'; });

$('perDayTestBtn').addEventListener('click', () => { $('perDayTestModal').style.display = 'block'; });
$('closePerDayTestModal').addEventListener('click', () => { $('perDayTestModal').style.display = 'none'; });

// MAP BUTTON LOGIC
$('mapBtn').addEventListener('click', () => { $('mapOptionModal').style.display = 'block'; });
$('closeMapOptionModal').addEventListener('click', () => { $('mapOptionModal').style.display = 'none'; });

$('indiaMapBtn').addEventListener('click', () => {
    openInternalBrowser("https://upload.wikimedia.org/wikipedia/commons/b/b3/India_political_map_2019_EN.svg");
});
$('worldMapBtn').addEventListener('click', () => {
    openInternalBrowser("https://upload.wikimedia.org/wikipedia/commons/3/33/Physical_Political_World_Map.jpg");
});

// BOOKS BUTTON LOGIC
$('booksBtn').addEventListener('click', () => { $('booksModal').style.display = 'block'; });
$('closeBooksModal').addEventListener('click', () => { $('booksModal').style.display = 'none'; });

// FACT ENGINE LISTENERS
document.getElementById('nextFactBtn').addEventListener('click', fetchDeepFact);

const audioPlayer = $('audioPlayer'), playPauseBtn = $('audioPlayPauseBtn'), trackSelect = $('audioTrackSelect'), trackImage = $('audioTrackImage');
playPauseBtn.addEventListener('click', () => { if (!trackSelect.value) return; if (audioPlayer.paused) audioPlayer.play(); else audioPlayer.pause(); });
audioPlayer.addEventListener('play', () => { playPauseBtn.textContent = '‚ùö‚ùö'; });
audioPlayer.addEventListener('pause', () => { playPauseBtn.textContent = '‚ñ∂'; });
trackSelect.addEventListener('change', () => {
const selectedOption = trackSelect.options[trackSelect.selectedIndex];
audioPlayer.src = selectedOption.value;
trackImage.src = selectedOption.dataset.imageUrl;
trackImage.style.display = selectedOption.dataset.imageUrl ? 'block' : 'none';
if (selectedOption.value) audioPlayer.play();
else audioPlayer.pause();
});
window.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.style.display = 'none'; });
const twentyFourHoursInMillis = 24 * 60 * 60 * 1000;
const funnyInsults = [ { en: "Wow, champ! At this pace, you'll finish the syllabus by the next election.", hi: "‡§µ‡§æ‡§π ‡§∞‡§æ‡§ú‡§æ! ‡§á‡§∏ ‡§∞‡§´‡§º‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§§‡•ã ‡§Ö‡§ó‡§≤‡§æ ‡§ö‡•Å‡§®‡§æ‡§µ ‡§Ü‡§§‡•á-‡§Ü‡§§‡•á ‡§∏‡§ø‡§≤‡•á‡§¨‡§∏ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã‡§ó‡§æ‡•§" }, { en: "Studied for 5 minutes? The country is proud of your sacrifice.", hi: "5 ‡§Æ‡§ø‡§®‡§ü ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§∞ ‡§≤‡•Ä? ‡§¶‡•á‡§∂ ‡§ï‡•ã ‡§§‡•Å‡§Æ ‡§™‡§∞ ‡§ó‡§∞‡•ç‡§µ ‡§π‡•à‡•§" }, { en: "Is this a study session or a commercial break?", hi: "‡§Ø‡§π ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡§æ ‡§∏‡•á‡§∂‡§® ‡§•‡§æ ‡§Ø‡§æ ‡§ï‡§Æ‡§∞‡•ç‡§∂‡§ø‡§Ø‡§≤ ‡§¨‡•ç‡§∞‡•á‡§ï?" } ];
const goodJobMessages = [ { en: "Great job! Keep up the momentum.", hi: "‡§¨‡§π‡•Å‡§§ ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ! ‡§á‡§∏‡•Ä ‡§≤‡§ó‡§® ‡§∏‡•á ‡§≤‡§ó‡•á ‡§∞‡§π‡•ã‡•§" }, { en: "Excellent work! Every minute counts.", hi: "‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§ï‡§æ‡§Æ! ‡§π‡§∞ ‡§Æ‡§ø‡§®‡§ü ‡§Æ‡§æ‡§Ø‡§®‡•á ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à‡•§" }, { en: "That's a solid session. You're on the right track!", hi: "‡§Ø‡§π ‡§è‡§ï ‡§†‡•ã‡§∏ ‡§∏‡•á‡§∂‡§® ‡§•‡§æ‡•§ ‡§§‡•Å‡§Æ ‡§∏‡§π‡•Ä ‡§∞‡§æ‡§∏‡•ç‡§§‡•á ‡§™‡§∞ ‡§π‡•ã!" } ];
const formatStudyTime = (ms) => {
    if (isNaN(ms) || ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const h = Math.floor(totalSeconds / 3600);
    const m = Math.floor((totalSeconds % 3600) / 60);
    const s = totalSeconds % 60;
    return `${h}h ${m}m ${s}s`;
};

// ============================================
// ULTRA INTELLIGENT REALITY CHECK (HINDI UPDATE)
// ============================================
const updateRealityCheck = () => {
    const profile = getProfile();
    let goalHours = 0;
    if (profile.occupation === 'student') {
        goalHours = parseFloat(profile.studentStudyGoal) || 8;
    } else {
        goalHours = parseFloat(profile.dutyStudyGoal) || 3;
    }

    const todayMs = parseInt(localStorage.getItem('today_study_time') || '0');
    const goalMs = goalHours * 60 * 60 * 1000;

    let percentage = (todayMs / goalMs) * 100;
    if (percentage > 100) percentage = 100;
    
    const progressBar = $('realityProgressBar');
    const overlayContainer = document.querySelector('.reality-text-overlay'); 
    
    if (!progressBar) return;

    // INTELLIGENT TIME CALCULATION
    const now = new Date();
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    
    // Study IDs
    const studyIds = [
        'morning_study', 'main_study', 
        'study1', 'study2', 'study3', 'study4', 'study5', 'study6', 'study7', 'study8',
        'practice', 'current_affairs'
    ];
    
    const sortedSlots = [...slotsData].sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
    let expectedMinutesStudied = 0;

    for (let i = 0; i < sortedSlots.length - 1; i++) {
        const currentSlot = sortedSlots[i];
        const nextSlot = sortedSlots[i+1];
        
        if (studyIds.includes(currentSlot.id)) {
            const startM = timeToMinutes(currentSlot.time);
            const endM = timeToMinutes(nextSlot.time);
            
            if (currentMinutes >= endM) {
                if (endM > startM) expectedMinutesStudied += (endM - startM);
            }
            else if (currentMinutes > startM && currentMinutes < endM) {
                expectedMinutesStudied += (currentMinutes - startM);
            }
        }
    }

    const actualMinutesStudied = Math.floor(todayMs / 60000);
    const timeLost = expectedMinutesStudied - actualMinutesStudied;
    const isBehindSchedule = timeLost > 30; // 30 min buffer

    // UI UPDATE
    progressBar.style.width = `${percentage}%`;
    
    // Using textContent and Creating Elements instead of innerHTML
    overlayContainer.textContent = ''; // Clear

    if (isBehindSchedule) {
        // --- DANGER MODE (RED) ---
        progressBar.classList.add('danger-mode');
        
        // Hindi Time Formatting
        const lostH = Math.floor(timeLost / 60);
        const lostM = timeLost % 60;
        
        let timeString = "";
        if (lostH > 0) {
            timeString = `${lostH} ‡§ò‡§Ç‡§ü‡•á ${lostM} ‡§Æ‡§ø‡§®‡§ü`;
        } else {
            timeString = `${lostM} ‡§Æ‡§ø‡§®‡§ü`;
        }

        // PURE HINDI MESSAGE
        const msgHi = `‡§Ü‡§™‡§®‡•á ${timeString} ‡§¨‡§∞‡•ç‡§¨‡§æ‡§¶ ‡§ï‡§∞ ‡§¶‡§ø‡§è!`;
        
        const span = document.createElement('span');
        span.className = 'status-text-bad';
        span.style.fontSize = '13px';
        span.style.letterSpacing = '0.5px';
        span.style.fontWeight = '700'; // Bolder
        span.textContent = `‚ö†Ô∏è ${msgHi} ‚ö†Ô∏è`;
        overlayContainer.appendChild(span);

    } else {
        // --- SUCCESS MODE (GREEN) ---
        progressBar.classList.remove('danger-mode');
        const percentVal = Math.round(percentage);
        const percentLeft = 100 - percentVal;
        
        if (percentVal >= 100) {
            const span = document.createElement('span');
            span.className = 'status-text-good';
            span.style.fontWeight = '700'; // Bolder
            span.textContent = 'üéâ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü! (GOAL COMPLETED)';
            overlayContainer.appendChild(span);
        } else {
            const span1 = document.createElement('span');
            span1.className = 'status-text-good';
            span1.style.marginRight = 'auto';
            span1.style.fontWeight = '700'; // Bolder
            span1.textContent = `${percentVal}% ‡§™‡•Ç‡§∞‡•ç‡§£ (DONE)`;
            
            const span2 = document.createElement('span');
            span2.className = 'status-text-good';
            span2.style.fontWeight = '700'; // Bolder
            span2.textContent = `${percentLeft}% ‡§¨‡§æ‡§ï‡•Ä (LEFT)`;
            
            overlayContainer.appendChild(span1);
            overlayContainer.appendChild(span2);
        }
    }
};

const updateStudyDisplay = () => {
    const todayMs = parseInt(localStorage.getItem('today_study_time') || '0');
    const totalMs = parseInt(localStorage.getItem('total_study_time') || '0');
    $('todayStudyTime').textContent = formatStudyTime(todayMs);
    $('totalStudyTime').textContent = formatStudyTime(totalMs);

    // Call Reality Check Update Here
    updateRealityCheck();

    const subjectTimes = JSON.parse(localStorage.getItem('subject_study_time') || '{}');
    const statsContainer = $('subjectStatsDisplay');
    statsContainer.textContent = ''; // Clear via textContent
    
    if (Object.keys(subjectTimes).length === 0) {
        const msg = document.createElement('span');
        msg.style.color = 'var(--muted)';
        msg.dataset.hi = "‡§Ü‡§ú ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§™‡§¢‡§º‡§æ ‡§ó‡§Ø‡§æ‡•§";
        msg.dataset.en = "No subjects studied today.";
        msg.textContent = getBilingualText("No subjects studied today.", "‡§Ü‡§ú ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§™‡§¢‡§º‡§æ ‡§ó‡§Ø‡§æ‡•§");
        statsContainer.appendChild(msg);
    } else {
        for (const subject in subjectTimes) {
            const timeString = formatStudyTime(subjectTimes[subject]);
            const statDiv = document.createElement('div');
            
            const strong = document.createElement('strong');
            strong.textContent = `${subject}: `;
            
            statDiv.appendChild(strong);
            statDiv.appendChild(document.createTextNode(timeString));
            
            statsContainer.appendChild(statDiv);
        }
    }
    updateTextContent();
};

const renderStudyApps = () => {
    const grid = $('studyAppGrid');
    grid.textContent = ''; // Clear via textContent
    const studyApps = JSON.parse(localStorage.getItem('smart_study_apps') || '[]');
    studyApps.forEach(app => {
        const appDiv = document.createElement('div');
        appDiv.className = 'app-item';
        appDiv.dataset.linkUrl = app.linkUrl;
        
        const img = document.createElement('img');
        img.src = app.imageUrl;
        img.alt = `${app.name} Logo`;
        
        const span = document.createElement('span');
        span.textContent = app.name;
        
        appDiv.appendChild(img);
        appDiv.appendChild(span);
        grid.appendChild(appDiv);
    });
};

const startStudyTimer = (subject) => {
    if (localStorage.getItem('study_session_data')) return;
    const sessionData = {
        startTime: Date.now(),
        subject: subject
    };
    localStorage.setItem('study_session_data', JSON.stringify(sessionData));
};

const stopStudyTimer = () => {
    const sessionDataString = localStorage.getItem('study_session_data');
    if (!sessionDataString) return;

    const sessionData = JSON.parse(sessionDataString);
    const startTime = sessionData.startTime;
    const subject = sessionData.subject;
    
    const sessionDuration = Date.now() - startTime;
    localStorage.removeItem('study_session_data');

    if (sessionDuration < 1000) return;

    const totalMs = parseInt(localStorage.getItem('total_study_time') || '0') + sessionDuration;
    localStorage.setItem('total_study_time', totalMs.toString());

    const lastReset = parseInt(localStorage.getItem('study_time_last_reset') || '0');
    let todayMs = parseInt(localStorage.getItem('today_study_time') || '0');
    let subjectTimes = JSON.parse(localStorage.getItem('subject_study_time') || '{}');

    if (Date.now() - lastReset > twentyFourHoursInMillis) {
        todayMs = 0;
        subjectTimes = {}; // Reset subject times daily
        localStorage.setItem('study_time_last_reset', Date.now().toString());
    }
    
    const newTodayMs = todayMs + sessionDuration;
    localStorage.setItem('today_study_time', newTodayMs.toString());

    subjectTimes[subject] = (subjectTimes[subject] || 0) + sessionDuration;
    localStorage.setItem('subject_study_time', JSON.stringify(subjectTimes));

    updateStudyDisplay();

    let message;
    if (sessionDuration < 30 * 60 * 1000) {
        message = funnyInsults[Math.floor(Math.random() * funnyInsults.length)];
    } else {
        message = goodJobMessages[Math.floor(Math.random() * goodJobMessages.length)];
    }
    alert(`${getBilingualText(message.en, message.hi)} (Studied ${subject} for: ${formatStudyTime(sessionDuration)})`);
};

$('studyAppGrid').addEventListener('click', (e) => {
    e.preventDefault();
    const appItem = e.target.closest('.app-item');
    if (!appItem) return;

    const linkUrl = appItem.dataset.linkUrl;
    const profile = getProfile();
    const subjects = profile.subjects || [];

    if (subjects.length === 0) {
        alert(getBilingualText('Please set your subjects in the "Setup & Strategy" section first.', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á "‡§∏‡•á‡§ü‡§Ö‡§™ ‡§î‡§∞ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§ü‡§ú‡•Ä" ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡•á ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§'));
        return;
    }
    
    const subjectListContainer = $('subjectListContainer');
    subjectListContainer.textContent = ''; // Clear
    
    subjects.forEach(subject => {
        const subjectDiv = document.createElement('div');
        subjectDiv.className = 'subject-item';
        subjectDiv.textContent = subject;
        subjectDiv.onclick = () => {
            startStudyTimer(subject);
            $('subjectSelectorModal').style.display = 'none';

            if (linkUrl.includes('youtube.com')) {
                // --- SMART YOUTUBE SEARCH ---
                const profile = getProfile();
                const studentClass = profile.studentClass;
                const currentYear = new Date().getFullYear(); 
                let searchQuery = '';

                if (studentClass && studentClass !== 'general') {
                    // School Student: "Class 9 Hindi 2026 Full Course"
                    searchQuery = `Class ${studentClass} ${subject} ${currentYear} Full Course latest`;
                } else {
                    // General/Competition: "UPSC History 2026 Full Course"
                    const exam = profile.exam || 'Competition';
                    searchQuery = `${exam} ${subject} ${currentYear} Full Course latest`;
                }
                const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`;
                window.open(searchUrl, '_blank');

            } else if (linkUrl.includes('play.google.com')) {
                // Corrected: Open link directly. Android handles the deep link automatically.
                window.open(linkUrl, '_blank');
            } else {
                // Normal Website
                window.open(linkUrl, '_blank');
            }
        };
        subjectListContainer.appendChild(subjectDiv);
    });

    $('subjectSelectorModal').style.display = 'block';
});

$('closeSubjectModal').addEventListener('click', () => {
    $('subjectSelectorModal').style.display = 'none';
});


document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        stopStudyTimer();
    }
});

// --- MODAL LOGIC ---
const updateBanner = $('updateBanner');
const updateDetailsModal = $('updateDetailsModal');
const closeUpdateModal = $('closeUpdateModal');

if (updateBanner && updateDetailsModal && closeUpdateModal) {
    updateBanner.addEventListener('click', () => {
        updateDetailsModal.style.display = 'block';
    });
    closeUpdateModal.addEventListener('click', () => {
        updateDetailsModal.style.display = 'none';
    });
}

// NEW: Footer Pages Modal Logic
const setupModal = (btnId, modalId, closeBtnId) => {
    const btn = $(btnId);
    const modal = $(modalId);
    const closeBtn = $(closeBtnId);
    if(btn && modal && closeBtn) {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            modal.style.display = 'block';
        });
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    }
};

setupModal('aboutBtn', 'aboutModal', 'closeAboutModal');
setupModal('privacyBtn', 'privacyModal', 'closePrivacyModal');
setupModal('disclaimerBtn', 'disclaimerModal', 'closeDisclaimerModal');


stopStudyTimer();
renderStudyApps();
updateStudyDisplay();
refreshUI();
};

// === INTELLIGENT VOICE ASSISTANT (J.A.R.V.I.S LITE - HINDI GK EDITION) ===
window.initVoiceAssistant = () => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("Sorry, voice features only work in Chrome.");
        return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'hi-IN'; // Set to Hindi India
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    const fab = document.getElementById('voiceFab');
    const status = document.getElementById('voiceStatus');
    
    recognition.onstart = () => {
        fab.classList.add('listening');
        status.style.display = 'block';
        status.textContent = "Listening...";
        if (navigator.vibrate) navigator.vibrate(50);
    };

    recognition.onend = () => {
        fab.classList.remove('listening');
        status.textContent = "Processing...";
        setTimeout(() => { status.style.display = 'none'; }, 2000);
    };

    const speak = (msg) => {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(msg);
        utter.lang = 'hi-IN'; // Speak in Hindi Accent
        window.speechSynthesis.speak(utter);
    };

    // --- DIRECT ANSWER ENGINE (Wikipedia HINDI) ---
    const fetchSmartAnswer = async (query) => {
        speak("Ek second, main check karta hoon...");
        try {
            // 1. Search for Title in HINDI Wikipedia
            const searchUrl = `https://hi.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=1&namespace=0&format=json&origin=*`;
            const searchRes = await fetch(searchUrl);
            const searchData = await searchRes.json();

            if (searchData[1] && searchData[1].length > 0) {
                const title = searchData[1][0];
                // 2. Get Summary & Image from HINDI Wiki
                const summaryUrl = `https://hi.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
                const summaryRes = await fetch(summaryUrl);
                const summaryData = await summaryRes.json();

                if (summaryData.extract) {
                    // Show in Modal
                    const modal = document.getElementById('voiceAnswerModal');
                    const img = document.getElementById('voiceAnswerImg');
                    const txt = document.getElementById('voiceAnswerText');
                    
                    txt.textContent = summaryData.extract;
                    if(summaryData.thumbnail && summaryData.thumbnail.source) {
                        img.src = summaryData.thumbnail.source;
                        img.style.display = 'block';
                    } else {
                        img.style.display = 'none';
                    }
                    modal.style.display = 'block';
                    
                    // Speak Logic (First 2 sentences)
                    const sentences = summaryData.extract.split('‡•§'); // Split by Hindi full stop
                    const shortSummary = sentences.slice(0, 2).join('‡•§ ') + '‡•§';
                    speak(shortSummary);
                } else {
                    throw new Error("No summary");
                }
            } else {
                throw new Error("No results");
            }
        } catch (e) {
            // Fallback - EDITED: No Apology, Positive Affirmation Only
            speak("Yeh raha aapka uttar.");
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }
    };

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript.toLowerCase();
        status.textContent = `Heard: "${text}"`;
        console.log("Heard:", text);
        
        // --- LOGIC 1: EXPLICIT GOOGLE SEARCH ---
        if (text.includes('google') || text.includes('search')) {
            let query = text.replace('google', '').replace('search', '').replace('kholo', '').replace('open', '').trim();
            speak("Yeh raha aapka uttar: " + query);
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            return;
        }

        // --- LOGIC 2: APP COMMANDS ---
        if (text.includes('youtube')) {
            speak('YouTube khol raha hoon');
            window.open('https://youtube.com', '_blank');
        } 
        else if (text.includes('khan sir')) {
            speak('Khan Sir App khol raha hoon');
            window.open('https://play.google.com/store/apps/details?id=xyz.penpencil.khansirofficial', '_blank');
        }
        else if (text.includes('map') || text.includes('naksha')) {
            speak('Map khol raha hoon');
            document.getElementById('mapOptionModal').style.display = 'block';
        }
        else if (text.includes('start study') || text.includes('padhai shuru')) {
            speak('Timer shuru kar diya hai. Good luck!');
            const subject = "Voice Study";
            if (!localStorage.getItem('study_session_data')) {
                 const sessionData = { startTime: Date.now(), subject: subject };
                 localStorage.setItem('study_session_data', JSON.stringify(sessionData));
            }
        }
        else if (text.includes('stop') || text.includes('roko')) {
            speak('Timer band kar raha hoon.');
            alert("Timer Stopped."); 
            location.reload(); 
        }
        else if (text.includes('next task') || text.includes('agla')) {
            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();
            const slots = JSON.parse(localStorage.getItem('smart_slots') || '[]');
            const getMins = (t) => { const [h,m] = t.split(':').map(Number); return h*60+m; };
            
            let nextSlot = null;
            slots.sort((a,b) => getMins(a.time) - getMins(b.time));
            
            for(let s of slots) {
                if(getMins(s.time) > currentMins) {
                    nextSlot = s;
                    break;
                }
            }
            if(nextSlot) {
                const msg = `Agla task hai: ${nextSlot.label_hi || nextSlot.label_en}, ${nextSlot.time} baje.`;
                speak(msg);
            } else {
                speak('Aaj ke sabhi task poore ho gaye.');
            }
        }
        // --- LOGIC 3: DIRECT ANSWER (GK ENGINE) ---
        else {
            // This fetches info from HINDI Wikipedia and speaks it
            fetchSmartAnswer(text);
        }
    };

    recognition.start();
};

init();
});
</script>
</body>
</html>
```
