
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Indian Routine</title>
<meta name="theme-color" content="#0d1117" />
<style>
:root{ /* New Dark Purple Color Scheme */ --bg:#0d1117; --card:#161b22; --border: #30363d; --muted:#8b949e; --accent:#a371f7; --accent-hover:#b38ff9; --success: #238636; --danger: #da3333; }
*{box-sizing:border-box}
body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif; background-color:var(--bg); color:#c9d1d9; }
.wrap{max-width:820px;margin:12px auto;padding:0 16px}
header{ display:flex; justify-content:space-between; align-items:center; position:relative; padding: 8px 0; margin-bottom: 16px; border-bottom: 1px solid var(--border); }
.header-left { flex: 1; text-align: left; }
.header-center { flex: 2; text-align: center; }
.header-right { flex: 1; text-align: right; }
.app-title { font-size: 24px; font-weight: 900; padding: 8px 16px; border-radius: 8px; cursor: pointer; user-select: none; background-image: linear-gradient(45deg, var(--accent), #f778ba); -webkit-background-clip: text; background-clip: text; color: transparent; border: 1px solid rgba(255, 255, 255, 0.1); }
.user-greeting { font-size: 14px; color: var(--muted); font-weight: 500; }
.card{ background-color:var(--card); border-radius:8px; margin-bottom:16px; border: 1px solid var(--border); }
.card-header { display: flex; justify-content: space-between; align-items: center; padding: 16px; cursor: pointer; font-weight: 600; }
.card-body { padding: 16px; border-top: 1px solid var(--border); display: none; }
.card-body-no-padding { padding: 0 16px 16px; border-top: 1px solid var(--border); display: none; }
.toggle-icon { transition: transform 0.2s; }
.open .toggle-icon { transform: rotate(90deg); }
label{display:block; color:var(--muted); font-size:14px; margin-bottom:8px; font-weight: 500;}
.row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom: 12px;}
.flex-item { flex: 1; min-width: 120px; }
input,select,textarea{ background-color:#010409; border:1px solid var(--border); padding:10px; border-radius:6px; color:#c9d1d9; width: 100%; font-family: inherit; }
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 20%, transparent); }
.btn{ background-color:var(--accent); border:1px solid var(--accent); color:#fff; padding:10px 16px; border-radius:6px; font-weight:600; cursor:pointer; transition: background-color 0.2s; text-decoration: none; text-align: center; }
.btn:hover{ background-color: var(--accent-hover); }
.btn-secondary { background-color: #21262d; border-color: var(--border); color: #c9d1d9; }
.btn-secondary:hover { border-color: var(--muted); background-color: #30363d;}
.btn-danger { background-color: #da3333; border-color: #da3333; color: #fff; }
.btn-danger:hover { background-color: #f85149; border-color: #f85149; }
.slot{ display:grid; grid-template-columns: 70px 1fr auto; gap: 8px 16px; padding:12px; border-radius:8px; margin-bottom:8px; background-color:color-mix(in srgb, var(--accent) 5%, transparent); border-left:4px solid var(--slot-color, var(--accent)); align-items: center; }
.slot .time{ grid-column: 1; grid-row: 1 / 3; font-weight:700; font-size:18px; color:#fff; text-align: center;}
.slot .label{ grid-column: 2; font-weight:600; color:#c9d1d9;}
.slot .tip{ grid-column: 2; font-size:12px; color:var(--muted); font-style:italic;}
.slot-edit-btn { grid-column: 3; grid-row: 1 / 3; background: none; border: none; cursor: pointer; padding: 4px; margin-left: auto; border-radius: 50%; line-height: 0; }
.slot-edit-btn:hover { background-color: rgba(255,255,255,0.1); }
@keyframes motivationGlow { 0%, 100% { box-shadow: 0 0 4px color-mix(in srgb, var(--accent) 20%, transparent), 0 0 8px color-mix(in srgb, var(--accent) 10%, transparent); } 50% { box-shadow: 0 0 12px color-mix(in srgb, var(--accent) 40%, transparent), 0 0 20px color-mix(in srgb, var(--accent) 20%, transparent); } }
.motivation{ text-align:center; font-size:14px; color:var(--muted); font-style:italic; padding:20px; border-radius:8px; background-color:var(--card); margin-bottom:16px; border:1px solid var(--border); transition: all 0.5s ease; animation: motivationGlow 8s infinite ease-in-out; }
.strategy{ font-size:14px; color:#c9d1d9; line-height:1.6; }
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.7);}
.modal-content{background-color:var(--card);margin:10% auto;padding:24px;border-radius:8px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;border:1px solid var(--border);}
#alarmModal .modal-content { text-align: center; animation: pulse 1.2s infinite; }
#alarmModal h2 { color: var(--accent); font-size: 28px; }
@keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 color-mix(in srgb, var(--accent) 70%, transparent); } 70% { transform: scale(1.02); box-shadow: 0 0 10px 20px color-mix(in srgb, var(--accent) 0%, transparent); } 100% { transform: scale(1); box-shadow: 0 0 0 0 color-mix(in srgb, var(--accent) 0%, transparent); } }
#adminModal .modal-content { max-width: 700px; animation: none; }
.close{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer;}
.close:hover{color:var(--accent);}
.menu-icon {cursor:pointer; padding:8px;}
.menu-icon div {width:5px; height:5px; background-color:#c9d1d9; border-radius:50%; margin-bottom:4px;}
.dropdown-menu {display:none; position:absolute; left:0; top:50px; background-color:var(--card); border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.4); z-index:1001; padding:8px 0; border:1px solid var(--border); min-width: 220px;}
.dropdown-menu a {display:block; padding:10px 16px; color:#c9d1d9; text-decoration:none; font-size:14px;}
.dropdown-menu a:hover {background-color:color-mix(in srgb, var(--accent) 10%, transparent); color:#fff;}
.dropdown-menu .setting {padding:10px 16px;}
footer { text-align: center; padding: 24px 0; margin-top: 16px; border-top: 1px solid var(--border); font-size: 12px; color: var(--muted); }
footer a { color: var(--muted); text-decoration: none; font-weight: 600; margin: 0 8px; }
footer a:hover { color: var(--accent); }
#adminLoginBtn { font-size: 0; display: inline-block; width: 6px; height: 6px; background-color: var(--muted); border-radius: 50%; transition: background-color 0.2s ease; margin-top: 10px;}
#adminLoginBtn:hover { background-color: var(--accent); }
.audio-display-area { display: flex; align-items: center; gap: 16px; }
#audioTrackImage { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); background-color: #010409; }
.audio-player-controls { display: flex; align-items: center; gap: 12px; flex-grow: 1; }
#audioPlayPauseBtn { width: 40px; height: 40px; border-radius: 50%; line-height: 40px; text-align: center; padding: 0; flex-shrink: 0;}
#audioTrackSelect { flex: 1; }
/* Slot Colors */
.slot[data-id=wake] {--slot-color:#238636;}
.slot[data-id=morning_study], .slot[data-id=study1], .slot[data-id=study2], .slot[data-id=study3], .slot[data-id=study4], .slot[data-id=study5] {--slot-color:#e3b341;}
.slot[data-id=leave] {--slot-color:#58a6ff;}
.slot[data-id=duty_start] {--slot-color:#da3633;}
.slot[data-id=duty_end] {--slot-color:#da3633;}
.slot[data-id=home] {--slot-color:#a371f7;}
.slot[data-id=nap] {--slot-color:#d29922;}
.slot[data-id=main_study] {--slot-color:#f778ba;}
.slot[data-id=break], .slot[data-id=long_break] {--slot-color:#3fb950;}
.slot[data-id=practice] {--slot-color:#f778ba;}
.slot[data-id=current_affairs] {--slot-color:#1f6feb;}
.slot[data-id=other_activity] { --slot-color: #a371f7; }
.slot[data-id=relax] { --slot-color: #3fb950; }
.slot[data-id=dinner] {--slot-color:#8957e5;}
.slot[data-id=sleep] {--slot-color:#8b949e;}
.admin-section { margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.admin-add-form { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
.admin-add-form input { flex: 1; min-width: 150px; }
.admin-add-form button { flex-shrink: 0; }
.app-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 16px; margin-top: 16px; }
.app-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--muted); font-size: 12px; transition: transform 0.2s ease, color 0.2s ease; cursor: pointer; }
.app-item:hover { transform: translateY(-4px); color: #fff; }
.app-item img { width: 64px; height: 64px; border-radius: 16px; margin-bottom: 8px; object-fit: cover; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
@keyframes rainbowGlow { 0%, 100% { border-color: #ff7b72; box-shadow: 0 0 15px rgba(255, 123, 114, 0.8), 0 0 25px rgba(255, 123, 114, 0.6); } 20% { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.8), 0 0 25px rgba(251, 191, 36, 0.6); } 40% { border-color: #3fb950; box-shadow: 0 0 15px rgba(63, 185, 80, 0.8), 0 0 25px rgba(63, 185, 80, 0.6); } 60% { border-color: #58a6ff; box-shadow: 0 0 15px rgba(88, 166, 255, 0.8), 0 0 25px rgba(88, 166, 255, 0.6); } 80% { border-color: #a371f7; box-shadow: 0 0 15px rgba(163, 113, 247, 0.8), 0 0 25px rgba(163, 113, 247, 0.6); } }
#aiCard { animation: rainbowGlow 10s infinite linear; }
#studyCard { background-color: #FF8C00 !important; border-color: #E07B00 !important; }
#studyCard .card-header, #studyCard .card-body { color: #000 !important; }
#studyCard label, #studyCard .flex-item div { color: #000 !important; }
#studyCard input, #studyCard select { background-color: rgba(0, 0, 0, 0.8) !important; color: #c9d1d9 !important; border-color: #E07B00 !important; }
#studyCard .app-item { color: #000 !important; }
#studyCard .app-item:hover { color: #fff !important; }
#studyCard .app-item img { background-color: #FF8C00 !important; }
.occupation-selector { display: flex; gap: 10px; background-color: #010409; padding: 5px; border-radius: 8px; border: 1px solid var(--border); }
.occupation-selector label { flex: 1; padding: 8px; text-align: center; border-radius: 6px; cursor: pointer; transition: background-color 0.2s, color 0.2s; margin: 0; font-size: 14px; color: var(--muted); }
.occupation-selector input { display: none; }
.occupation-selector input:checked + label { background-color: var(--accent); color: white; font-weight: 600; }
.checkbox-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.checkbox-row label { margin-bottom: 0; }
.checkbox-row input[type="checkbox"] { width: auto; }
/* NEW: Styles for Subject Selector Modal */
.subject-item { padding: 12px 16px; border-bottom: 1px solid var(--border); cursor: pointer; }
.subject-item:last-child { border-bottom: none; }
.subject-item:hover { background-color: color-mix(in srgb, var(--accent) 10%, transparent); }
/* Ad Placeholder Styles */
.ad-placeholder { min-height: 50px; width: 100%; background-color: #333; display: flex; align-items: center; justify-content: center; color: #888; font-size: 12px; margin-bottom: 16px; border-radius: 8px; }

/* NEW STYLE FOR MANUAL ALARM MODAL */
#manualAlarmList {
    list-style: none;
    padding: 0;
    margin-top: 16px;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
}
#manualAlarmList li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    line-height: 1.4;
}
#manualAlarmList li:last-child {
    border-bottom: none;
}
#manualAlarmList .time {
    font-weight: 600;
    color: var(--accent);
    flex-shrink: 0;
    margin-left: 16px;
}

/* NEW: Blinking Menu Animation */
@keyframes blinkAnimation {
  0%, 100% {
    background-color: transparent;
    box-shadow: 0 0 4px var(--accent), 0 0 8px var(--accent);
  }
  50% {
    background-color: color-mix(in srgb, var(--accent) 20%, transparent);
    box-shadow: 0 0 12px var(--accent), 0 0 20px var(--accent);
  }
}
.blinking-menu {
  animation: blinkAnimation 1.5s infinite ease-in-out;
  border-radius: 8px;
}
</style>
</head>
<body>

<div class="wrap">
<header>
<div class="header-left">
<div class="menu-icon" id="menuBtn">
<div></div><div></div><div></div>
</div>
</div>
<div class="header-center">
<div class="app-title">Indian Routine</div>
</div>
<div class="header-right">
<div class="user-greeting" id="userGreeting"></div>
</div>
<div id="dropdownMenu" class="dropdown-menu">
<a href="#" id="menuProfileBtn" data-hi="प्रोफ़ाइल सेटअप" data-en="Profile Setup">Profile Setup</a>
<div class="setting">
<label class="small" data-hi="भाषा" data-en="Language">Language</label>
<select id="langSel">
<option value="en">English</option>
<option value="hi">Hindi</option>
<option value="both">Both</option>
</select>
</div>
<div class="setting">
<label class="small" data-hi="टाइम फॉर्मेट" data-en="Time Format">Time Format</label>
<select id="timeFormatSel">
<option value="12h">12-Hour (AM/PM)</option>
<option value="24h">24-Hour</option>
</select>
</div>
</div>
</header>
<div id="aiCard" class="card open">
<div class="card-header">
<span data-hi="AI से पूछें" data-en="Ask AI">Ask AI</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body" style="display: block;">
<p data-hi="अपने डाउट्स सॉल्व करने के लिए नीचे दिए गए किसी भी AI को चुनें।" data-en="Choose any AI below to solve your doubts."></p>
<div class="row">
<a href="https://chat.deepseek.com/" target="_blank" class="btn flex-item" data-hi="Deepseek से पूछें" data-en="Ask Deepseek">Ask Deepseek</a>
<a href="https://x.com/i/grok" target="_blank" class="btn flex-item" data-hi="Grok से पूछें" data-en="Ask Grok">Ask Grok</a>
</div>
<p style="font-size:12px; color:var(--muted); margin-top: 8px;" data-hi="नोट: Grok के लिए X (ट्विटर) प्रीमियम की आवश्यकता हो सकती है।" data-en="Note: Grok may require X (Twitter) Premium."></p>
</div>
</div>
<div id="setupCard" class="card">
<div class="card-header">
<span data-hi="सेटअप और स्ट्रेटजी" data-en="Setup & Strategy">Setup & Strategy</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body">
<div id="detailsInputs">
<div class="row">
<div class="flex-item">
<label class="small" data-hi="आपकी भूमिका" data-en="Your Role">Your Role</label>
<div class="occupation-selector">
<input type="radio" id="roleDuty" name="occupation" value="duty" checked>
<label for="roleDuty" data-hi="पेशेवर" data-en="Professional">Professional</label>
<input type="radio" id="roleStudent" name="occupation" value="student">
<label for="roleStudent" data-hi="छात्र" data-en="Student">Student</label>
</div>
</div>
</div>
<div class="row">
<div class="flex-item"><label class="small" data-hi="परीक्षा" data-en="Exam">Exam</label><input type="text" id="examName" placeholder="e.g., UPSC"></div>
<div class="flex-item"><label class="small" data-hi="लक्ष्य तिथि" data-en="Target Date">Target Date</label><input type="date" id="targetDate"></div>
</div>
<div class="row">
<div class="flex-item" style="grid-column: 1 / -1;">
<label class="small" data-hi="विषय (प्रत्येक लाइन पर एक)" data-en="Subjects (one per line)">Subjects (one per line)</label>
<textarea id="subjectsList" rows="3" placeholder="e.g., History&#10;Math&#10;Science"></textarea>
</div>
</div>
<div class="row">
<div class="flex-item"><label class="small" data-hi="फोकस सब्जेक्ट (कमजोर विषय)" data-en="Focus Subject (Weak Subject)">Focus Subject (Weak Subject)</label><input type="text" id="focusSubject" placeholder="e.g., Math"></div>
</div>
<div id="dutyFields">
<div class="row">
<div class="flex-item">
<label class="small" data-hi="शिफ्ट का प्रकार" data-en="Shift Type">Shift Type</label>
<div class="occupation-selector">
<input type="radio" id="shiftDay" name="shiftType" value="day" checked>
<label for="shiftDay" data-hi="दिन की शिफ्ट" data-en="Day Shift">Day Shift</label>
<input type="radio" id="shiftNight" name="shiftType" value="night">
<label for="shiftNight" data-hi="रात की शिफ्ट" data-en="Night Shift">Night Shift</label>
</div>
</div>
</div>
<div class="row">
<div class="flex-item"><label class="small" data-hi="गतिविधि का नाम" data-en="Activity Name">Activity Name</label><input type="text" id="activityName" placeholder="e.g., Duty, Office"></div>
<div class="flex-item"><label class="small" data-hi="दैनिक अध्ययन लक्ष्य (घंटे)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="dutyStudyGoal" placeholder="e.g., 3" min="1" max="8" step="0.5" value="3"></div>
</div>
<div class="row">
<div class="flex-item"><label class="small"><span class="dynamic-activity-label" data-hi="ड्यूटी" data-en="Duty">Duty</span> <span data-hi="शुरू" data-en="Start">Start</span></label><input type="time" id="dutyStart" value="09:00"></div>
<div class="flex-item"><label class="small"><span class="dynamic-activity-label" data-hi="ड्यूटी" data-en="Duty">Duty</span> <span data-hi="खत्म" data-en="End">End</span></label><input type="time" id="dutyEnd" value="18:00"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="dutySetWakeUpManual">
<label for="dutySetWakeUpManual" data-hi="जागने का समय खुद सेट करें" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="dutyManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="जागने का समय" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="dutyWakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="dutySetSleepManual">
<label for="dutySetSleepManual" data-hi="सोने का समय खुद सेट करें" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="dutyManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="सोने का समय" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="dutySleepTime" value="22:00">
</div>
</div>
</div>
<div id="studentFields" style="display:none;">
<div class="row">
<div class="flex-item"><label class="small" data-hi="दैनिक अध्ययन लक्ष्य (घंटे)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="studentStudyGoal" placeholder="e.g., 8" min="1" max="16" step="0.5" value="8"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentSetWakeUpManual">
<label for="studentSetWakeUpManual" data-hi="जागने का समय खुद सेट करें" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="studentManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="जागने का समय" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="wakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentSetSleepManual">
<label for="studentSetSleepManual" data-hi="सोने का समय खुद सेट करें" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="studentManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="सोने का समय" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="sleepTime" value="22:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="studentAddActivityCheckbox">
<label for="studentAddActivityCheckbox" data-hi="कुछ और गतिविधि जोड़ें" data-en="Add other activity">Add other activity</label>
</div>
<div id="studentActivityWrapper" style="display:none;">
<div class="row">
<div class="flex-item"><label class="small" data-hi="गतिविधि का नाम" data-en="Activity Name">Activity Name</label><input type="text" id="studentActivityName" placeholder="e.g., Play Cricket, Gym"></div>
<div class="flex-item"><label class="small" data-hi="अवधि (घंटे)" data-en="Duration (Hours)">Duration (Hours)</label><input type="number" id="studentActivityDuration" value="1" min="0.5" max="4" step="0.5"></div>
</div>
</div>
</div>
</div>
<div id="profileSummary" style="display:none; color:var(--success); line-height:1.6;"></div>
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
<strong data-hi="आपकी स्ट्रेटजी" data-en="Your Strategy">Your Strategy</strong>
<div id="strategy" class="strategy" style="margin-top:8px;"></div>
</div>
<div style="margin-top:16px;" class="row">
<button id="autoBtn" class="btn btn-secondary" data-hi="रूटीन जेनरेट करें" data-en="Generate Routine">Generate Routine</button>
</div>
</div>
</div>
<div class="motivation" id="motivationQuote">Loading motivation...</div>
<div id="studyCard" class="card">
<div class="card-header">
<span data-hi="स्टडी ऐप्स और टाइमर" data-en="Study Apps & Timer">Study Apps & Timer</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body">
<div class="row">
<div class="flex-item">
<label data-hi="आज का स्टडी टाइम" data-en="Today's Study Time">Today's Study Time</label>
<div id="todayStudyTime" style="font-size: 24px; font-weight: bold; color: var(--success);">0h 0m 0s</div>
</div>
<div class="flex-item">
<label data-hi="कुल स्टडी टाइम" data-en="Total Study Time">Total Study Time</label>
<div id="totalStudyTime" style="font-size: 24px; font-weight: bold; color: var(--accent);">0h 0m 0s</div>
</div>
</div>
<!-- NEW: Subject-wise stats display -->
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
    <label data-hi="आज का विषय-वार अध्ययन" data-en="Today's Subject-wise Study">Today's Subject-wise Study</label>
    <div id="subjectStatsDisplay" style="font-size: 14px; line-height: 1.6;"></div>
</div>
<div style="margin-top:16px; border-top: 1px solid var(--border); padding-top:16px;">
<label data-hi="पढ़ाई शुरू करने के लिए एक ऐप चुनें" data-en="Choose an App to Start Studying">Choose an App to Start Studying</label>
<div id="studyAppGrid" class="app-grid"></div>
<!-- NEW: Add Your New App Button -->
<a href="https://indianroutineai.blogspot.com/p/add-new-app.html" target="_blank" class="btn btn-secondary" style="width: 100%; margin-top: 16px;" data-hi="+ अपना नया ऐप जोड़ें" data-en="+ Add Your New App"></a>
</div>
</div>
</div>
<!-- NEW SIMPLIFIED NOTES CARD -->
<div id="notesCard" class="card">
<div class="card-header">
<span data-hi="सामुदायिक नोट्स" data-en="Community Notes">Community Notes</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body">
<p data-hi="दूसरों के नोट्स पढ़ने या अपना नोट साझा करने के लिए नीचे दिए गए बटन का उपयोग करें।" data-en="Use the buttons below to read notes from others or share your own." style="font-size:14px; color:var(--muted); margin-bottom:20px;"></p>
<button id="readNotesBtn" class="btn" style="width: 100%; margin-bottom: 12px;" data-hi="नोट्स पढ़ें" data-en="Read Notes">Read Notes</button>
<button id="shareNoteBtn" class="btn btn-secondary" style="width: 100%;" data-hi="अपना नोट साझा करें" data-en="Share Your Note">Share Your Note</button>
</div>
</div>
<div id="audioCard" class="card">
<div class="card-header">
<span data-hi="जल्द आ रहा है" data-en="Coming Soon">Coming Soon</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body">
<audio id="audioPlayer" style="display:none;"></audio>
<div class="audio-display-area">
<img id="audioTrackImage" src="" alt="Track Image">
<div class="audio-player-controls">
<button id="audioPlayPauseBtn" class="btn btn-secondary">▶</button>
<select id="audioTrackSelect"></select>
</div>
</div>
</div>
</div>
<div id="routineCard" class="card open">
<div class="card-header">
<span data-hi="दैनिक रूटीन" data-en="Daily Routine">Daily Routine</span>
<span class="toggle-icon">▶</span>
</div>
<div class="card-body-no-padding" style="display: block;">
<div id="slots"></div>
<div style="margin:16px;" class="row">
<button id="applyBtn" class="btn" data-hi="रूटीन सेव करें" data-en="Save Routine">Save Routine</button>
</div>
</div>
</div>
<footer>
    <p>
        <span data-hi="© 2025 Indian Routine। सर्वाधिकार सुरक्षित।" data-en="© 2025 Indian Routine. All Rights Reserved."></span>
    </p>
    <div>
        <a href="#" id="aboutBtn" data-hi="हमारे बारे में" data-en="About Us">About Us</a> |
        <a href="#" id="privacyBtn" data-hi="गोपनीयता नीति" data-en="Privacy Policy">Privacy Policy</a> |
        <a href="#" id="disclaimerBtn" data-hi="अस्वीकरण" data-en="Disclaimer">Disclaimer</a>
    </div>
    <a href="#" id="adminLoginBtn" title="Admin Panel"></a>
</footer>
</div>

<!-- Bottom Banner -->
<div class="wrap">
    <div id="updateBanner" class="ad-placeholder" style="background-color: var(--accent); color: white; cursor: pointer; font-weight: bold; text-align: center; padding: 10px 0; font-size: 14px;">
        नया अपडेट जल्द आ रहा है! जानने के लिए क्लिक करें
    </div>
</div>

<!-- ALARM MODAL (This is for the app's internal, less reliable alarm) -->
<div id="alarmModal" class="modal">
<div class="modal-content">
<h2 id="alarmTitle" data-hi="रिमाइंडर!" data-en="Reminder!">Reminder!</h2>
<p id="alarmMessage" style="font-size: 18px;"></p>
<button id="stopAlarmBtn" class="btn btn-danger" data-hi="ठीक है, समझ गया!" data-en="Okay, Got It!">Okay, Got It!</button>
<audio id="alarmSound"></audio>
</div>
</div>

<!-- =============================================================== -->
<!-- ============= NEW MANUAL ALARM SUGGESTION MODAL =============== -->
<!-- =============================================================== -->
<div id="manualAlarmModal" class="modal">
    <div class="modal-content">
        <h2 data-hi="रूटीन तैयार है!" data-en="Routine Ready!" style="margin-top:0; color: var(--success);">Routine Ready!</h2>
        <p data-hi="100% भरोसेमंद अलार्म के लिए जो ऐप बंद होने पर भी बजें, कृपया इन ज़रूरी समय को अपने फ़ोन के मुख्य घड़ी (Clock) ऐप में सेट करें।" data-en="For 100% reliable alarms that work even when the app is closed, please set these important times in your phone's main Clock App.">For 100% reliable alarms that work even when the app is closed, please set these important times in your phone's main Clock App.</p>
        
        <ul id="manualAlarmList">
            <!-- Routine will be dynamically inserted here by JavaScript -->
        </ul>

        <button id="closeManualAlarmModalBtn" class="btn" style="width: 100%; margin-top: 20px;" data-hi="ठीक है, समझ गया!" data-en="Okay, Got It!">Okay, Got It!</button>
    </div>
</div>
<!-- =============================================================== -->
<!-- =============================================================== -->


<!-- Other Modals -->
<div id="profileModal" class="modal">
<div class="modal-content">
<span class="close" id="closeProfileModal">&times;</span>
<h2 data-hi="प्रोफ़ाइल सेटअप" data-en="Profile Setup" style="margin-top:0;">Profile Setup</h2>
<div class="row"><div class="flex-item"><label data-hi="नाम" data-en="Name">Name</label><input type="text" id="profileName"></div><div class="flex-item"><label data-hi="उम्र" data-en="Age">Age</label><input type="number" id="profileAge" min="16" max="60"></div></div><div class="row"><div class="flex-item"><label class="small" data-hi="आपकी भूमिका" data-en="Your Role">Your Role</label><div class="occupation-selector"><input type="radio" id="profileRoleDuty" name="profileOccupation" value="duty" checked><label for="profileRoleDuty" data-hi="पेशेवर" data-en="Professional">Professional</label><input type="radio" id="profileRoleStudent" name="profileOccupation" value="student"><label for="profileRoleStudent" data-hi="छात्र" data-en="Student">Student</label></div></div></div>
<div class="row"><div class="flex-item"><label data-hi="परीक्षा/विषय" data-en="Exam/Subject">Exam/Subject</label><input type="text" id="profileExam"></div></div>
<div class="row"><div class="flex-item"><label data-hi="लक्ष्य तिथि" data-en="Target Date">Target Date</label><input type="date" id="profileTargetDate"></div></div>
<div class="row"><div class="flex-item"><label data-hi="विषय (प्रत्येक लाइन पर एक)" data-en="Subjects (one per line)">Subjects (one per line)</label><textarea id="profileSubjects" rows="3" placeholder="e.g., History&#10;Math&#10;Science"></textarea></div></div>
<div class="row"><div class="flex-item"><label data-hi="फोकस सब्जेक्ट (कमजोर विषय)" data-en="Focus Subject (Weak Subject)">Focus Subject (Weak Subject)</label><input type="text" id="profileFocusSubject" placeholder="e.g., Math"></div></div>
<div id="profileDutyFields">
<div class="row"><div class="flex-item"><label class="small" data-hi="शिफ्ट का प्रकार" data-en="Shift Type">Shift Type</label><div class="occupation-selector"><input type="radio" id="profileShiftDay" name="profileShiftType" value="day" checked><label for="profileShiftDay" data-hi="दिन की शिफ्ट" data-en="Day Shift">Day Shift</label><input type="radio" id="profileShiftNight" name="profileShiftType" value="night"><label for="profileShiftNight" data-hi="रात की शिफ्ट" data-en="Night Shift">Night Shift</label></div></div></div>
<div class="row"><div class="flex-item"><label data-hi="गतिविधि का नाम" data-en="Activity Name">Activity Name</label><input type="text" id="profileActivityName" placeholder="e.g., Duty, Office"></div><div class="flex-item"><label class="small" data-hi="दैनिक अध्ययन लक्ष्य (घंटे)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="profileDutyStudyGoal" placeholder="e.g., 3" min="1" max="8" step="0.5" value="3"></div></div>
<div class="row">
<div class="flex-item"><label><span class="dynamic-activity-label-modal" data-hi="ड्यूटी" data-en="Duty">Duty</span> <span data-hi="शुरू" data-en="Start">Start</span></label><input type="time" id="profileDutyStart" value="09:00"></div>
<div class="flex-item"><label><span class="dynamic-activity-label-modal" data-hi="ड्यूटी" data-en="Duty">Duty</span> <span data-hi="खत्म" data-en="End">End</span></label><input type="time" id="profileDutyEnd" value="18:00"></div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="profileDutySetWakeUpManual">
<label for="profileDutySetWakeUpManual" data-hi="जागने का समय खुद सेट करें" data-en="Set wake-up time manually">Set wake-up time manually</label>
</div>
<div id="profileDutyManualWakeUpWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="जागने का समय" data-en="Wake Up Time">Wake Up Time</label>
<input type="time" id="profileDutyWakeUpTime" value="05:00">
</div>
</div>
<div class="checkbox-row">
<input type="checkbox" id="profileDutySetSleepManual">
<label for="profileDutySetSleepManual" data-hi="सोने का समय खुद सेट करें" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="profileDutyManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="सोने का समय" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="profileDutySleepTime" value="22:00">
</div>
</div>
</div>
<div id="profileStudentFields" style="display:none;"><div class="row"><div class="flex-item"><label class="small" data-hi="दैनिक अध्ययन लक्ष्य (घंटे)" data-en="Daily Study Goal (Hours)">Daily Study Goal (Hours)</label><input type="number" id="profileStudentStudyGoal" placeholder="e.g., 8" min="1" max="16" step="0.5" value="8"></div></div><div class="checkbox-row"><input type="checkbox" id="profileStudentSetWakeUpManual"><label for="profileStudentSetWakeUpManual" data-hi="जागने का समय खुद सेट करें" data-en="Set wake-up time manually">Set wake-up time manually</label></div><div id="profileStudentManualWakeUpWrapper" class="row" style="display:none;"><div class="flex-item"><label class="small" data-hi="जागने का समय" data-en="Wake Up Time">Wake Up Time</label><input type="time" id="profileWakeUpTime" value="05:00"></div></div>
<div class="checkbox-row">
<input type="checkbox" id="profileStudentSetSleepManual">
<label for="profileStudentSetSleepManual" data-hi="सोने का समय खुद सेट करें" data-en="Set sleep time manually">Set sleep time manually</label>
</div>
<div id="profileStudentManualSleepWrapper" class="row" style="display:none;">
<div class="flex-item">
<label class="small" data-hi="सोने का समय" data-en="Sleep Time">Sleep Time</label>
<input type="time" id="profileSleepTime" value="22:00">
</div>
</div>
<div class="checkbox-row"><input type="checkbox" id="profileStudentAddActivityCheckbox"><label for="profileStudentAddActivityCheckbox" data-hi="कुछ और गतिविधि जोड़ें" data-en="Add other activity">Add other activity</label></div><div id="profileStudentActivityWrapper" style="display:none;"><div class="row"><div class="flex-item"><label class="small" data-hi="गतिविधि का नाम" data-en="Activity Name">Activity Name</label><input type="text" id="profileStudentActivityName" placeholder="e.g., Play Cricket, Gym"></div><div class="flex-item"><label class="small" data-hi="अवधि (घंटे)" data-en="Duration (Hours)">Duration (Hours)</label><input type="number" id="profileStudentActivityDuration" value="1" min="0.5" max="4" step="0.5"></div></div></div></div>
<div class="row"><div class="flex-item"><label data-hi="अतिरिक्त लक्ष्य" data-en="Additional Goal">Additional Goal</label><textarea id="profileExtraGoal" rows="2"></textarea></div></div>
<div class="row" style="margin-top:16px;"><button id="saveProfile" class="btn" data-hi="प्रोफ़ाइल सेव करें" data-en="Save Profile">Save Profile</button><button id="cancelProfile" class="btn btn-secondary" data-hi="रद्द करें" data-en="Cancel">Cancel</button></div>
</div>
</div>
<div id="slotEditModal" class="modal">
<div class="modal-content">
<span class="close" id="closeSlotEdit">&times;</span>
<h2 id="slotEditTitle" style="margin-top:0;">Edit Slot</h2>
<input type="hidden" id="slotEditId">
<div class="row"><div class="flex-item"><label data-hi="समय" data-en="Time">Time</label><input type="time" id="slotEditTime"></div></div>
<div class="row"><div class="flex-item"><label data-hi="हिंदी संदेश" data-en="Hindi Message">Hindi Message</label><input type="text" id="slotEditMsgHi"></div></div>
<div class="row"><div class="flex-item"><label data-hi="अंग्रेजी संदेश" data-en="English Message">English Message</label><input type="text" id="slotEditMsgEn"></div></div>
<div class="row" style="margin-top:16px;"><button id="saveSlot" class="btn" data-hi="सेव करें" data-en="Save">Save</button></div>
</div>
</div>
<!-- NOTE SHARING MODAL -->
<div id="noteSubmissionModal" class="modal">
<div class="modal-content">
<span class="close" id="closeNoteSubmissionModal">&times;</span>
<h2 data-hi="अपना नोट साझा करें" data-en="Share Your Note" style="margin-top:0;">Share Your Note</h2>
<p data-hi="आपका नोट समीक्षा के लिए भेजा जाएगा।" data-en="Your note will be sent for review." style="font-size:14px; color:var(--muted); margin-top:-10px; margin-bottom:20px;"></p>
<div class="row"><div class="flex-item"><label data-hi="आपका नाम" data-en="Your Name">Your Name</label><input type="text" id="noteAuthor" placeholder="e.g., Amit Kumar"></div></div>
<div class="row"><div class="flex-item"><label data-hi="नोट का शीर्षक" data-en="Note Title">Note Title</label><input type="text" id="noteTitle" placeholder="e.g., History Imp Dates"></div></div>
<div class="row"><div class="flex-item"><label data-hi="नोट की सामग्री / लिंक" data-en="Note Content / Link">Note Content / Link</label><textarea id="noteContent" rows="6" placeholder="Write your note here or paste a link..."></textarea></div></div>
<div class="row" style="margin-top:16px;"><button id="submitNoteBtn" class="btn" data-hi="समीक्षा के लिए सबमिट करें" data-en="Submit for Review">Submit for Review</button></div>
</div>
</div>
<!-- SUBJECT SELECTOR MODAL -->
<div id="subjectSelectorModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeSubjectModal">&times;</span>
        <h2 data-hi="विषय चुनें" data-en="Select Subject" style="margin-top:0;">Select Subject</h2>
        <p data-hi="आप कौन सा विषय पढ़ने जा रहे हैं?" data-en="Which subject are you going to study?" style="font-size:14px; color:var(--muted); margin-top:-10px; margin-bottom:20px;"></p>
        <div id="subjectListContainer">
            <!-- Subjects will be loaded here by JavaScript -->
        </div>
    </div>
</div>
<div id="adminModal" class="modal">
<div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
<span class="close" id="closeAdminModal">&times;</span>
<h2 data-hi="एडमिन पैनल" data-en="Admin Panel">Admin Panel</h2>
<p style="font-size:12px; color:var(--muted);" data-hi="सावधानी से उपयोग करें: गलत JSON डेटा ऐप को तोड़ सकता है।" data-en="Use with caution: Invalid JSON can break the app."></p>
<div class="admin-section">
<label data-hi="एडमिन पासवर्ड बदलें" data-en="Change Admin Password">Change Admin Password</label>
<input type="password" id="newPassword" placeholder="Enter new password">
<button id="changePasswordBtn" class="btn btn-secondary" style="margin-top: 8px; width: 100%;">Change Password</button>
</div>
<div class="admin-section">
<label data-hi="प्रोफ़ाइल डेटा (JSON)" data-en="Profile Data (JSON)">Profile Data (JSON)</label>
<textarea id="adminProfileData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="स्लॉट्स डेटा (JSON)" data-en="Slots Data (JSON)">Slots Data (JSON)</label>
<textarea id="adminSlotsData" rows="6" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="प्रेरणादायक कोट्स (JSON)" data-en="Motivational Quotes (JSON)">Motivational Quotes (JSON)</label>
<textarea id="adminQuotesData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
</div>
<div class="admin-section">
<label style="margin-top:12px;" data-hi="ऑडियो डेटा (JSON)" data-en="Audio Data (JSON)">Audio Data (JSON)</label>
<textarea id="adminAudioData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
<p style="font-size:11px; color:var(--muted); margin-top:4px;" data-hi="फॉर्मेट: [{&quot;name&&quot;:&quot;...&quot;, &quot;url&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]" data-en="Format: [{&quot;name&quot;:&quot;...&quot;, &quot;url&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]"></p>
<div class="admin-add-form">
<input type="text" id="newAudioName" placeholder="Track Name">
<input type="url" id="newAudioUrl" placeholder="Audio URL">
<input type="url" id="newAudioImageUrl" placeholder="Image URL">
<button id="addAudioTrack" class="btn btn-secondary">Add Track</button>
</div>
</div>
<!-- NEW STUDY APP SECTION -->
<div class="admin-section">
    <label style="margin-top:12px;" data-hi="स्टडी ऐप्स डेटा (JSON)" data-en="Study Apps Data (JSON)">Study Apps Data (JSON)</label>
    <textarea id="adminAppsData" rows="4" style="font-family: monospace; font-size: 12px;"></textarea>
    <p style="font-size:11px; color:var(--muted); margin-top:4px;" data-hi="फॉर्मेट: [{&quot;name&quot;:&quot;...&quot;, &quot;linkUrl&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]" data-en="Format: [{&quot;name&quot;:&quot;...&quot;, &quot;linkUrl&quot;:&quot;...&quot;, &quot;imageUrl&quot;:&quot;...&quot;}]"></p>
    <div class="admin-add-form">
        <input type="text" id="newAppName" placeholder="App Name">
        <input type="url" id="newAppUrl" placeholder="App Link URL">
        <input type="url" id="newAppImageUrl" placeholder="Image URL">
        <button id="addStudyApp" class="btn btn-secondary">Add App</button>
    </div>
</div>
<div class="row" style="margin-top:16px;">
<button id="adminSaveBtn" class="btn" data-hi="डेटा सेव करें" data-en="Save Data">Save Data</button>
<button id="adminResetBtn" class="btn btn-danger" data-hi="सब कुछ रीसेट करें" data-en="Reset Everything">Reset Everything</button>
</div>
</div>
</div>

<!-- UPCOMING FEATURES MODAL -->
<div id="updateDetailsModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeUpdateModal">&times;</span>
        <h2 style="margin-top:0;">नया अपडेट: स्पीच-टू-टेक्स्ट नोट्स</h2>
        <p>
            हम एक बेहतरीन नए फीचर पर काम कर रहे हैं जो आपकी पढ़ाई को और भी आसान बना देगा! बहुत जल्द ऐप में <strong>'स्पीच-टू-टेक्स्ट'</strong> का ऑप्शन आने वाला है।
        </p>
        <p>
            <strong>यह कैसे काम करेगा?</strong>
            <br>
            जब आप कोई भी स्टडी ऐप (जैसे YouTube, Khan Sir, आदि) खोलकर पढ़ाई कर रहे होंगे, तो आप हमारे इस फीचर को ऑन कर सकते हैं। इसके बाद, वीडियो में जो भी पढ़ाया जा रहा है, हमारा सिस्टम उसे सुनकर अपने आप टेक्स्ट में बदल देगा और आपके लिए एक व्यवस्थित नोट तैयार कर देगा।
        </p>
        <p style="font-weight: bold; color: var(--accent);">
            अब आपको पढ़ाई के दौरान नोट्स लिखने की चिंता करने की ज़रूरत नहीं पड़ेगी। बस ध्यान से सुनें, नोट्स बनाने का काम हम पर छोड़ दें!
        </p>
    </div>
</div>

<!-- NEW: ABOUT US MODAL -->
<div id="aboutModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeAboutModal">&times;</span>
        <h2 data-hi="हमारे बारे में" data-en="About Us" style="margin-top:0;">About Us</h2>
        <p data-hi="Indian Routine ऐप को भारत के छात्रों और पेशेवरों की मदद करने के एकमात्र उद्देश्य से बनाया गया है ताकि वे अपने सबसे कीमती संसाधन - समय - का प्रबंधन कर सकें।" data-en="Indian Routine is built with the sole purpose of helping students and professionals in India manage their most precious resource - time.">
        </p>
        <p data-hi="हमारा मानना है कि एक अच्छी तरह से संरचित दिनचर्या उत्पादकता और सफलता की कुंजी है। हमारा AI-पावर्ड रूटीन जेनरेटर आपकी ज़रूरतों के हिसाब से एक व्यक्तिगत शेड्यूल बनाने के लिए डिज़ाइन किया गया है, चाहे आप एक कठिन परीक्षा की तैयारी कर रहे हों या काम और पढ़ाई के बीच संतुलन बना रहे हों।" data-en="We believe that a well-structured routine is the key to productivity and success. Our AI-powered routine generator is designed to create a personalized schedule tailored to your needs, whether you're preparing for a tough exam or balancing between a job and studies.">
        </p>
        <p data-hi="आपकी सफलता की यात्रा में आपका भागीदार बनने के लिए हम यहां हैं।" data-en="We are here to be your partner in your journey to success.">
        </p>
    </div>
</div>

<!-- NEW: PRIVACY POLICY MODAL -->
<div id="privacyModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closePrivacyModal">&times;</span>
        <h2 data-hi="गोपनीयता नीति" data-en="Privacy Policy" style="margin-top:0;">Privacy Policy</h2>
        <p data-hi="आपकी गोपनीयता हमारे लिए महत्वपूर्ण है।" data-en="Your privacy is important to us.">
        </p>
        <strong data-hi="डेटा संग्रह और उपयोग" data-en="Data Collection and Usage"></strong>
        <p data-hi="Indian Routine आपके द्वारा प्रदान की गई जानकारी जैसे नाम, परीक्षा का नाम, विषय और शेड्यूल वरीयताओं को एकत्र करता है। इस डेटा का उपयोग केवल आपके लिए एक व्यक्तिगत दिनचर्या और उपयोगकर्ता अनुभव बनाने के लिए किया जाता है।" data-en="Indian Routine collects information you provide, such as name, exam name, subjects, and schedule preferences. This data is used solely to create a personalized routine and user experience for you.">
        </p>
        <strong data-hi="डेटा संग्रहण" data-en="Data Storage"></strong>
        <p data-hi="सभी व्यक्तिगत डेटा आपके डिवाइस पर स्थानीय रूप से (Local Storage का उपयोग करके) संग्रहीत किया जाता है। यह हमारे सर्वर पर प्रेषित या संग्रहीत नहीं होता है। इसका मतलब है कि आपका डेटा पूरी तरह से आपके नियंत्रण में है।" data-en="All personal data is stored locally on your device (using Local Storage). It is not transmitted or stored on our servers. This means your data is completely under your control.">
        </p>
        <strong data-hi="डेटा साझाकरण" data-en="Data Sharing"></strong>
        <p data-hi="हम आपकी व्यक्तिगत जानकारी किसी तीसरे पक्ष के साथ साझा या बेचते नहीं हैं।" data-en="We do not share or sell your personal information with any third parties.">
        </p>
        <strong data-hi="तृतीय-पक्ष सेवाएँ" data-en="Third-Party Services"></strong>
        <p data-hi="ऐप में बाहरी सेवाओं (जैसे स्टडी ऐप्स, AI चैट) के लिंक हो सकते हैं। इन सेवाओं की अपनी गोपनीयता नीतियां हैं, और हम उनके प्रथाओं के लिए जिम्मेदार नहीं हैं।" data-en="The app may contain links to external services (like study apps, AI chats). These services have their own privacy policies, and we are not responsible for their practices.">
        </p>
    </div>
</div>

<!-- NEW: DISCLAIMER MODAL -->
<div id="disclaimerModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeDisclaimerModal">&times;</span>
        <h2 data-hi="अस्वीकरण" data-en="Disclaimer" style="margin-top:0;">Disclaimer</h2>
        <p data-hi="Indian Routine ऐप केवल सूचनात्मक और शैक्षिक उद्देश्यों के लिए एक उपकरण के रूप में प्रदान किया गया है।" data-en="The Indian Routine app is provided as a tool for informational and educational purposes only.">
        </p>
        <p data-hi="AI द्वारा उत्पन्न दिनचर्या और रणनीतियाँ सुझाव हैं और सफलता की गारंटी नहीं देती हैं। उपयोगकर्ताओं को अपने विवेक का उपयोग करना चाहिए और अपनी विशिष्ट आवश्यकताओं के अनुसार प्रदान की गई दिनचर्या को अपनाना चाहिए।" data-en="The routines and strategies generated by the AI are suggestions and do not guarantee success. Users should use their own discretion and adapt the provided routine to their specific needs.">
        </p>
        <p data-hi="ऐप के डेवलपर्स प्रदान की गई जानकारी के उपयोग से उत्पन्न होने वाले किसी भी परिणाम के लिए उत्तरदायी नहीं हैं। अपनी पढ़ाई और करियर के लिए आप स्वयं जिम्मेदार हैं।" data-en="The developers of the app are not liable for any outcomes resulting from the use of the information provided. You are solely responsible for your own studies and career.">
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
// --- GLOBAL STATE & UTILITIES ---
let currentLang = localStorage.getItem('smart_lang') || 'en';
let timeFormat = localStorage.getItem('smart_time_format') || '12h';
let slotsData = [];
const FOCUS_EXTRA_MINUTES = 45; // Extra time for focus subject

const $ = (id) => document.getElementById(id);
const $$ = (sel) => document.querySelectorAll(sel);
const timeToMinutes = t => { if(!t) return 0; const [h, m] = t.split(':').map(Number); return h * 60 + m; };
const minutesToTime = m => { m = ((m % 1440) + 1440) % 1440; return String(Math.floor(m / 60)).padStart(2, '0') + ':' + String(m % 60).padStart(2, '0'); };
const daysBetween = (d1, d2) => { if (!d1 || !d2) return 0; return Math.max(1, Math.round((new Date(d2) - new Date(d1)) / (1000 * 60 * 60 * 24)));};
const getBilingualText = (en, hi) => { if (currentLang === 'hi') return hi; if (currentLang === 'en') return en; return `${en} — ${hi}`; };
const formatTime = (time24) => { if (timeFormat === '24h' || !time24) return time24; const [h, m] = time24.split(':'); const hour = parseInt(h, 10); const suffix = hour >= 12 ? 'PM' : 'AM'; const hour12 = hour % 12 || 12; return `${String(hour12).padStart(2, '0')}:${m} ${suffix}`; };
const defaultSlots = (exam = 'Study', activity = 'Duty') => [
{ id: 'wake', label_en: 'Wake Up', label_hi: 'उठना', time: '04:30', msg_hi: `सुप्रभात!`, msg_en: `Good morning!`, tip_hi: 'एक गिलास पानी पिएं।', tip_en: 'Drink a glass of water.' },
{ id: 'morning_study', label_en: 'Morning Study', label_hi: 'सुबह की पढ़ाई', time: '04:45', msg_hi: 'सुबह की पढ़ाई का समय है।', msg_en: 'Time for morning study.', tip_hi: 'सबसे ज़रूरी काम पहले करें।', tip_en: 'Do the most important task first.' },
{ id: 'leave', label_en: `Leave for ${activity}`, label_hi: `${activity} के लिए निकलना`, time: '05:30', msg_hi: `अब ${activity} के लिए निकलो`, msg_en: `Leave for ${activity} now`, tip_hi: 'सब कुछ जांच लें।', tip_en: 'Check everything.' },
{ id: 'duty_start', label_en: `${activity} Start`, label_hi: `${activity} शुरू`, time: '06:00', msg_hi: `${activity} शुरू हो गई है`, msg_en: `${activity} has started`, tip_hi: 'फोकस रहें।', tip_en: 'Stay focused.' },
{ id: 'duty_end', label_en: `${activity} End`, label_hi: `${activity} खत्म`, time: '15:00', msg_hi: `${activity} खत्म हो गई है`, msg_en: `${activity} is finished`, tip_hi: 'थोड़ा आराम करें।', tip_en: 'Take some rest.' },
{ id: 'home', label_en: 'Reach Home', label_hi: 'घर वापसी', time: '15:30', msg_hi: `घर पहुँच गए, आराम करो`, msg_en: `Reached home, take rest`, tip_hi: '10 मिनट रिलैक्स करो।', tip_en: 'Relax for 10 min.' },
{ id: 'nap', label_en: 'Power Nap', label_hi: 'पावर नैप', time: '16:00', msg_hi: 'पावर नैप का समय है', msg_en: 'Time for a power nap', tip_hi: 'एक छोटी नैप ताजगी देगी।', tip_en: 'A short nap will refresh you.' },
{ id: 'main_study', label_en: 'Main Study', label_hi: 'मुख्य पढ़ाई', time: '17:00', msg_hi: `अब ${exam} की पढ़ाई शुरू करो`, msg_en: `Start your ${exam} study`, tip_hi: 'सबसे कठिन विषय पहले पढ़ें।', tip_en: 'Study the hardest subject first.' },
{ id: 'break', label_en: 'Break', label_hi: 'ब्रेक', time: '19:00', msg_hi: 'थोड़ा ब्रेक लो', msg_en: 'Take a short break', tip_hi: 'टहलें या संगीत सुनें।', tip_en: 'Walk or listen to music.' },
{ id: 'practice', label_en: 'Practice', label_hi: 'प्रैक्टिस', time: '19:30', msg_hi: `अब प्रैक्टिस करो`, msg_en: `Time for practice`, tip_hi: 'प्रश्नों को हल करें।', tip_en: 'Solve problems.' },
{ id: 'current_affairs', label_en: 'Current Affairs', label_hi: 'करंट अफेयर्स', time: '20:30', msg_hi: `अब करंट अफेयर्स पढ़ो`, msg_en: `Read Current Affairs`, tip_hi: 'मुख्य बिंदुओं के नोट्स बनाएं।', tip_en: 'Make notes of the main points.' },
{ id: 'dinner', label_en: 'Dinner', label_hi: 'डिनर', time: '21:00', msg_hi: 'डिनर करो', msg_en: 'Have dinner', tip_hi: 'हल्का भोजन करें।', tip_en: 'Have a light meal.' },
{ id: 'sleep', label_en: 'Sleep', label_hi: 'सोना', time: '22:00', msg_hi: 'सोने की तैयारी करो', msg_en: 'Time to sleep', tip_hi: 'अच्छी नींद लें।', tip_en: 'Get a good sleep.' }
];

const getProfile = () => JSON.parse(localStorage.getItem('smart_profile') || '{"occupation":"duty"}');
const loadSlotsData = () => {
try {
const s = JSON.parse(localStorage.getItem('smart_slots') || '[]');
const p = getProfile();
if (Array.isArray(s) && s.length > 0) slotsData = s;
else slotsData = defaultSlots(p.exam, p.activityLabel);
} catch (e) {
slotsData = defaultSlots();
}
};
const saveSlotsData = () => localStorage.setItem('smart_slots', JSON.stringify(slotsData));

// ====================================================================================
// ==================== INITIALIZE ALL APP DATA (INCLUDES STUDY APPS) =================
// ====================================================================================
const initializeData = () => {
    if (!localStorage.getItem('smart_audio')) {
        const defaultAudio = [{ name: "Select Audio", url: "", imageUrl: "" }, { name: "Chanakya Motivation", url: "https://www.soundjay.com/buttons/sounds/button-7.mp3", imageUrl: "https://i.pravatar.cc/150?u=chanakya" }];
        localStorage.setItem('smart_audio', JSON.stringify(defaultAudio));
    }
    if (!localStorage.getItem('admin_password')) {
        localStorage.setItem('admin_password', 'admin123');
    }

    // --- NEW: STUDY APPS VERSIONING TO FORCE UPDATE ---
    const STUDY_APPS_VERSION = 'v1.5'; // Increment this to force an update
    const currentAppsVersion = localStorage.getItem('study_apps_version');

    if (currentAppsVersion !== STUDY_APPS_VERSION) {
        const defaultStudyApps = [
            { name: 'RWA', imageUrl: 'https://i.postimg.cc/VNRFGLwr/Picsart-25-10-22-01-32-21-033.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.appx.rojgar_with_ankit' },
            { name: 'Khan Sir', imageUrl: 'https://i.postimg.cc/pVg1nrLK/Picsart-25-10-22-01-31-29-127.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=xyz.penpencil.khansirofficial' },
            { name: 'YouTube', imageUrl: 'https://files.catbox.moe/jigd74.jpg', linkUrl: 'https://www.youtube.com/' },
            { name: 'Physics Wallah', imageUrl: 'https://files.catbox.moe/06xp1d.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.physicswallah' },
            { name: 'Unacademy', imageUrl: 'https://files.catbox.moe/ojffup.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.unacademyapp' },
            { name: "BYJU'S", imageUrl: 'https://files.catbox.moe/bs29n1.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.byjus.thelearningapp' },
            { name: 'Adda247', imageUrl: 'https://files.catbox.moe/0y2ncj.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.adda247.app' },
            { name: 'Testbook', imageUrl: 'https://files.catbox.moe/zgrt4n.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.testbook.tbapp' },
            { name: 'Vedantu', imageUrl: 'https://files.catbox.moe/5o5cr2.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.vedantu.app' },
            { name: 'Drishti IAS', imageUrl: 'https://files.catbox.moe/lcpkq0.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.drishti.academy.app' },
            { name: 'Exampur', imageUrl: 'https://files.catbox.moe/w626y1.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.edudrive.exampur' },
            { name: 'Telegram', imageUrl: 'https://files.catbox.moe/tw54tx.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=org.telegram.messenger' },
            { name: 'Utkarsh', imageUrl: 'https://files.catbox.moe/nqsugs.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.utkarsh.app' },
            { name: 'Study IQ', imageUrl: 'https://files.catbox.moe/b02dfi.jpg', linkUrl: 'https://play.google.com/store/apps/details?id=com.studyiq.android' }
        ];
        localStorage.setItem('smart_study_apps', JSON.stringify(defaultStudyApps));
        localStorage.setItem('study_apps_version', STUDY_APPS_VERSION);
    }

    // --- QUOTES LOGIC ---
    const QUOTES_VERSION = 'v2.0';
    const currentVersion = localStorage.getItem('quotes_version');
    if (currentVersion !== QUOTES_VERSION) {
        const hindiQuotes = [ { hi: 'सफलता अंतिम नहीं है, असफलता घातक नहीं है: यह जारी रखने का साहस है जो मायने रखता है।', en: 'Success is not final, failure is not fatal: it is the courage to continue that counts.' }, { hi: 'आपका समय सीमित है, इसे किसी और की जिंदगी जीकर बर्बाद न करें।', en: 'Your time is limited, so don’t waste it living someone else’s life.' }, { hi: 'महान कार्य करने का एकमात्र तरीका यह है कि आप जो करते हैं उससे प्यार करें।', en: 'The only way to do great work is to love what you do.' }, { hi: 'कड़ी मेहनत प्रतिभा को हरा देती है जब प्रतिभा कड़ी मेहनत नहीं करती।', en: 'Hard work beats talent when talent doesn’t work hard.' }, { hi: 'सपने तब तक काम नहीं करते जब तक आप नहीं करते।', en: 'Dreams don’t work unless you do.' }, { hi: 'यह हमेशा असंभव लगता है जब तक कि यह पूरा न हो जाए।', en: 'It always seems impossible until it’s done.' }, { hi: 'अनुशासन लक्ष्यों और प्राप्ति के बीच का पुल है।', en: 'Discipline is the bridge between goals and accomplishment.' }, { hi: 'शक सपनों को हकीकत से ज्यादा मारता है।', en: 'Doubt kills more dreams than failure ever will.' }, { hi: 'हर विशेषज्ञ कभी एक शुरुआत करने वाला था।', en: 'Every expert was once a beginner.' }, { hi: 'हार मत मानो। शुरुआत हमेशा सबसे कठिन होती है।', en: 'Don’t give up. The beginning is always the hardest.' }, ];
        const shayaris = [ { hi: 'मंज़िलें उन्हीं को मिलती हैं, जिनके सपनों में जान होती है, पंखों से कुछ नहीं होता, हौसलों से उड़ान होती है।', en: 'Destinations are achieved by those whose dreams have life, wings are not enough, flights are made with courage.' }, { hi: 'लहरों से डर कर नौका पार नहीं होती, कोशिश करने वालों की कभी हार नहीं होती।', en: 'A boat does not cross the sea by fearing the waves, those who try never lose.' }, { hi: 'क्यों डरें कि ज़िंदगी में क्या होगा, हर वक़्त क्यों सोचें कि बुरा होगा, बढ़ते रहें मंज़िलों की ओर हम, कुछ न भी मिला तो क्या? तजुर्बा तो नया होगा।', en: 'Why fear what will happen in life, why always think that something bad will happen, let\'s keep moving towards our goals, even if we get nothing, what then? The experience will be new.' }, { hi: 'हाथों की लकीरों पर मत जा ऐ ग़ालिब, नसीब उनके भी होते हैं जिनके हाथ नहीं होते।', en: 'Don\'t go by the lines on your hands, Ghalib, destiny is also for those who do not have hands.' }, { hi: 'ख़ुदी को कर बुलंद इतना कि हर तक़दीर से पहले, ख़ुदा बंदे से ख़ुद पूछे बता तेरी रज़ा क्या है।', en: 'Elevate yourself so high that before every decree of fate, God himself asks his servant, tell me, what is your will?' }, { hi: 'सफ़र में मुश्किलें आएं तो हिम्मत और बढ़ती है, कोई अगर रास्ता रोके तो जुर्रत और बढ़ती है।', en: 'When difficulties arise in the journey, courage increases, if someone blocks the way, audacity increases.' }, { hi: 'काम करो ऐसा कि एक पहचान बन जाए, हर कदम ऐसा चलो कि निशान बन जाए।', en: 'Work in such a way that it becomes an identity, walk every step in such a way that it leaves a mark.' }, { hi: 'ज़िंदगी जीना आसान नहीं होता, बिना संघर्ष के कोई महान नहीं होता।', en: 'Living life is not easy, without struggle, no one becomes great.' }, { hi: 'जो मुस्कुरा रहा है, उसे दर्द ने पाला होगा, जो चल रहा है, उसके पाँव में छाला होगा, बिना संघर्ष के चमक नहीं मिलती, जो जल रहा है तिल-तिल, उसी दीए में उजाला होगा।', en: 'The one who is smiling must have been raised by pain, the one who is walking must have a blister on his foot, without struggle, there is no shine, the one who is burning bit by bit, only that lamp will have light.' }, { hi: 'ना पूछो कि मेरी मंज़िल कहाँ है, अभी तो सफ़र का इरादा किया है, ना हारूँगा हौसला उम्र भर, ये मैंने किसी से नहीं ख़ुद से वादा किया है।', en: 'Don\'t ask where my destination is, I have just intended to travel, I will not lose courage my whole life, I have made this promise not to anyone but to myself.' }, { hi: 'ऊँचे ख्वाबों के लिए, दिल की गहराई से काम करना पड़ता है, यूँ ही नहीं मिलती सफलता किसी को, मेहनत की आग में दिन-रात जलना पड़ता है।', en: 'For high dreams, one has to work from the depth of the heart, success is not achieved just like that, one has to burn day and night in the fire of hard work.' }, { hi: 'रख हौसला वो मंज़र भी आएगा, प्यासे के पास चल के समंदर भी आएगा, थक कर न बैठ ऐ मंज़िल के मुसाफ़िर, मंज़िल भी मिलेगी और मिलने का मज़ा भी आएगा।', en: 'Have courage, that scene will also come, the ocean will also come to the thirsty, don\'t sit tired, O traveler of the destination, you will get the destination and you will also enjoy meeting it.' }, { hi: 'जब टूटने लगे हौसले तो बस ये याद रखना, बिना मेहनत के हासिल तख़्त-ओ-ताज नहीं होते, ढूँढ़ लेना अँधेरों में ही मंज़िल अपनी, क्योंकि जुगनू कभी रौशनी के मोहताज़ नहीं होते।', en: 'When you start losing courage, just remember this, thrones and crowns are not achieved without hard work, find your destination in the darkness, because fireflies are never dependent on light.' }, { hi: 'अगर आप उस इंसान की तलाश कर रहे हैं जो आपकी ज़िन्दगी बदलेगा, तो आईने में देख लें।', en: 'If you are looking for the person who will change your life, then look in the mirror.' }, { hi: 'सफलता का मुख्य आधार, सकारात्मक सोच और निरंतर प्रयास है।', en: 'The main basis of success is positive thinking and continuous effort.' }, { hi: 'परिंदों को मंज़िल मिलेगी यक़ीनन, ये फैले हुए उनके पर बोलते हैं, अक्सर वो लोग ख़ामोश रहते हैं, ज़माने में जिनके हुनर बोलते हैं।', en: 'Birds will surely find their destination, their spread wings speak, often those people remain silent, whose skills speak in the world.' }, { hi: 'लगातार हो रही असफलताओं से निराश नहीं होना चाहिए, क्योंकि कभी-कभी गुच्छे की आखिरी चाबी भी ताला खोल देती है।', en: 'One should not be discouraged by continuous failures, because sometimes the last key of the bunch also opens the lock.' }, { hi: 'जीत की ख़ातिर बस जुनून चाहिए, जिसमें उबाल हो ऐसा ख़ून चाहिए, ये आसमाँ भी आएगा ज़मीं पर, बस इरादों में जीत की गूँज चाहिए।', en: 'For the sake of victory, you just need passion, you need blood that boils, this sky will also come down to the earth, you just need the echo of victory in your intentions.' }, { hi: 'जिनमें अकेले चलने का हौसला होता है, उनके पीछे एक दिन काफ़िला होता है।', en: 'Those who have the courage to walk alone, one day have a convoy behind them.' }, { hi: 'अगर मेहनत आदत बन जाए, तो कामयाबी मुक़द्दर बन जाती है।', en: 'If hard work becomes a habit, then success becomes destiny.' }, ];
        const shlokas = [ { hi: 'कर्मण्येवाधिकारस्ते मा फलेषु कदाचन।<br><br><strong>अर्थ:</strong> कर्म पर ही तुम्हारा अधिकार है, उसके फलों पर कभी नहीं।', en: 'You have a right to perform your prescribed duties, but you are not entitled to the fruits of your actions.' }, { hi: 'उद्यमेन हि सिध्यन्ति कार्याणि न मनोरथैः।<br><br><strong>अर्थ:</strong> कोई भी काम कड़ी मेहनत से ही सफल होता है, सिर्फ सोचने से नहीं।', en: 'Tasks are accomplished by effort, not by wishful thinking.' }, { hi: 'विद्या ददाति विनयम्।<br><br><strong>अर्थ:</strong> ज्ञान विनम्रता प्रदान करता है।', en: 'Knowledge gives humility.' }, { hi: 'श्रद्धावान् लभते ज्ञानम्।<br><br><strong>अर्थ:</strong> श्रद्धा रखने वाला व्यक्ति ही ज्ञान प्राप्त करता है।', en: 'The one who has faith attains knowledge.' }, { hi: 'योगः कर्मसु कौशलम्।<br><br><strong>अर्थ:</strong> कर्मों में कुशलता लाना ही योग है।', en: 'Yoga is skill in action.' }, { hi: 'मन एव मनुष्याणां कारणं बन्धमोक्षयोः।<br><br><strong>अर्थ:</strong> मन ही मनुष्य के बंधन और मोक्ष का कारण है।', en: 'The mind alone is the cause of human bondage and liberation.' }, { hi: 'आलस्यं हि मनुष्याणां शरीरस्थो महान् रिपुः।<br><br><strong>अर्थ:</strong> आलस्य ही मनुष्य के शरीर में रहने वाला सबसे बड़ा शत्रु है।', en: 'Lethargy is the greatest enemy residing in the human body.' }, { hi: 'क्षणशः कणशश्चैव विद्यामर्थं च साधयेत्।<br><br><strong>अर्थ:</strong> प्रत्येक क्षण का उपयोग सीखने के लिए और प्रत्येक कण का उपयोग धन बचाने के लिए करना चाहिए।', en: 'One should acquire knowledge and wealth moment by moment and bit by bit.' }, { hi: 'अयं निजः परो वेति गणना लघुचेतसाम्। उदारचरितानां तु वसुधैव कुटुम्बकम्।<br><br><strong>अर्थ:</strong> यह मेरा है, यह उसका है, ऐसी सोच छोटे मन वाले लोगों की होती है। विशाल हृदय वालों के लिए तो पूरी पृथ्वी ही एक परिवार है।', en: 'This is mine, that is his, is the calculation of the narrow-minded. For the magnanimous, the entire world is a family.' }, { hi: 'सत्यमेव जयते।<br><br><strong>अर्थ:</strong> सत्य की ही हमेशा विजय होती है।', en: 'Truth alone triumphs.' }, { hi: 'बलवानप्यशक्तोऽसौ धनवानपि निर्धनः। श्रुतवानपि मूर्खोऽसौ यो धर्मविमुखो जनः।<br><br><strong>अर्थ:</strong> जो व्यक्ति धर्म (कर्तव्य) से विमुख होता है, वह बलवान होकर भी असमर्थ, धनवान होकर भी निर्धन और ज्ञानी होकर भी मूर्ख होता है।', en: 'A person who turns away from righteousness is powerless even if strong, poor even if wealthy, and a fool even if learned.' }, { hi: 'पुस्तकस्था तु या विद्या परहस्तगतं धनम्। कार्यकाले समुत्पन्ने न सा विद्या न तद्धनम्।<br><br><strong>अर्थ:</strong> किताबों में रखा ज्ञान और दूसरों के हाथ में गया धन, ज़रूरत पड़ने पर न तो वह ज्ञान काम आता है और न ही वह धन।', en: 'Knowledge that is confined to books and wealth that is in the hands of others are of no use when the time for action comes.' }, { hi: 'काक चेष्टा, बको ध्यानं, श्वान निद्रा तथैव च। अल्पाहारी, गृहत्यागी, विद्यार्थी पंच लक्षणं।<br><br><strong>अर्थ:</strong> कौवे जैसी चेष्टा, बगुले जैसा ध्यान, कुत्ते जैसी नींद, कम भोजन करने वाला और घर का मोह त्यागने वाला - ये विद्यार्थी के पाँच लक्षण हैं।', en: 'The effort of a crow, the concentration of a crane, the sleep of a dog, a light eater, and one who renounces home—these are the five characteristics of a student.' }, { hi: 'अज्ञः सुखमाराध्यः सुखतरमाराध्यते विशेषज्ञः। ज्ञानलवदुर्विदग्धं ब्रह्मापि नरं न रञजयति।<br><br><strong>अर्थ:</strong> अज्ञानी को समझाना आसान है, ज्ञानी को समझाना और भी आसान है, लेकिन अधूरे ज्ञान वाले अहंकारी व्यक्ति को स्वयं ब्रह्मा भी नहीं समझा सकते।', en: 'An ignorant person is easy to please, an expert is even easier. But even Brahma cannot convince a person who is arrogant with a little knowledge.' }, { hi: 'यथा ह्येकेन चक्रेण न रथस्य गतिर्भवेत्। एवं पुरुषकारेण विना दैवं न सिद्ध्यति।<br><br><strong>अर्थ:</strong> जैसे एक पहिये से रथ नहीं चल सकता, उसी प्रकार बिना पुरुषार्थ (कड़ी मेहनत) के भाग्य सिद्ध नहीं होता।', en: 'Just as a chariot cannot move with a single wheel, so fate is not accomplished without human effort.' }, { hi: 'निश्चितं हित्वा योऽनिश्चितं परिधावति। निश्चितं तस्य नश्यति अनिश्चितं नष्टमेव हि।<br><br><strong>अर्थ:</strong> जो व्यक्ति निश्चित को छोड़कर अनिश्चित के पीछे भागता है, उसका निश्चित भी नष्ट हो जाता है और अनिश्चित तो पहले से ही नष्ट होता है।', en: 'He who abandons the certain and runs after the uncertain, loses the certain, and the uncertain is already lost.' }, { hi: 'अश्वस्य भूषणं वेगो मत्तं स्याद् गजभूषणम्। चातुर्यं भूषणं नार्या उद्योगो नरभूषणम्।<br><br><strong>अर्थ:</strong> घोड़े का आभूषण उसकी गति है, हाथी का आभूषण उसका मदमस्त होना है, स्त्री का आभूषण उसकी चतुराई है और पुरुष का आभूषण उसका उद्यमी होना है।', en: 'Speed is the ornament of a horse, intoxication is the ornament of an elephant. Cleverness is the ornament of a woman, and industry is the ornament of a man.' }, { hi: 'दुर्लभं त्रयमेवैतत् देवानुग्रहहेतुकम्। मनुष्यत्वं मुमुक्षुत्वं महापुरुषसंश्रयः।<br><br><strong>अर्थ:</strong> मनुष्य जन्म, मोक्ष की इच्छा और महापुरुषों का साथ - ये तीन चीजें ईश्वर की कृपा से ही दुर्लभ रूप से मिलती हैं।', en: 'These three are indeed rare and are due to the grace of the gods: humanity, the desire for liberation, and the company of great souls.' }, { hi: 'गुणिगणगणनारम्भे न पतति कठिनी सुसंभ्रमाद्यस्य। तेनाम्बा यदि सुतिनी वद वन्ध्या कीदृशी भवति।<br><br><strong>अर्थ:</strong> गुणी लोगों की गिनती करते समय जो व्यक्ति उत्साह से शामिल नहीं होता, अगर उसकी माँ को पुत्रवती कहें, तो फिर बांझ किसे कहेंगे?', en: 'At the beginning of counting virtuous people, he who does not participate with enthusiasm; if his mother is called a mother of a son, then tell me, what would a barren woman be like?' }, { hi: 'सर्पः क्रूरः खलः क्रूरः सर्पात् क्रूरतरः खलः। मन्त्रौषधवशः सर्पः खलः केन निवार्यते।<br><br><strong>अर्थ:</strong> साँप क्रूर होता है और दुष्ट भी क्रूर होता है, लेकिन दुष्ट साँप से भी ज़्यादा क्रूर होता है। साँप को तो मंत्र और औषधि से वश में किया जा सकता है, पर दुष्ट को किससे रोका जा सकता है?', en: 'A snake is cruel, and a wicked person is cruel, but a wicked person is crueler than a snake. A snake can be controlled by mantras and medicine, but by what can a wicked person be stopped?' }, ];
        localStorage.setItem('smart_hindi_quotes', JSON.stringify(hindiQuotes));
        localStorage.setItem('smart_shayaris', JSON.stringify(shayaris));
        localStorage.setItem('smart_shlokas', JSON.stringify(shlokas));
        localStorage.setItem('quotes_version', QUOTES_VERSION);
    }
};

const updateQuote = () => {
    let quote;
    let categoryIndex = parseInt(localStorage.getItem('quote_category_index') || '0');
    try {
        if (categoryIndex === 0) { const quotes = JSON.parse(localStorage.getItem('smart_hindi_quotes')); quote = quotes[Math.floor(Math.random() * quotes.length)]; } 
        else if (categoryIndex === 1) { const quotes = JSON.parse(localStorage.getItem('smart_shayaris')); quote = quotes[Math.floor(Math.random() * quotes.length)]; } 
        else { const quotes = JSON.parse(localStorage.getItem('smart_shlokas')); quote = quotes[Math.floor(Math.random() * quotes.length)]; }
        if (!quote) throw new Error("No quote found");
    } catch (e) {
        quote = { en: 'Welcome! Set up your routine.', hi: 'आपका स्वागत है! अपना रूटीन सेट करें।' };
    }
    $('motivationQuote').innerHTML = `<strong style="color:var(--accent); line-height: 1.6;">${getBilingualText(quote.en, quote.hi)}</strong>`;
    categoryIndex = (categoryIndex + 1) % 3;
    localStorage.setItem('quote_category_index', categoryIndex.toString());
};

// ====================================================================================
// ================================= END OF INITIALIZATION ============================
// ====================================================================================

const renderUserGreeting = () => {
const profile = getProfile();
if (profile.name) {
$('userGreeting').textContent = getBilingualText(`Hello, ${profile.name}`, `नमस्ते, ${profile.name}`);
} else {
$('userGreeting').textContent = '';
}
};
const renderAudioPlayer = () => {
const select = $('audioTrackSelect'), player = $('audioPlayer'), image = $('audioTrackImage');
select.innerHTML = '';
try {
const audioTracks = JSON.parse(localStorage.getItem('smart_audio') || '[]');
if (audioTracks.length > 0) {
audioTracks.forEach(track => {
const option = document.createElement('option');
option.value = track.url;
option.dataset.imageUrl = track.imageUrl || '';
option.textContent = track.name;
select.appendChild(option);
});
const selectedOption = select.options[select.selectedIndex];
player.src = selectedOption.value;
image.src = selectedOption.dataset.imageUrl;
image.style.display = selectedOption.dataset.imageUrl ? 'block' : 'none';
}
} catch(e) { console.error("Could not load audio tracks", e); }
};
const renderSlots = () => {
const container = $('slots');
container.innerHTML = '';
slotsData.sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
slotsData.forEach(item => {
const slotDiv = document.createElement('div');
slotDiv.className = 'slot';
slotDiv.dataset.id = item.id;
slotDiv.innerHTML = `<div class="time">${formatTime(item.time)}</div><div class="label" data-hi="${item.label_hi}" data-en="${item.label_en}"></div><div class="tip" data-hi="${item.tip_hi}" data-en="${item.tip_en}"></div><button class="slot-edit-btn" data-id="${item.id}"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></button>`;
container.appendChild(slotDiv);
});
updateTextContent();
};
const updateDynamicActivityLabels = () => {
const activity = $('activityName').value.trim() || getProfile().activityLabel || 'Duty';
$$('.dynamic-activity-label, .dynamic-activity-label-modal').forEach(el => { el.textContent = activity; });
};
const updateTextContent = () => {
$$('[data-hi][data-en]').forEach(elem => {
if (!elem.matches('.dynamic-activity-label, .dynamic-activity-label-modal')) {
elem.textContent = getBilingualText(elem.dataset.en, elem.dataset.hi);
}
});
updateDynamicActivityLabels();
};

const displayStrategy = () => {
const p = getProfile();
const exam = $('examName').value || p.exam;
const targetDate = $('targetDate').value || p.targetDate;
const subjectsInput = $('subjectsList').value.trim();
const numSubjects = subjectsInput ? subjectsInput.split('\n').filter(s => s.trim()).length : (p.subjects ? p.subjects.length : 0);
const focusSubject = $('focusSubject').value.trim() || p.focusSubject || '';
let studyHours;
const occupation = document.querySelector('input[name="occupation"]:checked').value || p.occupation;
if(occupation === 'student') {
studyHours = p.studentStudyGoal || $('studentStudyGoal').value || 8;
} else {
studyHours = p.dutyStudyGoal || $('dutyStudyGoal').value || 3;
}
const strategyDiv = $('strategy');
if (!exam || !targetDate) {
strategyDiv.innerHTML = `<span style="color:var(--muted)" data-hi="रणनीति के लिए सेटअप पूरा करें" data-en="Complete setup for strategy"></span>`;
} else {
const days = daysBetween(new Date(), targetDate);
strategyDiv.innerHTML = `<div><span data-hi="लक्ष्य" data-en="Goal"></span>: <strong>${exam}</strong></div><div><span data-hi="समय" data-en="Time Left"></span>: <strong>${days} <span data-hi="दिन" data-en="days"></span></strong></div><div><span data-hi="दैनिक लक्ष्य" data-en="Daily Goal"></span>: <strong>${studyHours} <span data-hi="घंटे" data-en="hours"></span></strong></div><div><span data-hi="विषय" data-en="Subjects"></span>: <strong>${numSubjects}</strong></div>${focusSubject ? `<div><span data-hi="फोकस सब्जेक्ट" data-en="Focus Subject"></span>: <strong>${focusSubject} (+${FOCUS_EXTRA_MINUTES} मिनट)</strong></div>` : ''}`;
}
updateTextContent();
};
const loadProfileToForm = () => {
const p = getProfile();
$('examName').value = p.exam || '';
$('targetDate').value = p.targetDate || '';
$('subjectsList').value = p.subjects ? p.subjects.join('\n') : '';
$('focusSubject').value = p.focusSubject || '';
if (p.occupation === 'student') {
$('roleStudent').checked = true;
$('studentStudyGoal').value = p.studentStudyGoal || 8;
$('studentSetWakeUpManual').checked = p.useStudentManualWakeUp || false;
$('studentManualWakeUpWrapper').style.display = p.useStudentManualWakeUp ? 'flex' : 'none';
$('wakeUpTime').value = p.wakeUpTime || '05:00';
$('studentSetSleepManual').checked = p.useStudentManualSleep || false;
$('studentManualSleepWrapper').style.display = p.useStudentManualSleep ? 'flex' : 'none';
$('sleepTime').value = p.sleepTime || '22:00';
$('studentAddActivityCheckbox').checked = p.useStudentActivity || false;
$('studentActivityWrapper').style.display = p.useStudentActivity ? 'block' : 'none';
$('studentActivityName').value = p.studentActivityName || '';
$('studentActivityDuration').value = p.studentActivityDuration || 1;
} else {
$('roleDuty').checked = true;
$('activityName').value = p.activityLabel || 'Duty';
$('dutyStart').value = p.dutyStart || '09:00';
$('dutyEnd').value = p.dutyEnd || '18:00';
$('dutyStudyGoal').value = p.dutyStudyGoal || 3;
if (p.shiftType === 'night') {
$('shiftNight').checked = true;
} else {
$('shiftDay').checked = true;
}
$('dutySetWakeUpManual').checked = p.useDutyManualWakeUp || false;
$('dutyManualWakeUpWrapper').style.display = p.useDutyManualWakeUp ? 'flex' : 'none';
$('dutyWakeUpTime').value = p.dutyWakeUpTime || '05:00';
$('dutySetSleepManual').checked = p.useDutyManualSleep || false;
$('dutyManualSleepWrapper').style.display = p.useDutyManualSleep ? 'flex' : 'none';
$('dutySleepTime').value = p.dutySleepTime || '22:00';
}
toggleOccupationView(p.occupation || 'duty', 'main');
if (p.name) {
$('detailsInputs').style.display = 'none';
$('profileSummary').style.display = 'block';
$('profileSummary').innerHTML = `<span data-hi="प्रोफ़ाइल सेट है। इसे बदलने के लिए मेनू का उपयोग करें।" data-en="Profile is set. Use the menu to edit."></span>`;
} else {
$('detailsInputs').style.display = 'block';
$('profileSummary').style.display = 'none';
}
updateTextContent();
};
const refreshUI = () => {
loadProfileToForm();
displayStrategy();
loadSlotsData();
renderSlots();
updateQuote();
renderUserGreeting();
renderAudioPlayer();
renderStudyApps();
updateStudyDisplay();
updateTextContent();
};
const handleLanguageChange = () => {
currentLang = $('langSel').value;
localStorage.setItem('smart_lang', currentLang);
refreshUI();
};
const handleTimeFormatChange = () => {
timeFormat = $('timeFormatSel').value;
localStorage.setItem('smart_time_format', timeFormat);
renderSlots();
};
const openProfileModal = () => {
const p = getProfile();
$('profileName').value = p.name || '';
$('profileAge').value = p.age || '';
$('profileExam').value = p.exam || '';
$('profileTargetDate').value = p.targetDate || '';
$('profileSubjects').value = p.subjects ? p.subjects.join('\n') : '';
$('profileFocusSubject').value = p.focusSubject || '';
$('profileExtraGoal').value = p.extraGoal || '';
if (p.occupation === 'student') {
$('profileRoleStudent').checked = true;
$('profileStudentStudyGoal').value = p.studentStudyGoal || 8;
$('profileStudentSetWakeUpManual').checked = p.useStudentManualWakeUp || false;
$('profileStudentManualWakeUpWrapper').style.display = p.useStudentManualWakeUp ? 'flex' : 'none';
$('profileWakeUpTime').value = p.wakeUpTime || '05:00';
$('profileStudentSetSleepManual').checked = p.useStudentManualSleep || false;
$('profileStudentManualSleepWrapper').style.display = p.useStudentManualSleep ? 'flex' : 'none';
$('profileSleepTime').value = p.sleepTime || '22:00';
$('profileStudentAddActivityCheckbox').checked = p.useStudentActivity || false;
$('profileStudentActivityWrapper').style.display = p.useStudentActivity ? 'block' : 'none';
$('profileStudentActivityName').value = p.studentActivityName || '';
$('profileStudentActivityDuration').value = p.studentActivityDuration || 1;
} else {
$('profileRoleDuty').checked = true;
$('profileActivityName').value = p.activityLabel || 'Duty';
$('profileDutyStart').value = p.dutyStart || '09:00';
$('profileDutyEnd').value = p.dutyEnd || '18:00';
$('profileDutyStudyGoal').value = p.dutyStudyGoal || 3;
if (p.shiftType === 'night') {
$('profileShiftNight').checked = true;
} else {
$('profileShiftDay').checked = true;
}
$('profileDutySetWakeUpManual').checked = p.useDutyManualWakeUp || false;
$('profileDutyManualWakeUpWrapper').style.display = p.useDutyManualWakeUp ? 'flex' : 'none';
$('profileDutyWakeUpTime').value = p.dutyWakeUpTime || '05:00';
$('profileDutySetSleepManual').checked = p.useDutyManualSleep || false;
$('profileDutyManualSleepWrapper').style.display = p.useDutyManualSleep ? 'flex' : 'none';
$('profileDutySleepTime').value = p.dutySleepTime || '22:00';
}
toggleOccupationView(p.occupation || 'duty', 'profile');
updateDynamicActivityLabels();
$('profileModal').style.display = 'block';
};
const saveProfile = () => {
const occupation = document.querySelector('input[name="profileOccupation"]:checked').value;
const profile = {
name: $('profileName').value.trim(),
age: parseInt($('profileAge').value) || null,
exam: $('profileExam').value.trim(),
occupation: occupation,
targetDate: $('profileTargetDate').value,
subjects: $('profileSubjects').value.split('\n').map(s => s.trim()).filter(s => s),
focusSubject: $('profileFocusSubject').value.trim(),
extraGoal: $('profileExtraGoal').value.trim(),
};
if (occupation === 'duty') {
profile.activityLabel = $('profileActivityName').value.trim() || 'Duty';
profile.dutyStart = $('profileDutyStart').value;
profile.dutyEnd = $('profileDutyEnd').value;
profile.dutyStudyGoal = parseFloat($('profileDutyStudyGoal').value) || 3;
profile.shiftType = document.querySelector('input[name="profileShiftType"]:checked').value;
profile.useDutyManualWakeUp = $('profileDutySetWakeUpManual').checked;
profile.dutyWakeUpTime = $('profileDutyWakeUpTime').value;
profile.useDutyManualSleep = $('profileDutySetSleepManual').checked;
profile.dutySleepTime = $('profileDutySleepTime').value;
} else {
profile.studentStudyGoal = parseFloat($('profileStudentStudyGoal').value) || 8;
profile.useStudentManualWakeUp = $('profileStudentSetWakeUpManual').checked;
profile.wakeUpTime = $('profileWakeUpTime').value;
profile.useStudentManualSleep = $('profileStudentSetSleepManual').checked;
profile.sleepTime = $('profileSleepTime').value;
profile.useStudentActivity = $('profileStudentAddActivityCheckbox').checked;
profile.studentActivityName = $('profileStudentActivityName').value.trim();
profile.studentActivityDuration = parseFloat($('profileStudentActivityDuration').value) || 1;
}
localStorage.setItem('smart_profile', JSON.stringify(profile));
localStorage.setItem('profileSetup', 'true');
$('menuBtn').classList.remove('blinking-menu');
$('profileModal').style.display = 'none';
refreshUI();
};
const generateStudentRoutine = (params, subjects, focusSubject) => {
    const { studyHours, addActivity, activityName, activityDuration, useWake, wakeStr, useSleep, sleepStr } = params;
    
    const newSlots = [];
    const totalStudyMins = studyHours * 60;
    const activityMins = addActivity ? activityDuration * 60 : 0;
    
    const sessions = Math.max(1, Math.ceil(studyHours / 1.5));
    const shortBreaks = sessions > 1 ? sessions - 1 : 0;
    const longBreaks = sessions > 2 ? 1 : 0;
    const dinnerBreak = 1;
    const totalBreakMins = (shortBreaks * 15) + (longBreaks * 60) + (dinnerBreak * 45);
    
    const PERSONAL_TIME_MINS = 5 * 60; 
    const totalRequiredMins = totalStudyMins + activityMins + totalBreakMins + PERSONAL_TIME_MINS;

    let wakeTimeMins, sleepTimeMins;

    if (useWake && useSleep) {
        wakeTimeMins = timeToMinutes(wakeStr);
        sleepTimeMins = timeToMinutes(sleepStr);
         if (wakeTimeMins >= sleepTimeMins) {
            alert(getBilingualText('Invalid Time: Wake-up time must be before sleep time for a single day cycle.', 'अमान्य समय: जागने का समय सोने के समय से पहले होना चाहिए।'));
            return false;
        }
    } else if (useWake) {
        wakeTimeMins = timeToMinutes(wakeStr);
        sleepTimeMins = wakeTimeMins + totalRequiredMins; 
    } else if (useSleep) {
        sleepTimeMins = timeToMinutes(sleepStr);
        wakeTimeMins = sleepTimeMins - totalRequiredMins;
    } else {
        wakeTimeMins = timeToMinutes("05:00");
        sleepTimeMins = wakeTimeMins + totalRequiredMins;
    }

    let availableMins = (sleepTimeMins - wakeTimeMins);
    if (availableMins < 0) { availableMins += 1440; }
    
    const sleepDuration = 1440 - availableMins;

    if (availableMins < totalRequiredMins - PERSONAL_TIME_MINS || sleepDuration < 360) { 
        alert(getBilingualText(
            `Your schedule is not realistic. You have approx. ${Math.round(availableMins/60)} hours available, but your goals require at least ${Math.round((totalRequiredMins - PERSONAL_TIME_MINS)/60)} hours for activities alone. Please adjust your study goal, activity duration, or allow for at least 6 hours of sleep.`,
            `आपकी दिनचर्या व्यावहारिक नहीं है। आपके पास लगभग ${Math.round(availableMins/60)} घंटे उपलब्ध हैं, लेकिन आपके लक्ष्यों के लिए गतिविधियों हेतु ही कम से कम ${Math.round((totalRequiredMins - PERSONAL_TIME_MINS)/60)} घंटे चाहिए। कृपया अपने अध्ययन लक्ष्य, गतिविधि की अवधि को समायोजित करें, या कम से कम 6 घंटे की नींद सुनिश्चित करें।`
        ));
        return false;
    }
    
    let currentTime = wakeTimeMins;
    newSlots.push({ id: 'wake', label_en: 'Wake Up & Fresh Up', label_hi: 'उठो और फ्रेश हो जाओ', time: minutesToTime(currentTime), msg_en: `Good morning!`, msg_hi: `सुप्रभात!` });
    currentTime += 30;

    const studyPerSession = Math.floor(totalStudyMins / sessions);
    let subjectIndex = 0;

    for (let i = 1; i <= sessions; i++) {
        const subject = subjects[subjectIndex % subjects.length] || `Study Session ${i}`;
        const isFocus = subject.toLowerCase() === focusSubject.toLowerCase();
        const sessionDuration = studyPerSession + (isFocus ? FOCUS_EXTRA_MINUTES : 0);
        
        newSlots.push({ id: `study${i}`, label_en: `${subject}`, label_hi: `${subject}`, time: minutesToTime(currentTime), msg_en: `Time for ${subject}.`, msg_hi: `${subject} का समय।` });
        currentTime += sessionDuration;
        subjectIndex++;

        if (i === Math.floor(sessions / 2) && longBreaks > 0) {
            newSlots.push({ id: `long_break`, label_en: `Lunch Break`, label_hi: `लंच ब्रेक`, time: minutesToTime(currentTime), msg_en: `Time for lunch.`, msg_hi: `लंच का समय।` });
            currentTime += 60;
        } else if (i < sessions) {
            newSlots.push({ id: `break`, label_en: `Short Break`, label_hi: `छोटा ब्रेक`, time: minutesToTime(currentTime), msg_en: `Take a short break.`, msg_hi: `एक छोटा ब्रेक लें।` });
            currentTime += 15;
        }
    }

    if (addActivity && activityName) {
        newSlots.push({ id: 'other_activity', label_en: activityName, label_hi: activityName, time: minutesToTime(currentTime), msg_en: `Time for ${activityName}.`, msg_hi: `${activityName} का समय।` });
        currentTime += activityMins;
    }

    newSlots.push({ id: 'dinner', label_en: 'Dinner', label_hi: 'डिनर', time: minutesToTime(currentTime), msg_en: `Have your dinner.`, msg_hi: `अपना डिनर करें।` });
    currentTime += 45;

    newSlots.push({ id: 'sleep', label_en: 'Sleep', label_hi: 'सोना', time: minutesToTime(sleepTimeMins), msg_en: `Time to sleep.`, msg_hi: `सोने का समय।` });

    slotsData = newSlots;
    return true;
};


const autoGenerate = () => {
const occupation = document.querySelector('input[name="occupation"]:checked').value;
const p = getProfile();
const subjects = p.subjects || [];
const subjectsInput = $('subjectsList').value.split('\n').map(s => s.trim()).filter(s => s);
const allSubjects = subjects.length > 0 ? subjects : subjectsInput;
const focusSubject = $('focusSubject').value.trim() || p.focusSubject || '';

if (occupation === 'duty') {
    const useManualWake = $('dutySetWakeUpManual').checked;
    const manualWakeStr = $('dutyWakeUpTime').value;
    const useManualSleep = $('dutySetSleepManual').checked;
    const manualSleepStr = $('dutySleepTime').value;
    const ds = $('dutyStart').value, de = $('dutyEnd').value;
    const studyGoalHours = parseFloat($('dutyStudyGoal').value) || 0;

    if (!ds || !de || !studyGoalHours) {
        alert(getBilingualText('Please set duty start, end, and your study goal.', 'कृपया ड्यूटी शुरू, खत्म और अपना अध्ययन लक्ष्य निर्धारित करें।'));
        return;
    }

    const sM = timeToMinutes(ds), eM = timeToMinutes(de);

    if (useManualWake && timeToMinutes(manualWakeStr) >= sM) {
        alert(getBilingualText('Invalid Time: Wake-up time must be before duty starts.', 'अमान्य समय: जागने का समय ड्यूटी शुरू होने से पहले होना चाहिए।'));
        return;
    }
    
    if (useManualSleep) {
        const sleepM = timeToMinutes(manualSleepStr);
        let isError = false;
        if (sM < eM) { // Day shift
            if (sleepM > sM && sleepM < eM) isError = true;
        } else { // Night shift
            if (sleepM > sM || sleepM < eM) isError = true;
        }
        if (isError) {
             alert(getBilingualText('Invalid Time: Your sleep time cannot be during your duty hours.', 'अमान्य समय: आपके सोने का समय आपके ड्यूटी के घंटों के दौरान नहीं हो सकता।'));
             return;
        }
    }

    let dutyDurationMins = eM - sM;
    if (dutyDurationMins < 0) { dutyDurationMins += 1440; }

    const studyGoalMins = studyGoalHours * 60;
    const PERSONAL_TIME_MINS = 4 * 60; 
    const requiredSleepMins = 6 * 60;
    const totalRequiredMins = dutyDurationMins + studyGoalMins + PERSONAL_TIME_MINS + requiredSleepMins;

    if (totalRequiredMins > 1440) {
        const availableForStudy = (1440 - dutyDurationMins - PERSONAL_TIME_MINS - requiredSleepMins) / 60;
        alert(getBilingualText(
            `Your schedule is too packed. With your duty of ${Math.round(dutyDurationMins/60)} hours and minimum personal/sleep time, you only have about ${Math.max(0, availableForStudy).toFixed(1)} hours available for study. Please reduce your study goal.`,
            `आपकी दिनचर्या बहुत व्यस्त है। आपकी ${Math.round(dutyDurationMins/60)} घंटे की ड्यूटी और न्यूनतम व्यक्तिगत/नींद के समय के साथ, आपके पास पढ़ाई के लिए केवल ${Math.max(0, availableForStudy).toFixed(1)} घंटे उपलब्ध हैं। कृपया अपने अध्ययन लक्ष्य को कम करें।`
        ));
        return;
    }
    
    slotsData = defaultSlots(p.exam, p.activityLabel);
    const findSlot = (id) => slotsData.find(s => s.id === id);
    let subjectIndex = 0;

    if (document.querySelector('input[name="shiftType"]:checked').value === 'night') {
        const sleepStartMins = eM + 60;
        const wakeTimeMins = sleepStartMins + 480; 
        findSlot('duty_end').time = de;
        findSlot('home').time = minutesToTime(eM + 30);
        findSlot('sleep').time = minutesToTime(sleepStartMins);
        findSlot('wake').time = minutesToTime(wakeTimeMins);
        findSlot('leave').time = minutesToTime(sM - 30);
        findSlot('duty_start').time = ds;
        const dinnerTimeMins = sM - 90;
        findSlot('dinner').time = minutesToTime(dinnerTimeMins);
        const studyBlockStart = wakeTimeMins + 30;
        let currentTime = studyBlockStart;

        if (studyGoalMins > 0) {
            findSlot('main_study').time = minutesToTime(currentTime);
            findSlot('main_study').label_en = allSubjects[0] || 'Main Study';
            findSlot('main_study').label_hi = allSubjects[0] || 'मुख्य पढ़ाई';
            currentTime += studyGoalMins;
        }

        slotsData = slotsData.filter(s => ['wake', 'duty_start', 'duty_end', 'home', 'dinner', 'sleep', 'main_study', 'leave'].includes(s.id) && (s.id !== 'main_study' || studyGoalMins > 0));

    } else { // Day shift
        findSlot('wake').time = minutesToTime(sM - 90);
        findSlot('leave').time = minutesToTime(sM - 30);
        findSlot('duty_start').time = ds;
        findSlot('duty_end').time = de;
        findSlot('home').time = minutesToTime(eM + 30);
        findSlot('nap').time = minutesToTime(eM + 60);

        const morningStudyDuration = Math.min(45, studyGoalMins);
        let eveningStudyMins = studyGoalMins - morningStudyDuration;
        
        if(morningStudyDuration > 0) {
            findSlot('morning_study').time = minutesToTime(sM - 30 - morningStudyDuration);
            findSlot('morning_study').label_en = allSubjects[subjectIndex % allSubjects.length] || 'Morning Study';
            findSlot('morning_study').label_hi = allSubjects[subjectIndex % allSubjects.length] || 'सुबह की पढ़ाई';
            subjectIndex++;
        } else {
            slotsData = slotsData.filter(s => s.id !== 'morning_study');
        }

        let currentTime = timeToMinutes(findSlot('nap').time) + 30; 
        
        if(eveningStudyMins > 0) {
             findSlot('main_study').time = minutesToTime(currentTime);
             findSlot('main_study').label_en = allSubjects[subjectIndex % allSubjects.length] || 'Main Study';
             findSlot('main_study').label_hi = allSubjects[subjectIndex % allSubjects.length] || 'मुख्य पढ़ाई';
             currentTime += eveningStudyMins;
        } else {
             slotsData = slotsData.filter(s => s.id !== 'main_study');
        }

        findSlot('dinner').time = minutesToTime(currentTime + 15);
        findSlot('sleep').time = minutesToTime(currentTime + 75);
        slotsData = slotsData.filter(s => !['break', 'practice', 'current_affairs'].includes(s.id));
    }

    if (useManualWake) { findSlot('wake').time = manualWakeStr; }
    if (useManualSleep) { findSlot('sleep').time = manualSleepStr; }

} else { // Student
    const studentParams = {
        studyHours: parseFloat($('studentStudyGoal').value) || 8,
        addActivity: $('studentAddActivityCheckbox').checked,
        activityName: $('studentActivityName').value.trim(),
        activityDuration: parseFloat($('studentActivityDuration').value) || 1,
        useWake: $('studentSetWakeUpManual').checked,
        wakeStr: $('wakeUpTime').value,
        useSleep: $('studentSetSleepManual').checked,
        sleepStr: $('sleepTime').value
    };
    
    if (!studentParams.studyHours) { 
        alert(getBilingualText('Please set your daily study goal.', 'कृपया अपना दैनिक अध्ययन लक्ष्य निर्धारित करें।')); 
        return; 
    }
    
    const success = generateStudentRoutine(studentParams, allSubjects, focusSubject);
    if (!success) return;
}

saveSlotsData();
renderSlots();

const manualAlarmModal = $('manualAlarmModal');
const manualAlarmList = $('manualAlarmList');
manualAlarmList.innerHTML = ''; 

const importantAlarmIds = ['wake', 'morning_study', 'leave', 'duty_start', 'main_study', 'practice', 'dinner', 'sleep', 'study1', 'study2', 'study3', 'study4', 'study5'];

slotsData.sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

slotsData.forEach(slot => {
    if (importantAlarmIds.includes(slot.id)) {
        const listItem = document.createElement('li');
        const labelText = getBilingualText(slot.label_en, slot.label_hi);

        if (slot.id === 'wake') {
            const originalTime = timeToMinutes(slot.time);
            const fifteenMinutesEarly = minutesToTime(originalTime - 15);
            const formattedEarlyTime = formatTime(fifteenMinutesEarly);
            
            listItem.innerHTML = `
                <span>${labelText}</span>
                <span class="time" style="text-align: right;">
                    ${formattedEarlyTime}
                    <small style="display: block; color: var(--muted); font-weight: normal;" data-hi="(15 मिनट पहले)" data-en="(15 mins early)"></small>
                </span>`;
        } else {
            const timeText = formatTime(slot.time);
            listItem.innerHTML = `<span>${labelText}</span><span class="time">${timeText}</span>`;
        }
        manualAlarmList.appendChild(listItem);
    }
});

manualAlarmModal.style.display = 'block';
updateTextContent();
};
const toggleOccupationView = (occupation, context) => {
const dutyFields = (context === 'profile') ? $('profileDutyFields') : $('dutyFields');
const studentFields = (context === 'profile') ? $('profileStudentFields') : $('studentFields');
if (occupation === 'student') { dutyFields.style.display = 'none'; studentFields.style.display = 'block'; }
else { dutyFields.style.display = 'block'; studentFields.style.display = 'none'; }
};
const init = () => {
initializeData();
$('langSel').value = currentLang;
$('timeFormatSel').value = timeFormat;
const todayStr = new Date().toISOString().split('T')[0];
[$('targetDate'), $('profileTargetDate')].forEach(el => el.min = todayStr);
if (localStorage.getItem('profileSetup') !== 'true') {
    $('setupCard').classList.add('open');
    $('setupCard').querySelector('.card-body').style.display = 'block';
    $('menuBtn').classList.add('blinking-menu');
}
const alarmSound = $('alarmSound');
const alarmTones = [
'https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3',
'https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.wav',
'https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.wav',
'https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.wav'
];
const alarmLeadTimes = { 'wake': 10, 'morning_study': 5, 'leave': 5, 'main_study': 10, 'study1': 5, 'study2': 5, 'study3': 5, 'study4': 5, 'study5': 5, 'break': 2, 'practice': 10, 'current_affairs': 5, 'dinner': 10, 'sleep': 0, 'other_activity': 5, 'relax': 0 };
const dismissCurrentAlarm = () => { alarmSound.pause(); alarmSound.currentTime = 0; $('alarmModal').style.display = 'none'; };
const triggerAlarm = (slot, leadTime) => {
let currentToneIndex = parseInt(localStorage.getItem('currentAlarmToneIndex') || '0');
alarmSound.src = alarmTones[currentToneIndex];
let nextToneIndex = (currentToneIndex + 1) % alarmTones.length;
localStorage.setItem('currentAlarmToneIndex', nextToneIndex.toString());
const messageEn = leadTime > 0 ? `Get ready for ${slot.label_en}!` : `It's time for ${slot.label_en}!`;
const messageHi = leadTime > 0 ? `${slot.label_hi} के लिए तैयार हो जाओ!` : `${slot.label_hi} का समय हो गया है!`;
$('alarmMessage').innerHTML = getBilingualText(messageEn, messageHi);
$('alarmModal').style.display = 'block';
alarmSound.play().catch(e => console.error("Alarm sound failed:", e));
};
const checkAlarms = () => {
const now = new Date();
const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
slotsData.forEach(slot => {
if (Object.keys(alarmLeadTimes).includes(slot.id)) {
const leadTime = alarmLeadTimes[slot.id];
const slotTimeInMinutes = timeToMinutes(slot.time);
const alarmTimeInMinutes = (slotTimeInMinutes - leadTime + 1440) % 1440;
if (currentTimeInMinutes === alarmTimeInMinutes) {
const alarmTriggeredKey = `alarm_triggered_${slot.id}_${new Date().toISOString().split('T')[0]}`;
if (!sessionStorage.getItem(alarmTriggeredKey)) {
triggerAlarm(slot, leadTime);
sessionStorage.setItem(alarmTriggeredKey, 'true');
}
}
}
});
};
$('stopAlarmBtn').addEventListener('click', dismissCurrentAlarm);
setInterval(checkAlarms, 30000);
checkAlarms();
// --- EVENT LISTENERS ---

$('closeManualAlarmModalBtn').addEventListener('click', () => {
    $('manualAlarmModal').style.display = 'none';
});

$('langSel').addEventListener('change', handleLanguageChange);
$('timeFormatSel').addEventListener('change', handleTimeFormatChange);
$('autoBtn').addEventListener('click', autoGenerate);
$('applyBtn').addEventListener('click', () => { saveSlotsData(); alert(getBilingualText('Routine Saved!', 'रूटीन सेव हो गया!')); });
$$('#examName, #targetDate, #dutyStart, #dutyEnd, #wakeUpTime, #studentStudyGoal, #dutyStudyGoal, #subjectsList, #focusSubject').forEach(el => el.addEventListener('input', displayStrategy));
$('activityName').addEventListener('input', updateDynamicActivityLabels);
$$('input[name="occupation"]').forEach(radio => { radio.addEventListener('change', (e) => toggleOccupationView(e.target.value, 'main')); });
$$('input[name="profileOccupation"]').forEach(radio => { radio.addEventListener('change', (e) => toggleOccupationView(e.target.value, 'profile')); });

$('studentSetWakeUpManual').addEventListener('change', (e) => { $('studentManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileStudentSetWakeUpManual').addEventListener('change', (e) => { $('profileStudentManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('studentSetSleepManual').addEventListener('change', (e) => { $('studentManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileStudentSetSleepManual').addEventListener('change', (e) => { $('profileStudentManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('dutySetWakeUpManual').addEventListener('change', (e) => { $('dutyManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileDutySetWakeUpManual').addEventListener('change', (e) => { $('profileDutyManualWakeUpWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('dutySetSleepManual').addEventListener('change', (e) => { $('dutyManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });
$('profileDutySetSleepManual').addEventListener('change', (e) => { $('profileDutyManualSleepWrapper').style.display = e.target.checked ? 'flex' : 'none'; });

$('studentAddActivityCheckbox').addEventListener('change', (e) => { $('studentActivityWrapper').style.display = e.target.checked ? 'block' : 'none'; });
$('profileStudentAddActivityCheckbox').addEventListener('change', (e) => { $('profileStudentActivityWrapper').style.display = e.target.checked ? 'block' : 'none'; });
const handleShiftChange = (isProfile = false) => {
const radioName = isProfile ? 'profileShiftType' : 'shiftType';
$$(`input[name="${radioName}"]`).forEach(radio => {
radio.addEventListener('change', (e) => {
const startId = isProfile ? 'profileDutyStart' : 'dutyStart';
const endId = isProfile ? 'profileDutyEnd' : 'dutyEnd';
const startInput = $(startId);
const endInput = $(endId);
if (e.target.value === 'day') { startInput.value = '09:00'; endInput.value = '18:00'; }
else if (e.target.value === 'night') { startInput.value = '22:00'; endInput.value = '06:00'; }
if (!isProfile) updateDynamicActivityLabels();
});
});
};
handleShiftChange(false);
handleShiftChange(true);
const handleTimeFocus = (isProfile = false) => {
const startId = isProfile ? 'profileDutyStart' : 'dutyStart';
const endId = isProfile ? 'profileDutyEnd' : 'dutyEnd';
const startInput = $(startId);
const endInput = $(endId);
const radioName = isProfile ? 'profileShiftType' : 'shiftType';
[startInput, endInput].forEach(input => {
input.addEventListener('focus', () => {
if (!input.value) {
const shift = document.querySelector(`input[name="${radioName}"]:checked`).value;
if (shift === 'day') { input.value = input.id === startId ? '09:00' : '18:00'; }
else { input.value = input.id === startId ? '22:00' : '06:00'; }
}
});
});
};
handleTimeFocus(false);
handleTimeFocus(true);
const titleElement = document.querySelector('.app-title');
if (titleElement) { titleElement.addEventListener('click', () => { const color1 = `hsl(${Math.random() * 360}, 100%, 70%)`; const color2 = `hsl(${Math.random() * 360}, 100%, 70%)`; titleElement.style.backgroundImage = `linear-gradient(45deg, ${color1}, ${color2})`; }); }
setInterval(updateQuote, 60000);
$('menuBtn').addEventListener('click', e => { e.stopPropagation(); const menu = $('dropdownMenu'); menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; });
$('dropdownMenu').addEventListener('click', e => e.stopPropagation());
document.addEventListener('click', () => { if($('dropdownMenu')) $('dropdownMenu').style.display = 'none'; });
$('menuProfileBtn').addEventListener('click', e => { e.preventDefault(); openProfileModal(); });
$$('.card-header').forEach(header => { header.addEventListener('click', () => { const card = header.parentElement; const body = card.querySelector('.card-body, .card-body-no-padding'); card.classList.toggle('open'); body.style.display = body.style.display === 'block' ? 'none' : 'block'; }); });
[$('closeProfileModal'), $('cancelProfile')].forEach(el => el.addEventListener('click', () => $('profileModal').style.display = 'none'));
$('saveProfile').addEventListener('click', saveProfile);
$('slots').addEventListener('click', e => {
const btn = e.target.closest('.slot-edit-btn');
if (!btn) return;
const id = btn.dataset.id;
const slot = slotsData.find(s => s.id === id);
if (slot) {
$('slotEditId').value = id;
$('slotEditTitle').textContent = getBilingualText(`Edit "${slot.label_en}"`, `"${slot.label_hi}" संपादित करें`);
$('slotEditTime').value = slot.time;
$('slotEditMsgHi').value = slot.msg_hi;
$('slotEditMsgEn').value = slot.msg_en;
$('slotEditModal').style.display = 'block';
}
});
$('saveSlot').addEventListener('click', () => {
const id = $('slotEditId').value;
const idx = slotsData.findIndex(s => s.id === id);
if (idx > -1) {
slotsData[idx].time = $('slotEditTime').value;
slotsData[idx].msg_hi = $('slotEditMsgHi').value.trim();
slotsData[idx].msg_en = $('slotEditMsgEn').value.trim();
saveSlotsData();
renderSlots();
}
$('slotEditModal').style.display = 'none';
});
$('closeSlotEdit').addEventListener('click', () => $('slotEditModal').style.display = 'none');
const adminModal = $('adminModal');
$('adminLoginBtn').addEventListener('click', (e) => {
e.preventDefault();
const storedPassword = localStorage.getItem('admin_password') || 'admin123';
const enteredPassword = prompt(getBilingualText('Enter Admin Password:', 'एडमिन पासवर्ड डालें:'));
if (enteredPassword === storedPassword) {
try {
$('adminProfileData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_profile') || '{}'), null, 2);
$('adminSlotsData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_slots') || '[]'), null, 2);
$('adminQuotesData').value = "This section is now managed internally by categories (Hindi, Shayari, Shlokas). To edit, please modify the `initializeData` function in the source code.";
$('adminAudioData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_audio') || '[]'), null, 2);
$('adminAppsData').value = JSON.stringify(JSON.parse(localStorage.getItem('smart_study_apps') || '[]'), null, 2);
adminModal.style.display = 'block';
} catch (err) { alert('Error loading data.'); }
} else if (enteredPassword !== null) {
alert(getBilingualText('Access Denied.', 'एक्सेस नहीं मिला।'));
}
});
$('changePasswordBtn').addEventListener('click', () => {
const newPass = $('newPassword').value.trim();
if (!newPass) { alert(getBilingualText('Please enter a new password.', 'कृपया नया पासवर्ड डालें।')); return; }
localStorage.setItem('admin_password', newPass);
$('newPassword').value = '';
alert(getBilingualText('Password changed successfully!', 'पासवर्ड सफलतापूर्वक बदल दिया गया!'));
});
$('addAudioTrack').addEventListener('click', () => {
const name = $('newAudioName').value.trim(), url = $('newAudioUrl').value.trim(), imageUrl = $('newAudioImageUrl').value.trim();
if (!name || !url) { alert(getBilingualText('Please fill name and URL.', 'कृपया नाम और URL भरें।')); return; }
try {
let audioData = JSON.parse($('adminAudioData').value || '[]');
if (!Array.isArray(audioData)) audioData = [];
audioData.push({ name, url, imageUrl: imageUrl || '' });
$('adminAudioData').value = JSON.stringify(audioData, null, 2);
$('newAudioName').value = '';
$('newAudioUrl').value = '';
$('newAudioImageUrl').value = '';
alert(getBilingualText('Audio track added!', 'ऑडियो ट्रैक जोड़ दिया गया!'));
} catch (e) { alert(getBilingualText('Error adding track. Check JSON format.', 'ट्रैक जोड़ने में त्रुटि। JSON फॉर्मेट जांचें।')); }
});
$('addStudyApp').addEventListener('click', () => {
    const name = $('newAppName').value.trim();
    const linkUrl = $('newAppUrl').value.trim();
    const imageUrl = $('newAppImageUrl').value.trim();
    if (!name || !linkUrl || !imageUrl) {
        alert(getBilingualText('Please fill name, link URL, and image URL.', 'कृपया नाम, लिंक URL और इमेज URL भरें।'));
        return;
    }
    try {
        let appsData = JSON.parse($('adminAppsData').value || '[]');
        if (!Array.isArray(appsData)) appsData = [];
        appsData.push({ name, linkUrl, imageUrl });
        $('adminAppsData').value = JSON.stringify(appsData, null, 2);
        $('newAppName').value = '';
        $('newAppUrl').value = '';
        $('newAppImageUrl').value = '';
        alert(getBilingualText('Study app added to the list!', 'स्टडी ऐप सूची में जोड़ दिया गया है!'));
    } catch (e) {
        alert(getBilingualText('Error adding app. Check JSON format.', 'ऐप जोड़ने में त्रुटि। JSON फॉर्मेट जांचें।'));
    }
});
$('closeAdminModal').addEventListener('click', () => adminModal.style.display = 'none');
$('adminSaveBtn').addEventListener('click', () => {
    const saveData = (key, textareaId, fieldName) => {
        try {
            if (key === 'smart_quotes') return true;
            JSON.parse($(textareaId).value); 
            localStorage.setItem(key, $(textareaId).value);
            return true;
        } catch (e) {
            alert(getBilingualText(`Error in ${fieldName} Data: Invalid JSON format.`, `त्रुटि ${fieldName} डेटा में: अमान्य JSON फॉर्मेट।`));
            return false;
        }
    };

    if (
        saveData('smart_profile', 'adminProfileData', 'Profile') &&
        saveData('smart_slots', 'adminSlotsData', 'Slots') &&
        saveData('smart_audio', 'adminAudioData', 'Audio') &&
        saveData('smart_study_apps', 'adminAppsData', 'Study Apps')
    ) {
        alert(getBilingualText('Admin data saved!', 'एडमिन डेटा सेव हो गया!'));
        adminModal.style.display = 'none';
        refreshUI();
    }
});
$('adminResetBtn').addEventListener('click', () => { if (confirm(getBilingualText('Are you sure you want to reset EVERYTHING?', 'क्या आप वाकई सब कुछ रीसेट करना चाहते हैं?'))) { localStorage.clear(); alert(getBilingualText('All data has been reset.', 'सारा डेटा रीसेट कर दिया गया है।')); location.reload(); } });
// --- NOTES SHARING EVENT LISTENERS ---
$('shareNoteBtn').addEventListener('click', () => { $('noteSubmissionModal').style.display = 'block'; });
$('closeNoteSubmissionModal').addEventListener('click', () => { $('noteSubmissionModal').style.display = 'none'; });
$('submitNoteBtn').addEventListener('click', () => {
const author = $('noteAuthor').value.trim();
const title = $('noteTitle').value.trim();
const content = $('noteContent').value.trim();
if (!author || !title || !content) { alert(getBilingualText('Please fill all fields.', 'कृपया सभी फ़ील्ड भरें।')); return; }
const adminEmail = "Indianroutingai@gmail.com";
const subject = encodeURIComponent("New Note Submission for Indian Routine");
const body = encodeURIComponent( `Hi Admin,\n\nA new note has been submitted for review.\n\nAuthor: ${author}\nTitle: ${title}\nContent/URL: ${content}\n\nPlease review and post it on Blogspot if approved.` );
window.location.href = `mailto:${adminEmail}?subject=${subject}&body=${body}`;
$('noteSubmissionModal').style.display = 'none';
$('noteAuthor').value = '';
$('noteTitle').value = '';
$('noteContent').value = '';
alert(getBilingualText('Thank you! Your email client has been opened to send the note for review.', 'धन्यवाद! समीक्षा के लिए नोट भेजने हेतु आपका ईमेल क्लाइंट खोल दिया गया है।'));
});
$('readNotesBtn').addEventListener('click', () => {
window.open('https://indianroutineai.blogspot.com', '_blank');
});
const audioPlayer = $('audioPlayer'), playPauseBtn = $('audioPlayPauseBtn'), trackSelect = $('audioTrackSelect'), trackImage = $('audioTrackImage');
playPauseBtn.addEventListener('click', () => { if (!trackSelect.value) return; if (audioPlayer.paused) audioPlayer.play(); else audioPlayer.pause(); });
audioPlayer.addEventListener('play', () => { playPauseBtn.textContent = '❚❚'; });
audioPlayer.addEventListener('pause', () => { playPauseBtn.textContent = '▶'; });
trackSelect.addEventListener('change', () => {
const selectedOption = trackSelect.options[trackSelect.selectedIndex];
audioPlayer.src = selectedOption.value;
trackImage.src = selectedOption.dataset.imageUrl;
trackImage.style.display = selectedOption.dataset.imageUrl ? 'block' : 'none';
if (selectedOption.value) audioPlayer.play();
else audioPlayer.pause();
});
window.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.style.display = 'none'; });
const twentyFourHoursInMillis = 24 * 60 * 60 * 1000;
const funnyInsults = [ { en: "Wow, champ! At this pace, you'll finish the syllabus by the next election.", hi: "वाह राजा! इस रफ़्तार से तो अगला चुनाव आते-आते सिलेबस पूरा होगा।" }, { en: "Studied for 5 minutes? The country is proud of your sacrifice.", hi: "5 मिनट पढ़ाई कर ली? देश को तुम पर गर्व है।" }, { en: "Is this a study session or a commercial break?", hi: "यह पढ़ाई का सेशन था या कमर्शियल ब्रेक?" } ];
const goodJobMessages = [ { en: "Great job! Keep up the momentum.", hi: "बहुत बढ़िया! इसी लगन से लगे रहो।" }, { en: "Excellent work! Every minute counts.", hi: "शानदार काम! हर मिनट मायने रखता है।" }, { en: "That's a solid session. You're on the right track!", hi: "यह एक ठोस सेशन था। तुम सही रास्ते पर हो!" } ];
const formatStudyTime = (ms) => {
    if (isNaN(ms) || ms < 0) ms = 0;
    const totalSeconds = Math.floor(ms / 1000);
    const h = Math.floor(totalSeconds / 3600);
    const m = Math.floor((totalSeconds % 3600) / 60);
    const s = totalSeconds % 60;
    return `${h}h ${m}m ${s}s`;
};

const updateStudyDisplay = () => {
    const todayMs = parseInt(localStorage.getItem('today_study_time') || '0');
    const totalMs = parseInt(localStorage.getItem('total_study_time') || '0');
    $('todayStudyTime').textContent = formatStudyTime(todayMs);
    $('totalStudyTime').textContent = formatStudyTime(totalMs);

    const subjectTimes = JSON.parse(localStorage.getItem('subject_study_time') || '{}');
    const statsContainer = $('subjectStatsDisplay');
    statsContainer.innerHTML = '';
    if (Object.keys(subjectTimes).length === 0) {
        statsContainer.innerHTML = `<span style="color:var(--muted);" data-hi="आज कोई विषय नहीं पढ़ा गया।" data-en="No subjects studied today."></span>`;
    } else {
        for (const subject in subjectTimes) {
            const timeString = formatStudyTime(subjectTimes[subject]);
            const statDiv = document.createElement('div');
            statDiv.innerHTML = `<strong>${subject}:</strong> ${timeString}`;
            statsContainer.appendChild(statDiv);
        }
    }
    updateTextContent();
};

const renderStudyApps = () => {
    const grid = $('studyAppGrid');
    grid.innerHTML = '';
    const studyApps = JSON.parse(localStorage.getItem('smart_study_apps') || '[]');
    studyApps.forEach(app => {
        const appDiv = document.createElement('div');
        appDiv.className = 'app-item';
        appDiv.dataset.linkUrl = app.linkUrl;
        appDiv.innerHTML = `<img src="${app.imageUrl}" alt="${app.name} Logo"><span>${app.name}</span>`;
        grid.appendChild(appDiv);
    });
};

const startStudyTimer = (subject) => {
    if (localStorage.getItem('study_session_data')) return;
    const sessionData = {
        startTime: Date.now(),
        subject: subject
    };
    localStorage.setItem('study_session_data', JSON.stringify(sessionData));
};

const stopStudyTimer = () => {
    const sessionDataString = localStorage.getItem('study_session_data');
    if (!sessionDataString) return;

    const sessionData = JSON.parse(sessionDataString);
    const startTime = sessionData.startTime;
    const subject = sessionData.subject;
    
    const sessionDuration = Date.now() - startTime;
    localStorage.removeItem('study_session_data');

    if (sessionDuration < 1000) return;

    const totalMs = parseInt(localStorage.getItem('total_study_time') || '0') + sessionDuration;
    localStorage.setItem('total_study_time', totalMs.toString());

    const lastReset = parseInt(localStorage.getItem('study_time_last_reset') || '0');
    let todayMs = parseInt(localStorage.getItem('today_study_time') || '0');
    let subjectTimes = JSON.parse(localStorage.getItem('subject_study_time') || '{}');

    if (Date.now() - lastReset > twentyFourHoursInMillis) {
        todayMs = 0;
        subjectTimes = {}; // Reset subject times daily
        localStorage.setItem('study_time_last_reset', Date.now().toString());
    }
    
    const newTodayMs = todayMs + sessionDuration;
    localStorage.setItem('today_study_time', newTodayMs.toString());

    subjectTimes[subject] = (subjectTimes[subject] || 0) + sessionDuration;
    localStorage.setItem('subject_study_time', JSON.stringify(subjectTimes));

    updateStudyDisplay();

    let message;
    if (sessionDuration < 30 * 60 * 1000) {
        message = funnyInsults[Math.floor(Math.random() * funnyInsults.length)];
    } else {
        message = goodJobMessages[Math.floor(Math.random() * goodJobMessages.length)];
    }
    alert(`${getBilingualText(message.en, message.hi)} (Studied ${subject} for: ${formatStudyTime(sessionDuration)})`);
};

$('studyAppGrid').addEventListener('click', (e) => {
    e.preventDefault();
    const appItem = e.target.closest('.app-item');
    if (!appItem) return;

    const linkUrl = appItem.dataset.linkUrl;
    const profile = getProfile();
    const subjects = profile.subjects || [];

    if (subjects.length === 0) {
        alert(getBilingualText('Please set your subjects in the "Setup & Strategy" section first.', 'कृपया पहले "सेटअप और स्ट्रेटजी" सेक्शन में अपने विषय सेट करें।'));
        return;
    }
    
    const subjectListContainer = $('subjectListContainer');
    subjectListContainer.innerHTML = '';
    subjects.forEach(subject => {
        const subjectDiv = document.createElement('div');
        subjectDiv.className = 'subject-item';
        subjectDiv.textContent = subject;
        subjectDiv.onclick = () => {
            startStudyTimer(subject);
            $('subjectSelectorModal').style.display = 'none';
            window.open(linkUrl, '_blank');
        };
        subjectListContainer.appendChild(subjectDiv);
    });

    $('subjectSelectorModal').style.display = 'block';
});

$('closeSubjectModal').addEventListener('click', () => {
    $('subjectSelectorModal').style.display = 'none';
});


document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        stopStudyTimer();
    }
});

// --- MODAL LOGIC ---
const updateBanner = $('updateBanner');
const updateDetailsModal = $('updateDetailsModal');
const closeUpdateModal = $('closeUpdateModal');

if (updateBanner && updateDetailsModal && closeUpdateModal) {
    updateBanner.addEventListener('click', () => {
        updateDetailsModal.style.display = 'block';
    });
    closeUpdateModal.addEventListener('click', () => {
        updateDetailsModal.style.display = 'none';
    });
}

// NEW: Footer Pages Modal Logic
const setupModal = (btnId, modalId, closeBtnId) => {
    const btn = $(btnId);
    const modal = $(modalId);
    const closeBtn = $(closeBtnId);
    if(btn && modal && closeBtn) {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            modal.style.display = 'block';
        });
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    }
};

setupModal('aboutBtn', 'aboutModal', 'closeAboutModal');
setupModal('privacyBtn', 'privacyModal', 'closePrivacyModal');
setupModal('disclaimerBtn', 'disclaimerModal', 'closeDisclaimerModal');


stopStudyTimer();
renderStudyApps();
updateStudyDisplay();
refreshUI();
};
init();
});
</script>
</body>
</html>
